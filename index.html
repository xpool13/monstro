<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>...</title>
    <meta name="google-site-verification" content="5aXs_V1RAM8aIPgjrq5XWPOER1dyy3nRtn95doM2Mfo" />
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="клякса.in.ua">
    <meta property="og:title" content="клякса.in.ua">
    <meta property="og:description" content="Іграшки, канцтовари, товари для дітей">
    <meta property="og:url" content="https://xpool.pro">
    <meta property="og:locale" content="ru_RU">
    <meta id="imgmeta" runat="server" property="og:image" content="https://xpool.pro/web/source/style_blot/img/blot_preview.png">
    <meta property="og:image:width" content="968">
    <meta property="og:image:height" content="794">

    <meta id="MetaTitle" runat="server" name="title" content="Бизнес Конструктор, Складской учет, Автоматизация магазина, Программный РРО" />
    <meta id="MetaDesc" runat="server" name="description" content="Универсальная среда для автоматизации ведения бизнеса любой сложности. Удобный доступ к панели управления из любой точки мира. Онлайн кассы, Интернет-витрины, программный РРО" />


    <link href="https://xpool.pro/web/source/img/shop-icon.png" rel="icon" type="image/x-icon" />
    <link href="https://xpool.pro/web/source/img/shop-icon.png" rel="shortcut icon" type="image/x-icon" />
    <meta id="vpo" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="stylesheet" type="text/css" href="https://xpool.pro/source/css/jquery-ui.css" />
    <script type="text/javascript" src="https://xpool.pro/source/js/jquery.js"></script>
    <script type="text/javascript" src="https://xpool.pro/source/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="https://xpool.pro/source/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="https://xpool.pro/source/js/jquery.init.datepicker.js"></script>
    <script type="text/javascript" src="https://xpool.pro/source/js/dist/jquery.inputmask.js"></script>
    <script type="text/javascript" src="https://xpool.pro/source/js/jquery-qrcode-0.17.0.min.js"></script>
    <script type="text/javascript" src="https://xpool.pro/source/js/printThis.js"></script>
    <script src="https://xpool.pro/web/source/js/jquery.star-rating-svg.js"></script>
    <link rel="stylesheet" href="https://xpool.pro/web/source/css/star-rating-svg.css">
    <link id="TargetStyleSheet" st="style_blot" href="https://xpool.pro/web/source/style_blot/css/main.css" rel="Stylesheet" />

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style type="text/css">

        span.Visa {
            display: inline-block;
            margin: auto;
            width: 133px;
            height: 49px;
            background: url("https://xpool.pro/web/source/style_blot/img/visa-logo.svg") no-repeat center center;
            background-size: contain;
        }

        span.MasterCard {
            display: inline-block;
            margin: auto;
            width: 133px;
            height: 49px;
            background: url("https://xpool.pro/web/source/style_blot/img/mastercard-logo.svg") no-repeat center center;
            background-size: contain;
        }

        #AltImgDiv {
            width: 300px;
            margin: auto;
            display: block;
        }

        #HideRate {
            text-align: center;
            font: 20px/40px Arial;
            background-color: #3cf8ff;
            color: #000;
            cursor: pointer;
            margin-bottom: 5px;
        }

        #AddRate {
            text-align: center;
            font: 20px/40px Arial;
            background-color: #084a05;
            color: #fff;
            cursor: pointer;
        }

            #AddRate:hover {
                background-color: #1c7613;
            }


        .AddRateSpan {
            cursor: pointer;
            color: #02007c;
            padding-bottom: 10px;
        }

        .ReadAll {
            cursor: pointer;
            color: #02007c;
        }

            .ReadAll:hover {
                text-decoration: underline;
            }

        .AddRateSpan2 {
            cursor: pointer;
            color: #02007c;
            padding-bottom: 10px;
        }

        .RateTitle {
            margin-top: 5px;
            text-align: center;
            font: 16px/30px Arial;
            background-color: #fff;
            text-align: left;
            padding-left: 5px;
        }

        .RateContent {
            text-align: center;
            font: 16px/20px Arial;
            background-color: #fff;
            text-align: left;
            padding-left: 5px;
        }

        .DescContent {
            text-align: center;
            font: 14px/20px Arial;
            background-color: #fff;
            color: #333;
            text-align: left;
            padding: 8px;
        }

        input.Def {
            width: 260px;
            text-align: center;
            margin: auto;
            font: 18px/20px Arial;
            display: block;
        }

        .dready {
            background-color: greenyellow;
        }

        .sklep {
            background-color: #c0c0c0;
        }

        td.None {
            white-space: nowrap;
            overflow: hidden;
            padding: 0px;
            font: normal 18px/40px arial;
            background-color: #dedede;
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
        }

        td.GoPay {
            white-space: nowrap;
            overflow: hidden;
            padding: 0px;
            margin-top: 4px;
            font: normal 22px/80px arial;
            background-color: #212121;
            text-align: center;
            vertical-align: middle;
            color: #fff;
            cursor: pointer;
        }

            td.GoPay:hover {
                background-color: #000;
                color: #ffffcc;
            }

        td.GoCabinet {
            white-space: nowrap;
            overflow: hidden;
            padding: 0px;
            font: normal 24px/80px arial;
            background-color: #212121;
            color: #FFF;
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
        }

            td.GoCabinet:hover {
                background-color: #000;
                color: #ffffcc;
            }

        td.GoPrepay {
            white-space: nowrap;
            overflow: hidden;
            padding: 0px;
            height: 80px;
            font: normal 22px/22px arial;
            background-color: #212121;
            text-align: center;
            vertical-align: middle;
            color: #fff;
            cursor: pointer;
        }

            td.GoPrepay:hover {
                background-color: #000;
                color: #ffffcc;
            }

        td.PayInfo {
            margin-top: 4px;
            background-color: #fff;
            padding: 5px;
            font: 100 10px/20px arial;
        }

        td.Head1 {
            overflow: hidden;
            padding: 0px;
            font: normal 12px/12px arial;
            background-color: #111111;
            color: white;
            text-align: left;
            vertical-align: middle;
            height: 40px;
        }

            td.Head1 select {
                border-style: none;
                margin: 0px;
                font: normal 18px/42px arial;
                text-align: left;
                padding-left: 3px;
                width: 130px;
                height: 42px;
                background-color: white;
            }

            td.Head1 .inputText {
                border-style: none;
                margin: 0px;
                height: 42px;
                width: 100%;
                font: normal 18px/40px arial;
                text-align: left;
                padding-left: 3px;
                box-sizing: border-box;
                -webkit-user-select: text;
                -khtml-user-select: text;
                -moz-user-select: text;
                -o-user-select: text;
                user-select: text;
            }

        td.Head2 {
            white-space: nowrap;
            overflow: hidden;
            padding-left: 3px;
            font: normal 12px/12px arial;
            background-color: #222222;
            color: white;
            text-align: left;
            vertical-align: middle;
            height: 30px;
        }

        span.PayCard {
            background-color: none;
            border: 1px solid #FFF;
            color: #FFF;
            padding: 3px;
        }

            span.PayCard:hover {
                background-color: #000000;
                cursor: pointer;
            }

        span.PayBonuses {
            background-color: none;
            border: 1px solid #FFF;
            color: #FFF;
            padding: 3px;
        }

            span.PayBonuses:hover {
                background-color: #000000;
                cursor: pointer;
            }

        div.SpecInfo {
            background-color: red;
            text-align: center;
            padding: 4px;
        }

        .logselect {
            cursor: pointer;
            display: inline-block;
            width: 140px;
            text-align: center;
            border: .1px solid #000;
            border-bottom: none;
            background-color: #fff;
        }

        .loghide {
            cursor: pointer;
            display: inline-block;
            width: 140px;
            text-align: center;
            color: #000;
            background-color: #CCC;
        }

        table.consult {
            -webkit-font-smoothing: antialiased;
            position: relative;
            left: 50%;
            margin-left: -460px;
            text-align: center;
            width: 920px;
            background-color: #a1ef47;
            margin-top: 4px;
            color: #000;
            background-color: #8e8e8e;
        }

        #viewer:after {
            display: none;
            content: url(https://xpool.pro/web/source/img/closex1.svg) url(https://xpool.pro/web/source/img/closex2.svg) url(https://xpool.pro/web/source/img/arrowleft1.svg) url(https://xpool.pro/web/source/img/arrowleft2.svg) url(https://xpool.pro/web/source/img/arrowright1.svg) url(https://xpool.pro/web/source/img/arrowright2.svg);
        }

        #splash {
            display: none;
            left: 0px;
            top: 0px;
            bottom: 0px;
            z-index: 9998;
            position: fixed;
            height: 100%;
            width: 100%;
            background-color: black;
            opacity: 0.6;
        }

        #splash2 {
            display: none;
            left: 0px;
            top: 0px;
            bottom: 0px;
            z-index: 999999;
            position: fixed;
            height: 100%;
            width: 100%;
            background-color: black;
            opacity: 0.6;
        }

        #splash3 {
            display: none;
            left: 0px;
            top: 0px;
            bottom: 0px;
            z-index: 99999999;
            position: fixed;
            height: 100%;
            width: 100%;
            background-color: black;
            opacity: 0.6;
        }

        #splash4 {
            display: none;
            left: 0px;
            top: 0px;
            bottom: 0px;
            z-index: 999999999;
            position: fixed;
            height: 100%;
            width: 100%;
            background-color: black;
            opacity: 0.6;
        }

        {
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: -moz-none;
            -o-user-select: none;
            user-select: none;
        }

        .UrlArea {
            background-color: white;
            border: 1px solid #CCC;
        }

        .TitleSpan {
            display: block;
            width: 300px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

            .TitleSpan:hover {
                text-decoration: underline;
                cursor: pointer;
            }

        .TitleSubSpan:hover {
            text-decoration: underline;
            cursor: pointer;
        }

        #viewer {
            position: fixed;
            z-index: 9999;
            display: none;
            background-color: white;
            padding: 2px;
        }

        #fullimg {
            position: fixed;
            display: block;
            border-radius: 0px;
            border: solid 0px #FFF;
            height: 100%;
            width: 100%;
            text-align: center;
            margin: 0;
            left: 0px;
            top: 0px;
            background-color: white;
            z-index: 99999;
        }

        #fulloptions {
            height: 56px;
            padding-top: 2px;
            padding-bottom: 5px;
        }

            #fulloptions ul {
                list-style: none;
                display: table-row;
            }

                #fulloptions ul li {
                    display: table-cell;
                    vertical-align: bottom;
                    padding-right: 0px;
                }

        #fullimage {
            position: fixed;
            display: block;
            left: 10px;
            top: 10px;
            bottom: 0;
            right: 0;
            width: auto;
            max-width: 98%;
            height: auto;
            max-height: 98%;
            margin: auto;
            
        }

        .findPhoto {
            position: absolute;
            display: block;
            width: 180px;
            height: 50px;
            background-color: #000000;
            padding: 10px;
            opacity: 0.7;
            color: #fff;
            margin-top: 15px;
            margin-left: 50%;
            transform: translateX(-50%);
            font: normal 20px arial;
        }

        .findPhoto2 {
            position: absolute;
            display: block;
            width: 180px;
            height: 50px;
            background-color: #000000;
            padding: 10px;
            opacity: 0.7;
            color: #fff;
            margin-top: 15px;
            margin-left: 50%;
            transform: translateX(-50%);
            font: normal 20px arial;
            z-index: 10;
        }

        .findPhoto:hover {
            background-color: #000;
            opacity: 1;
            cursor: pointer;
        }

        .findPhoto2:hover {
            background-color: #ffff00;
            opacity: 1;
            color: #000;
            cursor: pointer;
        }

        /*#viewer ul {
            display: table-row;
        }

        #viewer li {
            display: table-cell;
            background-color: transparent;
            height: 100%;
        }*/

        #viewer span.closey {
            z-index: 999999;
            cursor: pointer;
            position: fixed;
            display: block;
            right: 2px;
            top: 2px;
            width: 67px;
            height: 70px;
            background: url("https://xpool.pro/web/source/img/closex2.svg") no-repeat right top;
            background-size: contain;
        }

        #viewer span.imgcount {
            z-index: 999999;
            cursor: pointer;
            position: fixed;
            display: block;
            left: 20px;
            top: 20px;
            width: 40px;
            height: 20px;
            color: white;
            text-align: center;
            padding: 2px;
            background-color: black;
        }

        /*#viewer span.closey:hover {
            background: url("source/img/closex1.svg") no-repeat right top;
            background-size: contain;
        }*/

        #viewer span.leftscroll {
            z-index: 999999;
            cursor: pointer;
            position: fixed;
            display: block;
            left: 23px;
            bottom: 0%;
            -webkit-transform: translateY(-50%);
            width: 66px;
            height: 66px;
            background: url("https://xpool.pro/web/source/img/arrowleft1.svg") no-repeat right top;
            background-size: contain;
        }

            #viewer span.leftscroll:hover {
                background: url("https://xpool.pro/web/source/img/arrowleft2.svg") no-repeat right top;
                background-size: contain;
            }

        #viewer span.rightscroll {
            z-index: 999999;
            cursor: pointer;
            position: fixed;
            display: block;
            bottom: 0%;
            -webkit-transform: translateY(-50%);
            right: 23px;
            width: 66px;
            height: 66px;
            background: url("https://xpool.pro/web/source/img/arrowright1.svg") no-repeat right top;
            background-size: contain;
        }

        #viewer span.desc {
            position: fixed;
            bottom: 0px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            height: 150px;
            background-color: white;
            vertical-align: middle;
            
        }

            #viewer span.rightscroll:hover {
                background: url("https://xpool.pro/web/source/img/arrowright2.svg") no-repeat right top;
                background-size: contain;
            }

        #viewer div.imgcanvas {
            margin: auto;
            border: solid;
            width: 100%;
        }


        input.inputDate {
            background-color: white;
            border: none;
            width: 100px;
            font: normal 18px/30px arial;
            text-align: left;
            padding-left: 5px;
        }

        #loading2 {
            position: fixed;
            left: 50%;
            margin-left: -80px;
            z-index: 999999999999;
            width: 140px;
            padding: 10px;
            font: normal 18px arial;
            text-align: center;
            vertical-align: middle;
            background-color: white;
            display: none;
            bottom: 2px;
            border: 1px solid #000000;
        }

        td.cheque {
            height: 42px;
            position: relative;
            font-size: large;
            font-family: Arial;
            background-color: #fdff63;
            text-align: left;
            padding-left: 50px;
            background-color: #333;
            color: white;
        }

        td.category1 {
            height: 42px;
            position: relative;
            font-size: large;
            font-family: Arial;
            text-align: left;
            padding-left: 50px;
            color: #000;
            cursor: pointer;
            background-color: #fff;
        }

        td.category2 {
            height: 42px;
            position: relative;
            font-size: large;
            font-family: Arial;
            text-align: left;
            padding-left: 50px;
            color: #000;
            cursor: pointer;
            background-color: #fff;
        }

        td.category3 {
            height: 42px;
            position: relative;
            font-size: large;
            font-family: Arial;
            text-align: left;
            padding-left: 50px;
            color: #000;
            cursor: pointer;
            background-color: #CCCCCC;
        }

        td.category1:hover {
            background-color: #fdff63;
        }

        td.category2:hover {
            background-color: #fdff63;
        }

        td.category3:hover {
            background-color: #fdff63;
        }

        td.order {
            height: 42px;
            position: relative;
            font-size: large;
            font-family: Arial;
            text-align: left;
            padding: 5px;
            background-color: #fff;
            color: #000;
            cursor: pointer;
        }

            td.order:hover {
                background-color: #FFFF00;
            }

        td.order2 {
            height: 42px;
            position: relative;
            font-size: large;
            font-family: Arial;
            text-align: left;
            padding: 5px;
            background-color: #fff;
            color: #000;
            cursor: pointer;
        }

            td.order2:hover {
                background-color: #FFFF00;
            }

        td.order3 {
            height: 42px;
            position: relative;
            font-size: large;
            font-family: Arial;
            text-align: left;
            padding: 5px;
            background-color: #fff;
            color: #000;
            cursor: pointer;
        }

            td.order3:hover {
                background-color: #FFFF00;
            }

        span.QR {
            cursor: pointer;
            position: absolute;
            left: 5px;
            top: 5px;
            display: block;
            margin: auto;
            width: 34px;
            height: 34px;
            background: url("https://xpool.pro/source/img/qr.svg") no-repeat 50% 50%;
            background-color: #fff;
            background-size: contain;
        }

        span.RejectSpan2 {
            cursor: pointer;
            position: relative;
            display: block;
            width: 40px;
            height: 40px;
            background: url("https://xpool.pro/web/source/style_blot/img/close.svg") no-repeat right top;
            margin: auto;
            background-size: contain;
        }

        body {
            overflow-y: scroll;
            background-color: #8e8e8e;
            overflow-x: hidden;
        }
    </style>
    <meta name="google-site-verification" content="5aXs_V1RAM8aIPgjrq5XWPOER1dyy3nRtn95doM2Mfo" />
</head>
<body>
    <input type="hidden" value="" id="c_view" />
    <input type="hidden" value="" id="c_cart" />

    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v6.0"></script>

    <img id="preview" runat="server" class="previmg" redir="0" style="display: none" src="https://xpool.pro/web/source/style_blot/img/blot_preview.png" />

    <div id="DetailsDIV" style="z-index: 99999; width: 294px; display: none; position: absolute; overflow-y:scroll; overflow-x: no-display;">
        <table id="DetailsTable" style="position: absolute; table-layout: fixed; margin: 0px; border-collapse: collapse; font-family: Arial; font-size: 11px; color: #333333;"></table>
    </div>
    <div id="QRCode" style="display: none; position: absolute; position: fixed; left: 50%; top: 10px; margin-left: -110px; z-index: 999999999999; width: 220px; background-color: white;">
        <div id="QRCodeView" style="display: block; margin: 10px;"></div>
        <div id="VerifyQR" style="text-align: center; cursor: pointer; background-color: #cfcfcf; margin-top: 10px; font: normal 18px/40px arial; border-bottom: 1px solid #000000; border-top: 1px solid #000000;" uk="Перевірити" ru="Проверить">Проверить</div>
        <div id="CloseQR" style="text-align: center; cursor: pointer; background-color: #ff8181; color: black; font: normal 18px/40px arial;" uk="Закрити" ru="Закрыть">Закрыть</div>
    </div>

    <div id="redirect" style="cursor: pointer; position: absolute; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; text-align: center; font: normal 20px arial; color: black; display: none;">
        переход<br />
        <img src="https://xpool.pro/web/source/style_blot/img/loading.gif" />
    </div>

    <input type="hidden" value="" id="TimeComponents" />
    <span class="deliveryTip" style="display: none" uk="Самовивіз по місту Тернівка">Самовывоз по городу Терновка</span>
    <div id="splash"></div>
    <div id="splash2"></div>
    <div id="splash3"></div>
    <div id="splash4"></div>
    <div id="loading" uk="Завантаження" style="display: none;">Загрузка</div>
    <div id="loading2" uk="Завантаження" style="display: none;">Загрузка</div>
    <div id="AddictedView" style="text-align: center; z-index: 9999999999; display: none; position: absolute; width: 400px; left: 50%; background-color: none; overflow-y: hidden; overflow-x: no-display;">
        <table id="AddictedTable" width="100%" style="table-layout: fixed; margin: 0px; border-collapse: collapse; font-family: Arial; font-size: 11px; color: #333333; background-color: #333333;" align="center"></table>
    </div>
    <div id="alertform" style="display: none;">
        <div class="header">
            <ul>
                <li>
                    <span class="menu"></span>
                </li>
                <li>
                    <span class="title" uk="Анонімно">Анонимно:</span>
                </li>
                <li>
                    <span id="AlertFormClose" class="alertformclose"></span>
                </li>
            </ul>
        </div>
        <div class="tools">
            <table>
                <tr>
                    <td class="tdleft">Прецедент:</td>
                </tr>
                <tr>
                    <td class="tdleft">
                        <select id="AlertSelect">
                            <option uk="Некомпетентне обслуговування" ru="Некомпетентное обслуживание">Некомпетентное обслуживание</option>
                            <option uk="Грубість" ru="Грубость">Грубость</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class="tdleft" uk="Вкажіть дату:">Укажите дату:</td>
                </tr>
                <tr>
                    <td class="tdleft">
                        <input type="button" class="incdec" id="DateDec" value="<" /><span id="DateCount" class="val"></span><input type="button" class="incdec" id="DateInc" value=">" />
                    </td>
                </tr>
                <tr>
                    <td class="tdleft">Ключ:</td>
                </tr>
                <tr>
                    <td class="tdleft">
                        <input type="tel" id="KeyCode" class="Key" /><span class="N" uk="(не обов'язково)">(не обязательно)</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="padding-left: 5px;">
                        <div style="text-align: left; padding-top: 15px;"><span style="font: 20px/20px Arial; margin-left: 5px" uk="Коментар:">Комментарий:</span><span class="N" uk="(не обов'язково)">(не обязательно)</span></div>
                        <textarea id="AlertInfo" maxlength="500" rows="3" cols="30" style="width: 300px; font: normal 18px arial; display: block; margin-left: auto; margin-right: auto; margin-top: 5px;"></textarea>
                    </td>
                </tr>
            </table>
            <span id="SubmitAlert" class="submit" uk="Відправити">Отправить</span>
        </div>
    </div>
    <div id="rateform" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="menu"></span>
                </li>
                <li>
                    <span class="title" uk="Додати відгук">Добавить отзыв</span>
                </li>
                <li>
                    <span id="RateFormClose" class="rateformclose"></span>
                </li>
            </ul>
        </div>
        <div class="tools">
            <table>
                <tr id="R1">
                    <td class="tdleft" uk="Обслуговування:">Обслуживание:</td>
                    <td class="tdright">
                        <input type="button" class="incdec" id="R1Dec" value="<" /><span id="R1Count" class="val">0</span><input type="button" class="incdec" id="R1Inc" value=">" />
                    </td>
                </tr>
                <tr id="R2">
                    <td class="tdleft" uk="Якість товару:">Качество товара:</td>
                    <td class="tdright">
                        <input type="button" class="incdec" id="R2Dec" value="<" /><span id="R2Count" class="val">0</span><input type="button" class="incdec" id="R2Inc" value=">" />
                    </td>
                </tr>
                <tr id="R3">
                    <td class="tdleft" uk="Ціна:">Цена:</td>
                    <td class="tdright">
                        <input type="button" class="incdec" id="R3Dec" value="<" /><span id="R3Count" class="val">0</span><input type="button" class="incdec" id="R3Inc" value=">" />
                    </td>
                </tr>
                <tr id="RateDate1" style="display: none;">
                    <td class="tdleft" colspan="2" style="padding-right: 15px">
                        <input type="button" class="incdec" id="DateDec2" value="<" /><span id="DateCount2" class="val2"></span><input type="button" class="incdec" id="DateInc2" value=">" />
                    </td>
                </tr>
                <tr>
                    <td class="tdright" colspan="2" style="padding-left: 10px" uk="Ім'я:">Имя:</td>
                </tr>
                <tr>
                    <td class="tdLeft" colspan="2">
                        <input type="text" class="Def" id="RName" value="" />
                    </td>
                </tr>
                <tr>
                    <td class="tdright" colspan="2" style="padding-left: 10px" uk="Коментар:">Коментарий:</td>
                </tr>
                <tr>
                    <td class="tdleft" colspan="2">
                        <textarea id="RCommentInfo" maxlength="500" rows="3" cols="30" style="width: 290px; font: normal 18px arial; display: block; margin-left: auto; margin-right: auto; margin-top: 5px;"></textarea>
                    </td>
                </tr>
            </table>
            <span id="SubmitRate" class="submit" uk="Оцінити">Оценить</span>
        </div>
    </div>
    <div id="addcomment" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="title" uk="Комент:">Коммент:</span>
                </li>
                <li>
                    <span id="AddCommentClose" class="close"></span>
                </li>
            </ul>
        </div>
        <div class="info">
            <ul>
                <li>
                    <input type="text" id="CommentTextBox" />
                </li>
            </ul>
        </div>
        <div style="text-align: center;">
            <span class="addcommentsubmit" id="AddCommentSubmit" uk="Додати">Добавить</span>
        </div>
    </div>
    <div id="excelgenerate" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="title" uk="Вкажіть діапазон:">Укажите диапазон:</span>
                </li>
                <li>
                    <span id="ExcelGenerateClose" class="excelgenerateclose"></span>
                </li>
            </ul>
        </div>
        <div class="info">
            <ul>
                <li uk="Дата 1:" style="text-align: right; padding-right: 3px;">Дата 1:</li>
                <li>
                    <input type="button" style="width: 180px; text-align: center" id="datepicker1" class="inputDate" value="" />
                </li>
            </ul>
            <ul>
                <li uk="Дата 2:" style="text-align: right; padding-right: 3px;">Дата 2:</li>
                <li>
                    <input type="button" style="width: 180px; text-align: center" id="datepicker2" class="inputDate" value="" />
                </li>
            </ul>
        </div>
        <div style="text-align: center;">
            <span class="excelsubmit" id="ExcelGenerateSubmit">OK</span>
        </div>
    </div>
    <div id="login" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="menu"></span>
                </li>
                <li>
                    <span class="title" uk="Вхід">Вход</span>
                </li>
                <li>
                    <span id="LoginClose" class="loginclose"></span>
                </li>
            </ul>
        </div>
        <div class="info">
            <ul>
                <li uk="Телефон:" style="text-align: right; padding-right: 3px;">Телефон:</li>
                <li>
                    <input id="LoginPhoneNumber" type="text" />
                </li>
            </ul>
            <ul>
                <li></li>
                <li uk="або">или</li>
            </ul>
            <ul>
                <li uk="Ключ:" style="text-align: right; padding-right: 3px;">Ключ:</li>
                <li>
                    <input id="LoginKey" type="text" />
                </li>
            </ul>
        </div>
        <div style="text-align: center;">
            <input id="LoginSubmit" type="button" value="OK" />
        </div>
    </div>
    <div id="createaccount" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="menu"></span>
                </li>
                <li>
                    <span class="title" uk="Реєстрація">Регистрация</span>
                </li>
                <li>
                    <span id="CreateAccountClose"></span>
                </li>
            </ul>
        </div>
        <div style="text-align: left; padding-left: 30px; font: 20px/20px Arial;">Телефон:</div>
        <div class="info">
            <input id="CreatePhoneNumberLogin" type="text" /><input id="CreatePhoneNumberSubmit" type="button" value="OK" /><br />
        </div>
    </div>
    <div id="sortview" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="menu"></span>
                </li>
                <li>
                    <span class="title" uk="Сортування">Сортировка</span>
                </li>
                <li>
                    <span id="SortClose" class="close"></span>
                </li>
            </ul>
        </div>
        <div class="info">
            <div class="SortItem" v="2" uk="Ціна за зростанням">Цена по возрастанию</div>
            <div class="SortItem" v="1" uk="Ціна за спаданням">Цена по убыванию</div>
            <div class="SortItem" v="3" uk="Новизна">Новизна</div>
            <div class="SortItem" v="0" uk="За замовчуванням">По умолчанию</div>
        </div>
    </div>
    <div id="viewer" style="display: none;">
        <span class="leftscroll"></span>

        <div id="fullimg">
            <img id="fullimage" src="https://xpool.pro/web/source/style_blot/img/loading.gif" />
        </div>
        <span class="rightscroll"></span>
        <span class="closey"></span>
        <span class="imgcount">1 / 1</span>
        <span id="ViewDesc" class="desc"></span>
        <table id="EditImage2" class="EditImageClass" style="z-index: 999999; width: 166px; background-color: #efefef; position: fixed; display: none; top: 20px; left: 100px; table-layout: fixed; margin: 0px; border-collapse: collapse; font-family: Arial; font-size: 11px; color: black; background-color: white">
            <tr>
                <td>
                    <div style="width: 164px; height: 120px; overflow-y: scroll;">
                        <div>
                            URL1:<br />
                            <textarea class="UrlArea" ind="1" id="TargetURL1" style="width: 138px;"></textarea>
                        </div>
                        <div>
                            URL2:<br />
                            <textarea class="UrlArea" ind="2" id="TargetURL2" style="width: 138px;"></textarea>
                        </div>
                        <div>
                            URL3:<br />
                            <textarea class="UrlArea" ind="3" id="TargetURL3" style="width: 138px;"></textarea>
                        </div>
                        <div>
                            URL4:<br />
                            <textarea class="UrlArea" ind="4" id="TargetURL4" style="width: 138px;"></textarea>
                        </div>
                        <div>
                            URL5:<br />
                            <textarea class="UrlArea" ind="5" id="TargetURL5" style="width: 138px;"></textarea>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td style="text-align: center"><br /><span id="UploadToGoogleFeedSpan" style="background-color: lightgray; font: normal 18px arial; display: block; width: 100%; cursor: pointer" uk="Google Shopping">Google Shopping</span></td>
            </tr>
            <tr>
                <td style="text-align: center"><span id="UploadToFeedRozetkaSpan" style="background-color: lightgray; font: normal 18px arial; display: block; width: 100%; cursor: pointer" uk="Rozetka.ua">Rozetka.ua</span></td>
            </tr>
            <tr>
                <td style="text-align: center"><span id="EditDescSpan" style="background-color: lightgray; font: normal 18px arial; display: block; width: 100%; cursor: pointer" uk="Опис">Описание</span></td>
            </tr>
        </table>
        <table id="EditImage1" class="EditImageClass" style="z-index: 999999; width: 166px; background-color: #efefef; position: fixed; display: none; top: 20px; right: 100px; table-layout: fixed; margin: 0px; border-collapse: collapse; font-family: Arial; font-size: 11px; color: black; background-color: white">
            <tr>
                <td>Категория:</td>
            </tr>
            <tr>
                <td>
                    <select id="CategoriesSelect" runat="server" style="width: 150px;"></select>
                </td>
            </tr>
            <tr>
                <td>НИЗ: <span id="DownPrice">-</span></td>
            </tr>
            <tr>
                <td>Статус:</td>
            </tr>
            <tr>
                <td>
                    <table>
                        <tr>
                            <td style="width: 35px; background-color: lightgray; text-align: center; font: normal 18px arial; cursor: pointer" id="DecStatus"><</td>
                            <td style="width: 80px; background-color: white; text-align: center; font: normal 18px arial;" id="StatusValue">0</td>
                            <td style="width: 35px; background-color: lightgray; text-align: center; font: normal 18px arial; cursor: pointer" id="IncStatus">></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>Рейтинг:</td>
            </tr>
            <tr>
                <td>
                    <table>
                        <tr>
                            <td style="width: 35px; background-color: lightgray; text-align: center; font: normal 18px arial; cursor: pointer" id="DecRating"><</td>
                            <td style="width: 80px; background-color: white; text-align: center; font: normal 18px arial;" id="RatingValue">0</td>
                            <td style="width: 35px; background-color: lightgray; text-align: center; font: normal 18px arial; cursor: pointer" id="IncRating">></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td uk="Знижка">Скидка:</td>
            </tr>
            <tr>
                <td>
                    <input id="DiscountValue" type="text" style="width: 150px; font: normal 18px arial; text-align: center;" value="0" />
                </td>
            </tr>
            <tr>
                <td uk="Інет ціна:">Інет ціна:</td>
            </tr>
            <tr>
                <td>
                    <input id="Price2Value" type="text" style="width: 150px; font: normal 18px arial; text-align: center;" value="0" />
                </td>
            </tr>
            <tr>
                <td uk="Доставка">Доставка:</td>
            </tr>
            <tr>
                <td>
                    <select id="DeliverySelect">
                        <option uk="За замовчуванням" ru="По умолчанию">По умолчанию</option>
                        <option uk="Платна" ru="Платная">Платная</option>
                        <option uk="Безкоштовна" ru="Бесплатная">Бесплатная</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td uk="Час:">Время:</td>
            </tr>
            <tr>
                <td>
                    <select id="TimeSelect">
                        <option v="0" ru="Нет" uk="Ні">Нет</option>
                        <option v="1" ru="Да, сорт. время> +А-Я" uk="Так, сорт. час> +А-Я">Да, сорт. время> +А-Я</option>
                        <option v="2" ru="Да, сорт. время> +Я-А" uk="Так, сорт. час> +Я-А">Да, сорт. время> +Я-А</option>
                        <option v="3" ru="Да, сорт. время< +А-Я" uk="Так, сорт. час< +А-Я">Да, сорт. время< +А-Я</option>
                        <option v="4" ru="Да, сорт. время< +Я-А" uk="Так, сорт. час< +Я-А">Да, сорт. время< +Я-А</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td style="text-align: center"><br /><span id="RejectSpan" style="background-color: lightgray; font: normal 18px arial; display: block; width: 100%; cursor: pointer" uk="Скинути">Сбросить</span></td>
            </tr>
            <tr>
                <td style="text-align: center"><span id="SetSpan" style="background-color: lightgray; font: normal 18px arial; display: block; width: 100%; cursor: pointer" uk="Застосувати">Применить</span></td>
            </tr>
            <tr>
                <td style="text-align: center"><span id="SaveSpan" style="background-color: lightgray; font: normal 18px arial; display: block; width: 100%; cursor: pointer" uk="Зберегти" runat="server">Сохранить</span></td>
            </tr>
        </table>
    </div>
    <div id="alertaccepted" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="menu"></span>
                </li>
                <li>
                    <span class="title" uk="Скарга прийнята">Жалоба принята</span>
                </li>
                <li>
                    <span class="close"></span>
                </li>
            </ul>
        </div>
        <div class="info" uk="Дякуємо! Ваша скарга прийнята в обробку">Спасибо! Ваша жалоба принята в обработку</div>
    </div>
    <div id="orderaccepted" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="menu"></span>
                </li>
                <li>
                    <span class="title" uk="Прийняте">Принят</span>
                </li>
                <li>
                    <span class="close"></span>
                </li>
            </ul>
        </div>
        <div class="info" uk="Дякуємо! Ваше замовлення прийняте в обробку">Спасибо! Ваш заказ принят в обработку</div>
    </div>
    <div id="orderover" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="menu"></span>
                </li>
                <li>
                    <span class="title" uk="Більше не можна">Больше нельзя</span>
                </li>
                <li>
                    <span class="close"></span>
                </li>
            </ul>
        </div>
        <div class="info" uk="Кошик заповнен, щоб додати нове замовлення - видаліть менш пріоритетне">Корзина заполнена, чтобы добавить новый заказ - удалите менее приоритетный</div>
    </div>
    <div id="favover" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="menu"></span>
                </li>
                <li>
                    <span class="title" uk="Більше не можна">Больше нельзя</span>
                </li>
                <li>
                    <span class="close"></span>
                </li>
            </ul>
        </div>
        <div class="info" uk="Список бажань заповнений, щоб додати нове - видаліть менш пріоритетне">Список желаний заполнен, чтобы добавить новое - удалите менее приоритетное</div>
    </div>

    <div id="search" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="title" uk="Знайти в магазині">Найти в магазине</span>
                </li>
                <li>
                    <span class="close"></span>
                </li>
            </ul>
        </div>
        <input class="searchtext" type="text" value="" />
        <span class="find"></span>
        <div style="margin-left: 10px; position: relative; top: -40px" uk="діапазон цін:">диапазон цен:</div>
        <div style="text-align: center; position: relative; top: -40px;">
            <input id="minp" style="display: inline-block; width: 50px; padding: 5px; margin: 5px; border: none" type="text" value="0" /><span style="display: inline-block;">-</span><input id="maxp" style="display: inline-block; width: 50px; padding: 5px; margin: 5px; border: none;" type="text" value="50000" />
        </div>
    </div>
    <div id="about" style="display: none; overflow-y: hidden; overflow-x: no-display;">
        <div class="header">
            <ul>
                <li>
                    <span class="menu"></span>
                </li>
                <li>
                    <span class="title">Про магазин</span>
                </li>
                <li>
                    <span class="close"></span>
                </li>
            </ul>
        </div>
        <div id="shopInfo1">
            <div class="map">
                <span class="map"></span>
                <div class="mapinfo" style="font: 16px/22px Arial;">Замовляй і забирай. Безкоштовна доставка. Тернівка, вул. Харківська 5, ТРЦ МАЯК, Клякса</div>
            </div>
            <br />
            <div class="time">
                <div class="timetitle" uk="ГРАФІК РОБОТИ:">ГРАФИК РАБОТЫ:</div>
                <div class="timedesc">Щоденно з 8:30 до 19:30</div>
            </div>
            <br />
            <div class="phoneinfo">
                <div class="phonetitle">ТЕЛЕФОН:</div>
                <div class="phonedesc"></div>
            </div>
        </div>
        <br />
    </div>
    <div id="content_div" style="display: none;">
        <div class="xpool"><a target="_blank" href="https://xpool.pro" style="color: white; margin-left: 5px; text-decoration: none; display: inline-block; margin-top: 0px;"><span style="color: #ff8f8f; padding-right: 3px;">x</span>Pool.</a><a target="_blank" href="https://xpool.pro" style="color: black; background-color: #efefef; text-decoration: none; display: inline-block; margin-top: 3px; border: 1px solid #efefef; border-radius: 5px; padding: 2px; font: 14px Arial">PRO</a><span class="phone"></span></div>
        <div class="mainheader" style="display: none; padding-top: 29px;">
            <div style="width: auto; margin: auto;">
                <div style="width: 100%; overflow-y: hidden; overflow-x: no-display;">
                  
                </div>
                <div style="height: 50px; padding-bottom: 8px;">
                    <div id="MenuDIV" style="width: 100%; overflow-y: hidden; overflow-x: no-display; position: absolute; display: block; background-color: #8e8e8e; z-index: 9990;">
                        <div class="menu" style="margin: 0 auto; display: none;">
                            <ul>
                                <li id="KeyLi">
                                    <span class="key" id="UserKey"></span>
                                </li>
                                <li id="ExitLi" style="display: none">
                                    <span class="exit"></span>
                                </li>
                                <li id="MoneyBoxLi" style="display: none">
                                    <span id="MBM1" class="moneyboxm" v1="0" v2="0" v3="0" v4="0" v5="0" v6="0" v7="0" v8="0" v9="0" v10="0" v11="0" v12="0" v13="0" v14="0" v15="0">x</span>
                                </li>
                                <li>
                                    <span class="search"></span>
                                </li>
                                <li>
                                    <span class="catalog"></span>
                                </li>
                                <li>
                                    <span class="best"></span>
                                </li>
                                <li>
                                    <span class="new"></span>
                                </li>
                                <li>
                                    <span class="discount"></span>
                                </li>
                                <li id="CartLi">
                                    <span id="CartCount" class="mcart"><span class="mcartcount">0</span></span>
                                </li>
                                <li>
                                    <span id="FavCount" class="favorites"><span class="heartcount">0</span></span>
                                </li>
                                <li>
                                    <span class="info"></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="body" class="wide">
            <div id="DateTimeInfo" class="TitleDiv" style="margin-bottom: 4px; display: none;">
                <input type="button" id="datepicker" class="inputDate" value="" />
                :
            </div>
            <div id="TitleInfo" class="TitleDiv"></div>
            <div id="CabinetInfo" class="TitleDiv" style="display: none; width: 904px;"></div>
            <div id="CreateOrder" class="CreateOrderDiv" uk="Створити замовлення  <img src='https://static.liqpay.ua/buttons/logo-small.png' name='btn_text' style='margin-right: 7px !important; vertical-align: middle !important;'/>">Создать заказ <img src="https://static.liqpay.ua/buttons/logo-small.png" name="btn_text" style="margin-right: 7px !important; vertical-align: middle !important;" /></div>
            <div style="padding: 1px;"><table width="100%" id="PayOrder"></table></div>
            <div id="RatesDiv" style="display: none;"></div>
            <div>
                <table id="ProductsListView" style="table-layout: fixed; border-collapse: collapse; margin: 2px; margin-top: 0px">
                    <tr>
                        <td class="products" id="col1" style="padding-left: 0px"></td>
                        <td class="products" id="col2"></td>
                        <td class="products" id="col3" style="padding-right: 0px;"></td>
                    </tr>
                </table>
                <div id="ContentDIV" style="width: 100%; overflow-y: hidden; overflow-x: no-display;">
                    <table id="CabinetTable" style="display: none; margin-left: auto; margin-right: auto; color: #333333; background-color: transparent; border-radius: 8px; width: 926px; table-layout: fixed;" align="center"></table>
                </div>
            </div>
            <div id="EmptyDiv" uk="Порожньо" style="display: none; text-align: center; padding: 10px">Пусто</div>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    var startRecord = 0, currentEvent = '', isDataAvailable = true, req = decodeURIComponent(window.location.search.substring(1)), sort = 0;

    var old_width = window.innerWidth;

    var delivery_time = {
        638: ["0-10", "0-14", "0-14", "0-14", "0-14", "0-14", "0-10"],
        3692: ["0-10", "0-14", "0-14", "0-14", "0-14", "0-14", "0-10"],
        5409: ["<10", "<10", "<10", "<10", "<10", "<10", "<10"],
        8547: ["1", "1", "1", "1", "1", "1", "1"],
        8079: ["5", "4", "3", "2", "8", "7", "6"],
        9170: ["0-8", "0-12", "0-12", "0-12", "0-12", "0-12", "0-8"],
       
        8071: ["0-8", "0-12", "0-12", "0-12", "0-12", "0-12", "0-8"],
        8539: ["<14", "<14", "<14", "<14", "<14", "<14", "<14"],
        9178: ["0-8", "0-12", "0-12", "0-12", "0-12", "0-12", "0-8"],
        9162: ["0-8", "0-12", "0-12", "0-12", "0-12", "0-12", "0-8"],
        8555: ["1", "1", "1", "1", "1", "1", "1"]
    };

    var delivery_time2 = {
        638: ["", "", "", "", "", "", ""],
        3692: ["", "", "", "", "", "", ""],
        5409: ["<10", "<10", "<10", "<10", "<10", "<10", "<10"],
        8547: ["<5", "<5", "<5", "<5", "<5", "<5", "<5"],
        8079: ["5", "4", "3", "2", "8", "7", "6"],
        9170: ["6", "5", "4", "3", "2", "8", "7"],
       
        8071: ["2", "4", "3", "2", "5", "4", "3"],
        8539: ["<14", "<14", "<14", "<14", "<14", "<14", "<14"],
        9178: ["5", "4", "3", "9", "8", "7", "6"],
        9162: ["2", "4", "3", "2", "5", "4", "3"],
        8555: ["<5", "<5", "<5", "<5", "<5", "<5", "<5"]
    };

    var sklep = {
        638: "магазин клякса",
        3692: "магазин клякса",
        5409: "склад кетр+",
        8547: "склад babyroom",
        8079: "склад beles",
        9170: "склад dendi",

        8071: "склад dreamtoys",
        8539: "склад metr+",
        9178: "склад mix",
        9162: "склад multi",
        8555: "склад tilly"
    }

    function SetView() {

        if (old_width != window.innerWidth)
            $("#vpo").attr("content", "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0");

        old_width = window.innerWidth;

        if ($("#RatesDiv").css('display') == "none") {
            //if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            if (window.innerHeight > window.innerWidth || window.innerWidth <= 700) {
                $("body").css("width", window.innerWidth + "px");

                $("#alertform").center();
                $("#rateform").center();
                $("#excelgenerate").center();
                $("#createaccount").center();
       
                $("#orderaccepted").center();
                $("#alertaccepted").center();

                if ($('#viewer').css('display') == 'block') {
                    $("#fullimg").css("width", ($(window).innerWidth()) + "px");
                    $("#fullimg").css("height", ($(window).innerHeight()) + "px");
                    $("#viewer span.desc").css("width", ($(window).innerWidth()) + "px");
                }

                $(".wide").css("width", window.innerWidth + "px");

                $("#TitleInfo").css("width", (window.innerWidth - 28) + "px");

                if (window.innerWidth <= 416) {

                    if ($.cookie("c_view") == "table" || $("#c_view").val() == "table") {
                        $(".img").css("width", (window.innerWidth - 16) + "px");
                        $(".product").css("width", (window.innerWidth - 16) + "px");
                        //$(".pcomparision").css("width", (window.innerWidth - 20) + "px");
                    }
                    else {
                        $("#c_view").val("table");
                        $(this).attr("class", "TableView2");

                        $("#col1").children().remove();
                        $("#col2").children().remove();
                        $("#col3").children().remove();
                        $("#CabinetTable").children().remove();

                        $("#col2").hide();
                        $("#col3").hide();

                        var date = new Date();
                        var minutes = 60;
                        var hours = 24;
                        var days = 365;
                        date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                        $.cookie("c_view", "table", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });

                        startRecord = 0;
                        GetCurData();
                    }
                }
                else {

                    if ($.cookie("c_view") == "list" || $("#c_view").val() == "list") {

                        $(".pt").css("width", (window.innerWidth - 21) + "px");
                        $(".product").css("width", (window.innerWidth - 16) + "px");
                        $(".pcomparision").css("width", "186px");
                    }
                    else {
                        $("#c_view").val("list");
                        $(this).attr("class", "ListView2");

                        $("#col1").children().remove();
                        $("#col2").children().remove();
                        $("#col3").children().remove();
                        $("#CabinetTable").children().remove();

                        $("#col2").hide();
                        $("#col3").hide();

                        var date = new Date();
                        var minutes = 60;
                        var hours = 24;
                        var days = 365;
                        date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                        $.cookie("c_view", "list", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });

                        startRecord = 0;
                        GetCurData();
                    }
                }

                /////////
            }
            else {

                $("body").css("width", window.innerWidth + "px");

                $("#alertform").center();
                $("#rateform").center();
                $("#excelgenerate").center();
                $("#createaccount").center();
         
                $("#orderaccepted").center();
                $("#alertaccepted").center();

                if ($('#viewer').css('display') == 'block') {
                    $("#fullimg").css("width", ($(window).innerWidth()) + "px");
                    $("#fullimg").css("height", ($(window).innerHeight()) + "px");
                    $("#viewer span.desc").css("width", ($(window).innerWidth()) + "px");
                }

                $(".wide").css("width", "930px");

                $("#TitleInfo").css("width", "904px");

                if ($.cookie("c_view") == "list" || $("#c_view").val() == "list") {
                    $(".pt").css("width", "900px");
                    $(".product").css("width", "915px");
                    $(".pcomparision").css("width", "186px");
                }
                else {
                    $(".img").css("width", "290px");
                    $(".product").css("width", "296px");
                    $(".pcomparision").css("width", "290px");
                }
            }
        }
    }

    function are_cookies_enabled() {
        var cookieEnabled = (navigator.cookieEnabled) ? true : false;

        if (typeof navigator.cookieEnabled == "undefined" && !cookieEnabled) {
            document.cookie = "testcookie";
            cookieEnabled = (document.cookie.indexOf("testcookie") != -1) ? true : false;
        }
        return (cookieEnabled);
    }

    $(window).resize(function () {
        SetView();
    });

    function getUrlParameter(sParam) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');

            if (sParameterName[0] === sParam) {
                return sParameterName[1] === undefined ? true : sParameterName[1];
            }
        }
    };

    $("#search span.find").click(function () {

        $("#search").hide();
        $("#splash").hide();
        loading2Show();
        $("#EmptyDiv").hide();

        $("#CreateOrder").hide();
        $("#PayOrder").hide();
        $("#col1").children().remove();
        $("#col2").children().remove();
        $("#col3").children().remove();
        $("#CabinetTable").children().remove();

        startRecord = 0;
        sort = 0;

        currentEvent = "search";

        var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetData",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"desc\":'" + $("#search input.searchtext").val() + "', \"startRecord\":0, \"glue\":'" + $("#MBM1").attr("glue1") + "',  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"minp\":" + $("#minp").val() + ", \"maxp\":" + $("#maxp").val() + ", \"host\":'" + extractHostname(window.location.origin) + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetData
        });
    });

    function bindGetData(data) {
        if (currentEvent == "search") {
            data_status = 0;

            var s_req = $("#search input.searchtext").val();

            var minp = $("#minp").val();

            if (getUrlParameter("minp") != undefined && getUrlParameter("minp") != '') {
                minp = getUrlParameter("minp");
            }


            var maxp = $("#maxp").val();

            if (getUrlParameter("maxp") != undefined && getUrlParameter("maxp") != '') {
                maxp = getUrlParameter("maxp");
            }

            if (s_req == '') {
                s_req = getUrlParameter("s");
            }

            $("#TitleInfo").css("background-color", "#fff");
            $("#TitleInfo").html(($("#MBM1").attr("v16") == "1" ? "Пошук: " : "Поиск: ") + "<span class='SortView'></span><span class='ListView'></span><span class='TableView'></span>");
            $("#CabinetInfo").hide();
            $("#TitleInfo").show();
            $(".SortView").show();


            bindGrid(data);
        }
    }

    $("#search input.searchtext").keyup(function (e) {
        if (e.keyCode == 13) {
            $("#search").hide();
            $("#splash").hide();
            loading2Show();
            $("#EmptyDiv").hide();

            $("#CreateOrder").hide();
            $("#PayOrder").hide();
            $("#col1").children().remove();
            $("#col2").children().remove();
            $("#col3").children().remove();
            $("#CabinetTable").children().remove();

            startRecord = 0;
            sort = 0;

            currentEvent = "search";

            var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"desc\":'" + $("#search input.searchtext").val() + "', \"startRecord\":0, \"glue\":'" + $("#MBM1").attr("glue1") + "',  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"minp\":" + $("#minp").val() + ", \"maxp\":" + $("#maxp").val() + ", \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetData
            });
        }
    });

    $(".moneyboxm").click(function () {

        //if ($.cookie("client_phone") != undefined && $.cookie("client_phone") != null && $.cookie("client_phone") != '') {
        if ($.cookie("c_client_phone") != undefined && $.cookie("c_client_phone") != null && $.cookie("c_client_phone") != '' && $.cookie("c_client") != undefined && $.cookie("c_client") != null && $.cookie("c_client") != '') {
            loadingShow();
            $("#splash").show();
            $("#EmptyDiv").hide();
            $("#CreateOrder").hide();
            $("#PayOrder").hide();

            startRecord = 0;
            sort = 0;
            currentEvent = "clientlog";

            window.history.pushState({}, "", "index.html?sv=3");

            data_status = 10;

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetClientLog",
                data: "{ \"uid\":" +uid_v + ", \"sid\":" + sid_v + ", \"client_id\":" + $("#MainBalance").attr("client_id") + ", \"startRecord\":" + startRecord + ", \"type\":0 }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetClientLog
            });
        }
        else {
            protection_type = 1;
            $("#createaccount").center();
            $("#createaccount").show();
            $("#CreatePhoneNumberLogin").inputmask("+38 999 999 9999");
            $("#splash2").show();
            $("#splash").hide();
        }
    })

    function fillLangContent() {
        if ($("#MBM1").attr("v16") == "1") {

            var items = $("#CabinetTable").find("[uk]");

            for (var i = 0; i < items.length; i++) {
                $(items[i]).html($(items[i]).attr("uk"));
            }

            var items2 = $("#AddictedTable").find("[uk]");

            for (var i = 0; i < items2.length; i++) {
                $(items2[i]).html($(items2[i]).attr("uk"));
            }
        }
    }

    function bindGetClientLog(data) {
        // if (currentEvent == "clientlog")

        $("#ProductsListView").hide();
        $("#col1").children().remove();
        $("#col2").children().remove();
        $("#col3").children().remove();
        
        $(".SortView").hide();

        if (startRecord == 0) {
            $("#TitleInfo").hide();
            $("#CabinetTable").children().remove();
       
            $("#CabinetInfo").html(($("#MBM1").attr("v16") == "1" ? "Мої покупки: " : "Мои покупки: ") + " <span class='ToExcel'> </span><span class='Refresh'></span>");
            $("#CabinetTable").append('<tr><th class="stats" style="width: 90px; text-align: center">Дата</th><th class="stats" style="width: 100%">Товар</th><th class="stats" style="width: 30px; text-align: center" uk="Кіл">Кол</th><th class="stats" style="width: 50px; text-align: center" uk="Ціна">Цена</th><th class="stats" style="width: 75px; text-align: center">Статус</th><th class="stats" style="width: 77px"></th></tr>');
        }

        var dataRows = data.d[0];

        var log_id = 0;

        var ret = ($("#MBM1").attr("v16") == "1" ? "Поверн." : "Возврат");

        var perc = 0;

        custom_perc = false;

        if ($("#MBM1").attr("paramConditions") != undefined && $("#MBM1").attr("paramConditions") != null && $("#MBM1").attr("paramConditions") != '') {

            if ($("#MBM1").attr("paramConditions") == null || $("#MBM1").attr("paramConditions") == '') {
                custom_perc = false;
            }
            else {
                custom_perc = true;
            }
        }

        

        var cur_cheque = -0.1;

        var cur_count = 0;

        for (var i = 0; i < dataRows.length; i++) {

            if (custom_perc) {

                var conditions = $("#MBM1").attr("paramConditions").split("+");

                for (var k = 0; k < conditions.length; k++) {
                    var c_components = conditions[k].split(":");

                    var shop_id = parseInt(c_components[0]);
                    if (shop_id == dataRows[i].Log_data.ShopID || shop_id == 0) {
                        var category_id = parseInt(c_components[1]);

                        if (category_id == dataRows[i].Log_data.CategoryID || category_id == 0) {
                            var value = parseFloat(c_components[2]);
                            var term = c_components[3];
                            var tvalue = parseFloat(c_components[4]);

                            if (term == "<" && dataRows[i].Log_data.Price < value) {
                                perc = tvalue / 100;
                            }
                            else if (term == ">" && dataRows[i].Log_data.Price > value) {
                                perc = tvalue / 100;
                            }
                        }
                    }
                }
            }

            var sale = ($("#MBM1").attr("v16") == "1" ? "Покупка" : "Покупка");


            if (dataRows[i].Status == 0) {
                sale = ($("#MBM1").attr("v16") == "1" ? "Поверн." : "Возврат");
            }
            else if (dataRows[i].Status == 1) {
                sale = ($("#MBM1").attr("v16") == "1" ? "Новий" : "Новый");
            }

            var balance = dataRows[i].Bonus;

            var main_balance = balance - (balance % 1);
            var coins = Math.round((balance % 1) * 100);



            if (dataRows[i].ChequeID != cur_cheque)
            {
                var qr_code = '';

                if (dataRows[i].Fiscal == 1 && dataRows[i].ChequeID != 0) {
                    var cur_d_parts = dataRows[i].LogDateString.split(".");
                    qr_code = '<span class="QR" taxid="' + dataRows[i].ChequeID + '" curd="' + cur_d_parts[2] + cur_d_parts[1] + cur_d_parts[0] + '" />';
                }
                else {
                    //<span ch="' + dataRows[i].ChequeID + '" class="PayBonuses">Сплатити бонусами</span>
                    var pay_buttons = (dataRows[i].Status == 1) ? '<span ch="' + dataRows[i].ChequeID + '" class="PayCard">Сплатити карткою</span>' : "";
                }
                $("#CabinetTable").append('<tr class="ItemContainer"><td class="cheque" colspan="6" chq="' + dataRows[i].ChequeID + '">' + qr_code + ' Чек #' + dataRows[i].ChequeID + ' ' + pay_buttons + '</td></tr>');

                if (cur_count == 0) {
                    var prev_chq_item = $("#CabinetTable").find('[chq="' + cur_cheque + '"]');
                    prev_chq_item.find(".PayCard").remove();
                    //prev_chq_item.find(".PayBonuses").remove();
                }

                cur_cheque = dataRows[i].ChequeID;
                cur_count = 0;
            }

            cur_count += dataRows[i].Log_data.Count;

            var buy_info = '';

            if (dataRows[i].Log_data.Count < 0) {
                if (dataRows[i].Status == 2)
                    buy_info = '<div class="statsbonus"><ul><li><span class="stats" r1="' + dataRows[i].Rate1 + '" r2="' + dataRows[i].Rate2 + '" r3="' + dataRows[i].Rate3 + '" logid="' + dataRows[i].Log_data.ID + '" ></span></li></ul></div>';
                else if (dataRows[i].Status == 1 && data.d[1] == 0)
                    buy_info = '<span class="RejectSpan2" logid="' + dataRows[i].Log_data.ID + '" sid="' + dataRows[i].Log_data.ShopID + '"></span>';
            }

            if (dataRows[i].Bonus > 0) {
                $("#CabinetTable").append('<tr class="ItemContainer"><td class="saled" style="width: 90px; text-align: center">' + dataRows[i].LogDateString + "<br/>" + dataRows[i].ProductTimeString + '</td><td class="saled" width="100%" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">' + dataRows[i].Data.Name + '</td><td class="' + ((dataRows[i].Log_data.Count < 0) ? "plus" : "minus") + '" style="width: 30px;">' + Math.abs(dataRows[i].Log_data.Count) + '</td><td class="saled" style="width: 50px; text-align: center">' + dataRows[i].Log_data.Price + '</td><td class="saled" style="width: 75px; text-align: center" v="Status">' + ((dataRows[i].Log_data.Count < 0) ? sale : ret) + '</td><td class="saled" width="77px">' + buy_info + '</td></tr>');
            }
            else if (dataRows[i].Bonus == 0) {
                $("#CabinetTable").append('<tr class="ItemContainer"><td class="saled" style="width: 90px; text-align: center">' + dataRows[i].LogDateString + "<br/>" + dataRows[i].ProductTimeString + '</td><td class="saled" width="100%" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">' + dataRows[i].Data.Name + '</td><td class="' + ((dataRows[i].Log_data.Count < 0) ? "plus" : "minus") + '" style="width: 30px;">' + Math.abs(dataRows[i].Log_data.Count) + '</td><td class="saled" style="width: 50px; text-align: center">' + dataRows[i].Log_data.Price + '</td><td class="saled" style="width: 75px; text-align: center" v="Status">' + ((dataRows[i].Log_data.Count < 0) ? sale : ret) + '</td><td class="saled" width="77px">' + buy_info + '</td></tr>');
            }
        }

        if (cur_count == 0) {
            var prev_chq_item = $("#CabinetTable").find('[chq="' + cur_cheque + '"]');
            prev_chq_item.find(".PayCard").remove();
            //prev_chq_item.find(".PayBonuses").remove();
        }

        var next_pay = $("#CabinetTable").find('.PayCard').first();
        //loopPayButton(next_pay);

        if (startRecord == 0) {
            $("#CabinetInfo").show();
        }

        startRecord = startRecord + dataRows.length;

        fillLangContent();

        $("#CabinetTable").show();
        $("#createaccount").hide();
        loadingHide();

        if ($("#orderaccepted").css("display") == "none") {
            $("#splash").hide();
        }

        $("#splash2").hide();

        loading2Hide();

        $("#ContentDIV").animate({ scrollLeft: 1000 }, 0);
        $("#ContentDIV").animate({ scrollLeft: 0 }, 500);
    }

    var loop_index = 0;
    var loop_index2 = 0;
    var timer = null;
    var timer2 = null;

    function loadingShow() {
        $("#loading").show();
        timer = setInterval("loopLoading()", 100);
    }

    function loadingHide() {
        $("#loading").hide();
        if (timer != null) {
            clearInterval(timer);
        }
    }

    function loading2Show() {
        $("#loading2").show();
        timer2 = setInterval("loopLoading2()", 100);
    }

    function loading2Hide() {
        $("#loading2").hide();
        if (timer2 != null) {
            clearInterval(timer2);
        }
    }

    function loopLoading() {
      
        if ($("#loading").text() == "Загрузка") {
            $("#loading").html(replaceAt("Загрузка", loop_index, "<span style='color: #666'>" + ("Загрузка")[loop_index] + "</span>"));

            if (loop_index == 6)
                loop_index = 0;
            else
                loop_index++;
        }
        else
        {
            //$("#loading").html($("#loading").text().replace(("Завантаження")[loop_index], "<span style='color: #666'>" + ("Завантаження")[loop_index] + "</span>"));

            $("#loading").html(replaceAt("Завантаження", loop_index, "<span style='color: #666'>" + ("Завантаження")[loop_index] + "</span>"));

            if (loop_index == 11)
                loop_index = 0;
            else
                loop_index++;
        }
    }

    function loopLoading2() {

        if ($("#loading2").text() == "Загрузка") {
            $("#loading2").html(replaceAt("Загрузка", loop_index2, "<span style='color: #666'>" + ("Загрузка")[loop_index2] + "</span>"));

            if (loop_index2 == 6)
                loop_index2 = 0;
            else
                loop_index2++;
        }
        else {
            $("#loading2").html(replaceAt("Завантаження", loop_index2, "<span style='color: #666'>" + ("Завантаження")[loop_index2] + "</span>"));

            if (loop_index2 == 11)
                loop_index2 = 0;
            else
                loop_index2++;
        }
    }

    function replaceAt(s, n, t) {
        return s.substring(0, n) + t + s.substring(n + 1);
    }

    //function loopPayButton(pay_button) {
    //    pay_button.css({ "background-color": "#000000" }).animate({ "background-color": "#333333" }, 1000, 'linear', function () {
    //        loopPayButton(pay_button);
    //    });
    //}

    $("#CabinetTable").delegate('.PayCard', 'click', function () {

        $("#splash").show();
        loadingShow();

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/PayCard",
            data: "{ \"uid\":" + uid_v + ", \"cheque\":" + $(this).attr("ch") + " }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindPayCard
        });
    });

    function bindPayCard(data) {
        $("#PayOrder").children().remove();
        $("#PayOrder").hide();

        if (data.d[2] == "1") {
            window.location.replace("https://xpool.pro/payment/redirect.aspx?uid=" + uid_v + "&amount=" + data.d[0] + "&order_id=" + data.d[1] + "&sid=" + sid_v + "&host=" + extractHostname(window.location.origin));
        }
        else {
            $("#splash").hide();
            loadingHide();
            alert("Замовлення втратило актуальність");
        }
    }

    function bindPayCard2(data) {
        //$("#PayOrder").children().remove();
        $("#PayOrder").hide();

        if (data.d[2] == "1") {
            window.location.replace("https://xpool.pro/payment/redirect.aspx?uid=" + uid_v + "&id=" + data.d[1] + "&p=" + $("#PrepaySum").html().replace("грн", "") + "&host=" + extractHostname(window.location.origin));
        }
        else {
            $("#splash").hide();
            loadingHide();
            alert("Замовлення втратило актуальність");
        }
    }

    function ConvertPhone(phone_num) {
        var phone_parts = phone_num.split(" ");

        return phone_parts[0] + " (" + phone_parts[1] + ") " + phone_parts[2] + "-" + phone_parts[3];
    }

    $("#CabinetTable").delegate('.PayBonuses', 'click', function () {

        $("#splash").show();
        loadingShow();

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/PayBonuses",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"cheque\":" + $(this).attr("ch") + ", \"client_phone\":'" + ConvertPhone($.cookie("c_client_phone")) + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindPayBonuses
        });
    });

    function bindPayBonuses(data) {

        if (data.d[2] == "") {
            var main_balance = data.d[0] - (data.d[0] % 1);
            var coins = Math.round((data.d[0] % 1) * 100);

            $(".mainbalance").attr("balance", data.d[0].toFixed(2));
            $(".mainbalance").html(main_balance);
            $(".coins").html(coins);
        }
        else
            alert(data.d[2]);


        $("#splash").hide();
        loadingHide();

        $(".moneyboxm").click();

    }

    $("#ProductsListView").delegate('.rate1', 'click', function () {
        if (parseInt($("div.menu span.heartcount").html()) < 50) {
            $("div.menu span.heartcount").html(function (i, oldval) {
                return ++oldval;
            });

            var date = new Date();
            var minutes = 60;
            var hours = 24;
            var days = 365;
            date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

           
            var code = $(this).attr("code");
            if ($.cookie("c_favors") != undefined && $.cookie("c_favors") != null && $.cookie("c_favors") != '' && $.cookie("c_favors").indexOf(":" + code + ":") == -1) {
                $.cookie("c_favors", $.cookie("c_favors") + ":" + code + ":", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            }
            else {
                $.cookie("c_favors", ":" + code + ":", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            }
            $(this).attr("class", "rate2");

            var leftPos = $('#MenuDIV').scrollLeft();
            $("#MenuDIV").animate({ scrollLeft: leftPos + 500 }, 300);

            $(".heartcount").css({ "background-color": "#FFFF00", "borderColor": "#FFFF00" }).animate({ backgroundColor: "#FFFFFF", "border-color": "#FF0000" }, 1000);
        }
        else {
            $("#favover").center();
            $("#favover").show();
            $("#splash").show();
        }
    });

    $("#ProductsListView").delegate('.rate2', 'click', function () {
        $("div.menu span.heartcount").html(function (i, oldval) {
            return --oldval;
        });

        var date = new Date();
        var minutes = 60;
        var hours = 24;
        var days = 365;
        date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

        var code = $(this).attr("code");
        if ($.cookie("c_favors") != undefined && $.cookie("c_favors") != null && $.cookie("c_favors") != '') {
            $.cookie("c_favors", $.cookie("c_favors").replace(":" + code + ":", ""), { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
        }

        $(this).attr("class", "rate1");
    });


    $("#ProductsListView").delegate('.cart', 'click', function () {
        var date = new Date();
        var minutes = 60;
        var hours = 24;
        var days = 365;
        date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

        if ($(this).children().first().attr("class") == "cart1") {

            if (parseInt($("div.menu span.mcartcount").html()) < 100) {

                var count_change = 0;

                var code = $(this).children().first().attr("code");
                var cur_sid = $(this).children().first().attr("sid");

                if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '' && $.cookie("c_cart").indexOf(":" + code + "+") != -1) {
                    var parts = $.cookie("c_cart").split(":");

                    for (var i = 0; i < parts.length; i++) {
                        if (parts[i].indexOf(code + "+") != -1) {
                            $.cookie("c_cart", $.cookie("c_cart").replace(":" + parts[i] + ":", ":" + code + "+" + $(this).closest('.product').find(".timeselect option:selected").attr("v") + "#1#" + cur_sid + ":"), { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                        }
                    }

                    count_change = -1;

                    if ($(this).closest('.product').find(".price").attr("lp") != undefined) {
                        if ($(".cartsum").html() != undefined) {

                            var pl_price;

                            if ($(this).closest('.product').find(".price").html() == undefined)
                                pl_price = parseFloat($(this).closest('.product').find(".oldprice").attr("lp"));
                            else
                                pl_price = parseFloat($(this).closest('.product').find(".price").attr("lp"));

                            $(".cartsum").html((parseFloat($(".cartsum").html()) - parseFloat($(this).closest('.product').find(".val").text()) * pl_price).toFixed(2).toString() + "<span>грн</span>");
                        }
                    }
                }
                else if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '' && $.cookie("c_cart").indexOf(":" + code + "#") == -1) {
                    var time = $(this).closest('.product').find(".timeselect option:selected").attr("v") != undefined ? "+" + $(this).closest('.product').find(".timeselect option:selected").attr("v") : "";
                    $.cookie("c_cart", $.cookie("c_cart") + ":" + code + time + "#1#" + cur_sid + ":", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                }
                else {
                    var time = $(this).closest('.product').find(".timeselect option:selected").attr("v") != undefined ? "+" + $(this).closest('.product').find(".timeselect option:selected").attr("v") : "";
                    $.cookie("c_cart", ":" + code + time + "#1#" + cur_sid + ":", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                }

                /////////////////////////////
                if ($(".cartsum").html() != undefined) {

                    var p_price;

                    if ($(this).closest('.product').find(".price").html() == undefined)
                        p_price = parseFloat($(this).closest('.product').find(".oldprice").text());
                    else
                        p_price = parseFloat($(this).closest('.product').find(".price").text());

                    $(".cartsum").html((parseFloat($(".cartsum").html()) + parseFloat($(this).closest('.product').find(".val").text()) * p_price).toString() + "<span>грн</span>");
                }

                $(this).children().first().attr("class", "cart2");
                $(this).find(".tocart").html($("#MBM1").attr("v16") == "1" ? "Видалити" : "Убрать");

                $("div.menu span.mcartcount").html(function (i, oldval) {
                    return ++oldval + count_change;
                });

                var leftPos = $('#MenuDIV').scrollLeft();
                $("#MenuDIV").animate({ scrollLeft: leftPos + 500 }, 300);

               

                $(".mcartcount").css({ "background-color": "#FFFF00", "border": "solid 2px #FFFF00" }).animate({ backgroundColor: "#FFFFFF", borderColor: "#FF9400" }, 1000);
            }
            else {
                $("#cartover").center();
                $("#cartover").show();
                $("#splash").show();
            }
        }
        else {
            $("div.menu span.mcartcount").html(function (i, oldval) {
                return --oldval;
            });

            var code = $(this).children().first().attr("code");
            if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '') {

                var parts = $.cookie("c_cart").split(":");

                for (var i = 0; i < parts.length; i++) {
                    if (parts[i].indexOf(code + "#") != -1 || parts[i].indexOf(code + "+") != -1) {

                        var p_price;

                        if ($(this).closest('.product').find(".price").html() == undefined)
                            p_price = parseFloat($(this).closest('.product').find(".oldprice").text());
                        else
                            p_price = parseFloat($(this).closest('.product').find(".price").text());

                        if ($(".cartsum").html() != undefined)
                            $(".cartsum").html((parseFloat($(".cartsum").html()) - parseFloat($(this).closest('.product').find(".val").text()) * p_price).toFixed(2).toString() + "<span>грн</span>");

                        var c = $.cookie("c_cart");

                        $.cookie("c_cart", c.replace(":" + parts[i] + ":", ""), { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                    }
                }
            }

            $(this).children().first().attr("class", "cart1");
            $(this).find(".tocart").html($("#MBM1").attr("v16") == "1" ? "Купити" : "Купить");
        }
    });

    $("#ProductsListView").delegate('.cart2', 'click', function () {

    });


    $("#menu span.close").click(function () {
        $("#menu").hide();
        $("#splash").hide();
    });

    $("#login span.loginclose").click(function () {
        $("#login").hide();
        $("#splash").hide();
    });

    var selected_cat = '';

    $("div.menu span.catalog").click(function () {
        $("#splash").show();
        loadingShow();

        $("#TitleInfo").hide();
        $("#CreateOrder").hide();
        $("#PayOrder").hide();
        $("#EmptyDiv").hide();
        $("#CabinetTable").children().remove();
        $("#ProductsListView").hide();

        data_status = 11;

        sort = 0;
        startRecord = 0;

        selected_cat = getUrlParameter("cat") != undefined ? getUrlParameter("cat").replace(/_/g, " ") : '';

       // alert(getUrlParameter("catsid"));

        if (getUrlParameter("ssid") != undefined && getUrlParameter("ssid") != "") {
            $("#splash2").show();
            loadingShow();

            //alert(getUrlParameter("cat"));

            if (getUrlParameter("cat").indexOf("/") == -1) {

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetMainCats",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + getUrlParameter("ssid") + " }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetMainCats
                });

            }
            else {

                startRecord = 0;
                sort = 0;
                currentEvent = "subcats";

                data_status = 2;

                var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

                var p_info = getUrlParameter("cat").split("/");

                var last_part = p_info[p_info.length - 1];

                var index = getUrlParameter("cat").indexOf("/" + last_part);

                var path = getUrlParameter("cat");

                if (index != 0)
                    path = getUrlParameter("cat").slice(0, index);

                //alert(path);

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetSubCats",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + getUrlParameter("ssid") + ", \"path\":'" + path.replace(/_/g, " ") + "', \"status\":0, \"startRecord\":0, \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetSubCats
                });
            }
        }
        else {
            if ($("#MBM1").attr("glue1") != getUrlParameter("sid") + "=") {
                $("#ShopsMenu").children().eq(1).children().remove();

                var shop_ids = $("#MBM1").attr("glue1").split("=");
                var shop_names = $("#MBM1").attr("glue2").split("=");

                var new_line = '';

                for (var i = 0; i < shop_names.length - 1; i++) {

                    var selected_shop = (parseInt(shop_ids[i]) == sid_v && extractHostname(window.location.origin).indexOf("monstro.com.ua") != -1) ? "style='background-color: #9999FF'" : "";

                    $("#CabinetTable").append('<tr class="ItemContainer"><td class="category1" sid="' + shop_ids[i] + '"' + selected_shop  + '>' + shop_names[i] + '</td></tr>');
                }

                $("#TitleInfo").hide();

                $("#CabinetTable").show();

                loadingHide();
                loading2Hide();
                $("#splash").hide();
                SetView();

                window.history.pushState({}, "", "index.html?catalog=1");

                $("#ContentDIV").animate({ scrollLeft: 1000 }, 0);
                $("#ContentDIV").animate({ scrollLeft: 0 }, 500);

                $("#MenuDIV").animate({ scrollLeft: 1000 }, 0);
                $("#MenuDIV").animate({ scrollLeft: $('.catalog').position().left - window.innerWidth / 2 + 25 }, 500);
            }
            else {
                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetMainCats",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + " }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetMainCats
                });
            }
        }
    });

    $("#CabinetTable").delegate('td.category3', "click", function () {
        $("#splash").show();
        loadingShow();

        var last_path = $("#CabinetTable").find('.ItemContainer').last().children().first().attr("path");
        var cur_sid = $("#CabinetTable").find('.ItemContainer').last().children().first().attr("sid");
     
        $("#CabinetTable").children().remove();
        $("#ProductsListView").hide();

        data_status = 11;

        sort = 0;
        startRecord = 0;
  
        var last_path_parts = last_path.split("/");

        if (last_path_parts.length > 2) {
           
            currentEvent = "subcats";

            data_status = 2;

            var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

            var last_part = last_path_parts[last_path_parts.length - 1];

            var index = last_path.indexOf("/" + last_path_parts[last_path_parts.length - 2] + "/Прочее");

            var path = last_path;

            if (index != 0)
                path = last_path.slice(0, index);

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetSubCats",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + cur_sid + ", \"path\":'" + path.replace(/_/g, " ") + "', \"status\":0, \"startRecord\":0, \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetSubCats
            });
        }
        else {
            if (last_path_parts.length == 2) {
                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetMainCats",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + cur_sid + " }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetMainCats
                });
            }
            else if ($("#MBM1").attr("glue1") != getUrlParameter("sid") + "=") {
                $("#ShopsMenu").children().eq(1).children().remove();

                var shop_ids = $("#MBM1").attr("glue1").split("=");
                var shop_names = $("#MBM1").attr("glue2").split("=");

                var new_line = '';

                for (var i = 0; i < shop_names.length - 1; i++) {

                    var selected_shop = (parseInt(shop_ids[i]) == sid_v && extractHostname(window.location.origin).indexOf("monstro.com.ua") != -1) ? "style='background-color: #9999FF'" : "";

                    $("#CabinetTable").append('<tr class="ItemContainer"><td class="category1" sid="' + shop_ids[i] + '"' + selected_shop + '>' + shop_names[i] + '</td></tr>');
                }

                $("#TitleInfo").hide();

                $("#CabinetTable").show();

                loadingHide();
                loading2Hide();
                $("#splash").hide();
                SetView();

                window.history.pushState({}, "", "index.html?catalog=1");
            }
           
        }
    });


    $("#CabinetTable").delegate('td.category1', "click", function () {

        if (extractHostname(window.location.origin).indexOf("monstro.com.ua") != -1) {
            sid_v = $(this).attr("sid");

           
            var cart = $.cookie("c_cart");

            if (cart != undefined && cart != null && cart != "") {

                var date = new Date();
                var minutes = 60;
                var hours = 24;
                var days = 365;
                date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                if (parseInt(cart.split(":")[0].split("#")[2]) != sid_v) {
                    $.cookie("c_cart", "", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                    $(".mcartcount").html("0");
                }
            }
        }

        $("#splash2").show();
        loadingShow();

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetMainCats",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(this).attr("sid") + " }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetMainCats
        });
    });

    $("#CabinetTable, #TitleInfo").delegate('td.category2, span.TitleSpan', "click", function () {
        $("#splash2").show();
        loadingShow();

        startRecord = 0;
        sort = 0;
        currentEvent = "subcats";

        data_status = 2;

        var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetSubCats",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(this).attr("sid") + ", \"path\":'" + $(this).attr("path") + "', \"status\":0, \"startRecord\":0, \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetSubCats
        });
    })

    //$("#SubCatMenu, #TitleInfo").delegate('td.category2, span.TitleSubSpan', "click", function () {
    //    $("#splash2").show();
    //    loadingShow();

    //    startRecord = 0;
    //    sort = 0;
    //    currentEvent = "subcats2";

    //    data_status = 3;

    //    var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

    //    $.ajax({
    //        async: true,
    //        type: "POST",
    //        url: "https://xpool.pro/web/webform.aspx/GetSubCats",
    //        data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(this).attr("sid") + ", \"path\":'" + $(this).attr("path") + "', \"status\":1, \"startRecord\":0, \"sort\":" + sort + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
    //        contentType: "application/json; charset=utf-8",
    //        dataType: "json",
    //        success: bindGetSubCats2
    //    });
    //})

    $("body").delegate('span.close', "click", function () {
        if ($("#splash2").css('display') == 'none') {
            $(this).parent().parent().parent().parent().hide()
            $("#splash").hide();
        }
        else {
            $(this).parent().parent().parent().parent().hide();
            $("#splash2").hide();
        }
    });

    window.onpopstate = function (event) {
       
        window.location.replace(document.location);
    }

    function bindGetMainCats(data) {

        $("#CabinetTable").children().remove();  
        $("#ProductsListView").hide();

        $("#TitleInfo").hide();
      
        data_status = 11;

        var dataRows = data.d[0];
    
        window.history.pushState({}, "", "index.html?catsid=" + dataRows[0][2]);


        $("#MainCatMenu").children().eq(1).children().remove();

        $("#CabinetTable").append('<tr class="ItemContainer"><td class="category3">Назад</td></tr>');

        for (var i = 0; i < dataRows.length; i++) {

            var selected_tr = (selected_cat == dataRows[i][0]) ? "style='background-color: #9999FF'" : "";

            //if (dataRows[i][0] == "Все" && $("#MBM1").attr("v16") == "1") {
            //    dataRows[i][0] = "Усе";
            //}
            //else if (dataRows[i][0] == "Прочее" && $("#MBM1").attr("v16") == "1") {
            //    dataRows[i][0] = "Інше";
            //}

            if (dataRows[i][0] != "Все" && dataRows[i][0] != "Прочее") {
                $("#CabinetTable").append('<tr class="ItemContainer"><td class="category2" ' + selected_tr + ' path="' + dataRows[i][1] + '" sid="' + dataRows[i][2] + '">' + dataRows[i][0] + '</td></tr>');
            }
        }

        loadingHide();
        $("#splash2").hide();
        SetView();

        //////////////////////////   

        startRecord = 0;

        fillLangContent();

        $("#CabinetTable").show();
        $("#createaccount").hide();
        loadingHide();

        if ($("#orderaccepted").css("display") == "none") {
            $("#splash").hide();
        }

        $("#splash2").hide();

        loading2Hide();

        $("#ContentDIV").animate({ scrollLeft: 1000 }, 0);
        $("#ContentDIV").animate({ scrollLeft: 0 }, 500);

        $("#MenuDIV").animate({ scrollLeft: 1000 }, 0);
        $("#MenuDIV").animate({ scrollLeft: $('.catalog').position().left - window.innerWidth / 2 + 25 }, 500);
       
    }

    function bindGetSubCats(data) {

        if (currentEvent == "subcats") {
            var dataRows = data.d[1];

            selected_cat = getUrlParameter("cat") != undefined ? getUrlParameter("cat").replace(/_/g, " ") : '';
           
            window.history.pushState({}, "", "index.html?ssid=" + data.d[4] + "&cat=" + data.d[0].replace(/ /g, "_"));

            if (data.d[1].length > 2) {
                $("#CabinetTable").children().remove();
                $("#ProductsListView").hide();

                $("#TitleInfo").hide();

                data_status = 11;

                var dataRows = data.d[1];

                window.history.pushState({}, "", "index.html?catsid=" + dataRows[0][2]);


                $("#MainCatMenu").children().eq(1).children().remove();

                $("#CabinetTable").append('<tr class="ItemContainer"><td class="category3">Назад</td></tr>');

                for (var i = 0; i < dataRows.length; i++) {
                    var selected_tr = (selected_cat == dataRows[i][1]) ? "style='background-color: #9999FF'" : "";

                    if (dataRows[i][0] == "Все" && $("#MBM1").attr("v16") == "1") {
                        dataRows[i][0] = "Усе";
                    }
                    else if (dataRows[i][0] == "Прочее" && $("#MBM1").attr("v16") == "1") {
                        dataRows[i][0] = "Інше";
                    }

                    $("#CabinetTable").append('<tr class="ItemContainer"><td class="category2" ' + selected_tr + ' path="' + dataRows[i][1] + '" sid="' + dataRows[i][2] + '">' + dataRows[i][0] + '</td></tr>');
                }

                loadingHide();
                $("#splash2").hide();
                SetView();

                //////////////////////////   

                startRecord = 0;

                fillLangContent();

                $("#CabinetTable").show();
                $("#createaccount").hide();
                loadingHide();

                if ($("#orderaccepted").css("display") == "none") {
                    $("#splash").hide();
                }

                $("#splash2").hide();

                loading2Hide();

                $("#ContentDIV").animate({ scrollLeft: 1000 }, 0);
                $("#ContentDIV").animate({ scrollLeft: 0 }, 500);

                $("#MenuDIV").animate({ scrollLeft: 1000 }, 0);
                $("#MenuDIV").animate({ scrollLeft: $('.catalog').position().left - window.innerWidth / 2 + 25 }, 500);
            }
            else {
                loading2Show();
                $("#EmptyDiv").hide();
                $('#MainCatMenu').hide();
                $('#SubCatMenu').hide();
                $('#splash2').hide();

                var title_cat = data.d[0];

                if (title_cat == "Все" && $("#MBM1").attr("v16") == "1") {
                    title_cat = "Усе";
                }
                else if (title_cat == "Прочее" && $("#MBM1").attr("v16") == "1") {
                    title_cat = "Інше";
                }

                $("#TitleInfo").css("background-color", "#fff");

                var title_span = '<span class="TitleSpan" path="' + data.d[0] + '" sid="' + data.d[4] + '">' + title_cat + '</span>';

                if (window.innerWidth < 500)
                    title_span = '<span class="TitleSpan" style="width: 200px;" path="' + data.d[0] + '" sid="' + data.d[4] + '">' + title_cat + '</span>';

                $('#TitleInfo').html(title_span + ':<span class="SortView"></span><span class="ListView"></span><span class="TableView"></span>');
                $("#CabinetInfo").hide();
                $("#TitleInfo").show();
                $(".SortView").show();
                bindGrid(data);
            }
        }
    }

    function bindGetSubCats2(data) {

        if (currentEvent == "subcats2" || currentEvent == "subcats") {

            $('#MainCatMenu').hide();
            $('#SubCatMenu').hide();
            $('#splash2').hide();

            var parts = data.d[0].split("/");

            $("#TitleInfo").css("background-color", "#fff");
            $('#TitleInfo').html('<span class="TitleSpan" path="' + parts[0] + '" sid="' + data.d[4] + '">' + parts[0] + '</span> / <span class="TitleSubSpan" path="' + data.d[0] + '" sid="' + data.d[4] + '">' + parts[1] + '</span><span class="SortView"></span><span class="ListView"></span><span class="TableView"></span>');
            $("#CabinetInfo").hide();
            $("#TitleInfo").show();
            $(".SortView").show();


            bindGrid(data);
        }
    }

    //$("div.works2 span.catalog").click(function () {
    //    $("#menustore").show();
    //    $("#splash").show();
    //});

    //$("div.menu span.moneyboxm").click(function () {
    //    $("#CardNum").inputmask("9999-9999-9999-9999");

    //    $("#OrderMoney").html('<a style="color: #fff; text-decoration: none" href="viber://chat/?number=%2B' + $("#MBM1").attr("v10").replace("+", "").replace("(", "").replace(")", "").replace(" ", "").replace(" ", "").replace("-", "") + '">Заказать выплату</a>');
    //    $("#splash").show();
    //});

    $("div.menu span.info").click(function () {
        $("#splash").show();
        loadingShow();

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetShopInfo",
            data: "{ \"uid\":" +uid_v + ", \"sid\":" + sid_v + " }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetShopInfo
        });
    });

    $("#ProductsListView").delegate('.pickup', 'click', function () {
        $("div.menu span.info").click();
    });

    function bindGetShopInfo(data) {
        if (data.d != null) {
            if (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") == -1) {
                $(".mapinfo").html(data.d.Desc);
            }
            $(".timedesc").html(data.d.WorkTime);
        }

        loadingHide();
        //$("#about").center();
        $("#about").show();
    }

    $("#about span.close").click(function () {
        $("#about").hide();
        $("#splash").hide();

        if (init_status == 1) {
            $("#MenuDIV").animate({ scrollLeft: 1000 }, 0);
            $("#MenuDIV").animate({ scrollLeft: 0 }, 500);
            init_status = 0;
        }
        
    });

    $("div.menu span.search").click(function () {

        
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            $("#search").css({
                top:  '120px'
            });
        }
  
        $("#search").show();
        $("#splash").show();

    });

    ////$("div.works2 span.search").click(function () {
    ////    $("#searchstore").show();
    ////    $("#splash").show();
    ////});

    $("#search span.close").click(function () {
        $("#search").hide();
        $("#splash").hide();
    });

    //$("div.menu span.storecatalog").click(function () {
    //    $("#menustore").show();
    //    $("#splash").show();
    //});

    //$("#menustore span.close").click(function () {
    //    $("#menustore").hide();
    //    $("#splash").hide();
    //});

    //$("div.menu span.storesearch").click(function () {
    //    $("#searchstore").show();
    //    $("#splash").show();
    //});

    //$("#searchstore span.close").click(function () {
    //    $("#searchstore").hide();
    //    $("#splash").hide();
    //});

    $("#ProductsListView").delegate('.showprice', 'click', function () {
        $("#vipaccess").center();
        $("#vipaccess").show();
        $("#splash").show();
    });

    $("#ProductsListView").delegate('.showprice2', 'click', function () {
        $("#vipaccess").center();
        $("#vipaccess").show();
        $("#splash").show();
    });

    //$("div.menu span.bonus").click(function () {
    //    $("#vipaccess").show();
    //    $("#splash").show();
    //});

    //$("div.menu span.storecart").click(function () {
    //    if ($("#ctl00_KeyValue").attr("value") != undefined) {
    //        if ($.cookie("phone") != undefined && $.cookie("phone") != null && $.cookie("phone") != '') {
    //            window.location.replace("http://xn--80atad5a1f.in.ua/default.aspx?cat=5");
    //            return false;
    //        }
    //        else {
    //            protection_type = 2;

    //            $("#protector").show();
    //            $("#splash2").show();
    //        }
    //    }
    //    else {
    //        $("#vipaccess").show();
    //        $("#splash").show();
    //    }
    //});

    $("#vipaccess span.close").click(function () {
        $("#vipaccess").hide();
        $("#splash").hide();
    });

    $("#favover span.close").click(function () {
        $("#favover").hide();
        $("#splash").hide();
    });

    $("#orderover span.close").click(function () {
        $("#orderover").hide();
        $("#splash").hide();
    });

    $("#viewer span.closey").click(function () {
        $('html, body').css({
            overflow: 'auto',
            height: 'auto'
        });
        $("#vpo").attr("content", "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0");
        $('.findPhoto2').remove();

        $("#fullimage").attr("src", "https://xpool.pro/web/source/style_blot/img/loading.gif");
        $("#viewer").hide();
        $("#splash").hide();
        var $target = $('html,body');
        $target.animate({ scrollTop: selected.offset().top + $("#ProductsListView").offset().top + selected.outerHeight() / 2 - 120 - $(window).height() / 2 }, 0);
        selected.css({ "border": "solid 2px #FF0000" }).animate({ borderColor: "#000000" }, 1000);
    });

    $("#UserKey").click(function () {
        $("#login").center();
        $("#LoginPhoneNumber").inputmask("+38 999 999 9999");
        $("#login").show();
        $("#splash").show();
    });

    $("#LoginSubmit").click(function () {
        loadingShow();
        $("#login").hide();

        currentEvent = "login";

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetClient",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"phone\":'" + ConvertPhone($("#LoginPhoneNumber").val()) + "', \"key\":'" + $("#LoginKey").val() + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetClient
        });
    })

    function bindGetClient(data) {

        if (currentEvent == "login") {
            if (data.d != null) {

                var date = new Date();
                var minutes = 60;
                var hours = 24;
                var days = 365;
                date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                if (data.d.paramPhone == null) {
                    $("#splash").show();
                    $("#createaccount").center();
                    $("#createaccount").show();
                    $("#CreatePhoneNumberLogin").inputmask("+38 999 999 9999");
                }
                else {
                    $.cookie("c_client_phone", data.d.paramPhone, { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                }

                if ($("#UserKey").attr("class") == "keyerror")
                    $("#UserKey").attr("class", "key");

                var balance = data.d.Credit - data.d.Debit;

                var main_balance = balance - (balance % 1);
                var coins = Math.round((balance % 1) * 100);

                $("#MBM1").html("<span id=\"MainBalance\" client_id=\"" + data.d.ID + "\" class=\"mainbalance\" balance=\"" + balance.toFixed(2) + "\">" + main_balance + "</span><span class=\"coins\">" + coins + "</span>");
                $("#MBM1").attr("paramConditions", data.d.paramConditions);

                $("#MValue1").html(main_balance);
                $("#MValue12").html(coins);
                $("#MValue2").html(balance.toFixed(2));

                if (data.d.Name.indexOf("R") >= 0) {
                    $("#ExitLi").hide();
                }


                $("#KeyLi").hide();
                $("#KeyLi").children().first().val("");
                $("#ExitLi").show();
                $("#MoneyBoxLi").show();

                if ($.cookie("c_client") == undefined || $.cookie("c_client") == null || $.cookie("c_client") == '') {
                    $.cookie("c_client", data.d.Name, { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                }
            }
            else {
                $("#UserKey").val("");
                $("#UserKey").attr("class", "keyerror");
                loadingHide();
                $("#splash").hide();

                if ($.cookie("c_client") != undefined && $.cookie("c_client") != null && $.cookie("c_client") != '') {

                    $.removeCookie("c_client", { path: '/', domain: '.' + document.domain });
                    $.removeCookie("c_client_phone", { path: '/', domain: '.' + document.domain });
                    $.removeCookie("c_cart", { path: '/', domain: '.' + document.domain });
                    $.removeCookie("c_comments", { path: '/', domain: '.' + document.domain });
                    $.removeCookie("c_ctime", { path: '/', domain: '.' + document.domain });
                }
            }

            loading2Show();
            $("#EmptyDiv").hide();

            $("#CreateOrder").hide();
            $("#PayOrder").hide();
            $("#col1").children().remove();
            $("#col2").children().remove();
            $("#col3").children().remove();
            $("#CabinetTable").children().remove();

            sort = 0;
            startRecord = 0;

            var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

            if (getUrlParameter("s") != '' && getUrlParameter("s") != undefined) {

                data_status = 0;
                currentEvent = "search";

                var ssid = sid_v;

                if (getUrlParameter("ssid") != '' && getUrlParameter("ssid") != undefined) {
                    ssid = getUrlParameter("ssid");
                }

                var minp = $("#minp").val();

                if (getUrlParameter("minp") != undefined && getUrlParameter("minp") != '') {
                    minp = getUrlParameter("minp");
                }


                var maxp = $("#maxp").val();

                if (getUrlParameter("maxp") != undefined && getUrlParameter("maxp") != '') {
                    maxp = getUrlParameter("maxp");
                }

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetData",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + ssid + ", \"desc\":'" + getUrlParameter("s") + "', \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "',  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"minp\":" + minp + ", \"maxp\":" + maxp + ", \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetData
                });
            }
            else if (getUrlParameter("id") != '' && getUrlParameter("id") != undefined) {

                if (extractHostname(window.location.origin).indexOf("monstro.com.ua") != -1 && getUrlParameter("sid") != '' && getUrlParameter("sid") != undefined) {
                    uid_v = 48;
                    sid_v = getUrlParameter("sid");
                }

                data_status = 0;
                currentEvent = "search";

                var ssid = sid_v;

                var minp = $("#minp").val();

                if (getUrlParameter("minp") != undefined && getUrlParameter("minp") != '') {
                    minp = getUrlParameter("minp");
                }


                var maxp = $("#maxp").val();

                if (getUrlParameter("maxp") != undefined && getUrlParameter("maxp") != '') {
                    maxp = getUrlParameter("maxp");
                }

                var id = getUrlParameter("id");

                var href1 = removeParam("minp", window.location.href);
                href1 = removeParam("maxp", href1);
                href1 = removeParam("id", href1);
                //href1 = href1.replace("https://www.xpool.pro", '');

                //window.history.pushState({}, "https://www.xpool.pro", href1);

                //if (getUrlParameter("cart") == "1") {


                    var date = new Date();
                    var minutes = 60;
                    var hours = 24;
                    var days = 365;
                    date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                    $.cookie("c_cart", ":" + id + "#1#" + sid_v + ":", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                    $(".cartsum").html("1");

                    $("#CartCount").click();
                //}
                //else {
                //    $.ajax({
                //        async: true,
                //        type: "POST",
                //        url: "https://xpool.pro/web/webform.aspx/GetData",
                //        data: "{ \"uid\":" + uid_v + ", \"sid\":" + ssid + ", \"desc\":'$" + id + "', \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "',  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"minp\":" + minp + ", \"maxp\":" + maxp + " }",
                //        contentType: "application/json; charset=utf-8",
                //        dataType: "json",
                //        success: bindGetData
                //    });
                //}
            }
            else if (getUrlParameter("cat") != '' && getUrlParameter("cat") != undefined) {

                data_status = 2;
                currentEvent = "subcats";

                var ssid = sid_v;

                //if (getUrlParameter("ssid") != '' && getUrlParameter("ssid") != undefined) {
                //    ssid = getUrlParameter("ssid");
                //}

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetSubCats",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + ssid + ", \"path\":'" + getUrlParameter("cat").replace(/_/g, " ") + "', \"status\":1, \"startRecord\":" + startRecord + ",  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetSubCats
                });
            }
            else if (getUrlParameter("feed") == "google") {
                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetGoogleFeedData",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetGoogleFeedData
                });
            }
            else if ($("#MBM1").attr("v6") == "0") {

                data_status = 1;
                currentEvent = "new";

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetNewData",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetNewData
                });
            }
            else if ($("#MBM1").attr("v6") == "1") {

                data_status = 4;
                currentEvent = "best";

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetTopRatedData",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetTopRatedData
                });
            }
            else if ($("#MBM1").attr("v6") == "2") {

                data_status = 5;
                currentEvent = "discount";

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetTopDiscount",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetTopDiscount
                });
            }
        }
    }

    $("#ExitLi").click(function () {
        $("#KeyLi").show();
        $("#ExitLi").hide();
        $("#MoneyBoxLi").hide();

        $.removeCookie("c_client", { path: '/', domain: '.' + document.domain });
        $.removeCookie("c_client_phone", { path: '/', domain: '.' + document.domain });
        $.removeCookie("c_cart", { path: '/', domain: '.' + document.domain });
        $.removeCookie("c_comments", { path: '/', domain: '.' + document.domain });
        $.removeCookie("c_ctime", { path: '/', domain: '.' + document.domain });

        window.location.replace("https://" + extractHostname(window.location.origin));
    });

    $(".new").click(function () {
        loading2Show();
        $("#EmptyDiv").hide();
        $("#CreateOrder").hide();
        $("#PayOrder").hide();
        $("#col1").children().remove();
        $("#col2").children().remove();
        $("#col3").children().remove();
        $("#CabinetTable").children().remove();

        sort = 0;
        startRecord = 0;
        currentEvent = "new";

        data_status = 1;


        window.history.pushState({}, "", "index.html?sv=0");

        var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetNewData",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetNewData
        });
    });

    function bindGetNewData(data) {
        if (currentEvent == "new") {
            $("#TitleInfo").css("background-color", "#fff");
            $('#TitleInfo').html(($("#MBM1").attr("v16") == "1" ? "Новинки: " : "Новинки: ") + "<span class='SortView'></span><span class='ListView'></span><span class='TableView'></span>");
            $("#CabinetInfo").hide();
            $("#TitleInfo").show();
            $(".SortView").show();

            bindGrid(data);
        }
    }

    function bindGetGoogleFeedData(data) {
        $("#TitleInfo").css("background-color", "#fff");
        $('#TitleInfo').html(($("#MBM1").attr("v16") == "1" ? "Google Фід: " : "Google Фид: ") + "<span class='SortView'></span><span class='ListView'></span><span class='TableView'></span>");
        $("#CabinetInfo").hide();
        $("#TitleInfo").show();
        $(".SortView").show();

        bindGrid(data);
    }

    $(".best").click(function () {
        loading2Show();
        $("#EmptyDiv").hide();
        $("#CreateOrder").hide();
        $("#PayOrder").hide();
        $("#col1").children().remove();
        $("#col2").children().remove();
        $("#col3").children().remove();
        $("#CabinetTable").children().remove();
        $(".SortView").hide();

        sort = 0;
        startRecord = 0;
        currentEvent = "best";

        data_status = 4;

        var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

        window.history.pushState({}, "", "index.html?sv=1");

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetTopRatedData",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":0, \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetTopRatedData
        });
    });

    function bindGetTopRatedData(data) {

        if (currentEvent == "best") {
            $("#TitleInfo").css("background-color", "#fff");
            $('#TitleInfo').html(($("#MBM1").attr("v16") == "1" ? "Хіти: " : "Хиты: ") + "<span class='ListView'></span><span class='TableView'></span>");
            $("#CabinetInfo").hide();
            $("#TitleInfo").show();

            bindGrid(data);
        }
    }

    $(".discount").click(function () {

        loading2Show();
        $("#EmptyDiv").hide();
        $("#CreateOrder").hide();
        $("#PayOrder").hide();
        $("#col1").children().remove();
        $("#col2").children().remove();
        $("#col3").children().remove();
        $("#CabinetTable").children().remove();
        $(".SortView").hide();

        sort = 0;
        startRecord = 0;
        currentEvent = "discount";

        data_status = 5;

        window.history.pushState({}, "", "index.html?sv=2");

        var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetTopDiscount",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":0, \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetTopDiscount
        });
    });

    function bindGetTopDiscount(data) {
        if (currentEvent == "discount") {
            $("#TitleInfo").css("background-color", "#fff");
            $('#TitleInfo').html(($("#MBM1").attr("v16") == "1" ? "Знижки: " : "Скидки: ") + "<span class='ListView'></span><span class='TableView'></span>");
            $("#CabinetInfo").hide();
            $("#TitleInfo").show();

            bindGrid(data);
        }
    }

    $("#FavCount").click(function () {
        loading2Show();
        $("#EmptyDiv").hide();
        $("#CreateOrder").hide();
        $("#PayOrder").hide();
        $("#col1").children().remove();
        $("#col2").children().remove();
        $("#col3").children().remove();
        $("#CabinetTable").children().remove();
        $(".SortView").hide();

        sort = 0;
        startRecord = 0;
        currentEvent = "favs";

        data_status = 6;

        window.history.pushState({}, "", "index.html?sv=5");

        var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetFavData",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"favdata\":'" + $.cookie("c_favors") + "', \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetFavCount
        });
    })

    function bindGetFavCount(data) {
        if (currentEvent == "favs") {

            if (data.d[4].length > 0) {
                $(".heartcount").html(parseInt($(".heartcount").html()) - data.d[4].length);

                var date = new Date();
                var minutes = 60;
                var hours = 24;
                var days = 365;
                date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                var _c_favors = $.cookie("c_favors");

                for (var i = 0; i < data.d[4].length; i++) {

                    _c_favors = _c_cart.replace(":" + data.d[4] + ":", "");

                }

                $.cookie("c_favors", _c_favors, { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            }

            $("#TitleInfo").css("background-color", "#fff");
            $('#TitleInfo').html(($("#MBM1").attr("v16") == "1" ? "Бажання:" : "Желания:") + '<span class="ListView"></span><span class="TableView"></span>');
            $("#CabinetInfo").hide();
            $("#TitleInfo").show();

            bindGrid(data);
        }
    }

    $("#CartCount").click(function () {
        loading2Show();
        $("#EmptyDiv").hide();
        $("#CreateOrder").hide();
        $("#PayOrder").hide();
        $("#col1").children().remove();
        $("#col2").children().remove();
        $("#col3").children().remove();
        $("#CabinetTable").children().remove();
        $(".SortView").hide();

        sort = 0;
        startRecord = 0;
        currentEvent = "cart";

        data_status = 7;

        window.history.pushState({}, "", "index.html?sv=4");

        //alert("{ \"uid\":" +uid_v + ", \"sid\":" + sid_v + ", \"cartdata\":'" + $.cookie("cart" + sid_v + "." +uid_v) + "' }");

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetCartData",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"cartdata\":'" + $.cookie("c_cart") + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetCartCount
        });
    })

    function bindGetCartCount(data) {

        if (currentEvent == "cart") {

            if (data.d[4].length > 0) {
                $(".mcartcount").html(parseInt($(".mcartcount").html()) - data.d[4].length);

                var date = new Date();
                var minutes = 60;
                var hours = 24;
                var days = 365;
                date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                var _c_cart = $.cookie("c_cart");

                for (var i = 0; i < data.d[4].length; i++) {

                    _c_cart = _c_cart.replace(":" + data.d[4] + ":", "");

                }

                $.cookie("c_cart", _c_cart, { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            }

            $("#TitleInfo").css("background-color", "#fff");
            $('#TitleInfo').html(($("#MBM1").attr("v16") == "1" ? "Кошик:" : "Корзина:") + "<span class='ListView'></span><span class='TableView'></span>");
            $("#CabinetInfo").hide();
            $("#TitleInfo").show();

            bindGrid(data);
        }
    }

    var selected;
    var img_index = 0;

    $(".leftscroll").click(function () {

        $('.findPhoto2').remove();

        var prev_img = undefined;
        $("#fullimage").attr("src", "https://xpool.pro/web/source/style_blot/img/loading.gif");

        window.setTimeout(function () {

            var c_parts = $(".imgcount").html().split(" / ");

            if (parseInt(c_parts[0]) > 1) {

                var p_prev = parseInt(c_parts[0]) - 1;

                $(".UrlArea").removeAttr("sel");
                $(".UrlArea").css("background-color", "#FFF");

                $(".UrlArea[ind='" + p_prev + "']").attr("sel", "1");
                $(".UrlArea[ind='" + p_prev + "']").css("background-color", "#FFFF00");

                $("#fullimage").attr("src", GetFullImage($(".UrlArea[ind='" + p_prev + "']").val()));

                $(".imgcount").html(p_prev + " / " + $(".imgcount").html().split(" / ")[1]);
            }
            else {
                var p_prev = parseInt(c_parts[1]);

                $(".UrlArea").removeAttr("sel");
                $(".UrlArea").css("background-color", "#FFF");

                $(".UrlArea[ind='" + p_prev + "']").attr("sel", "1");
                $(".UrlArea[ind='" + p_prev + "']").css("background-color", "#FFFF00");

                $("#fullimage").attr("src", GetFullImage($(".UrlArea[ind='" + p_prev + "']").val()));

                $(".imgcount").html(p_prev + " / " + $(".imgcount").html().split(" / ")[1]);
            }
        }, 500);
    });

    $(".rightscroll").click(function () {

        $('.findPhoto2').remove();

        $("#fullimage").attr("src", "https://xpool.pro/web/source/style_blot/img/loading.gif");

        window.setTimeout(function () {

            var c_parts = $(".imgcount").html().split(" / ");

            if (parseInt(c_parts[0]) < parseInt(c_parts[1])) {

                var p_next = parseInt(c_parts[0]) + 1;

                $(".UrlArea").removeAttr("sel");
                $(".UrlArea").css({ "background-color": "#FFF", "background-color": "#FFFFFF" });

                $(".UrlArea[ind='" + p_next + "']").attr("sel", "1");
                $(".UrlArea[ind='" + p_next + "']").css("background-color", "#FFFF00");

                $("#fullimage").attr("src", GetFullImage($(".UrlArea[ind='" + p_next + "']").val()));

                $(".imgcount").html(p_next + " / " + $(".imgcount").html().split(" / ")[1]);
            }
            else {
                var p_next = 1;

                $(".UrlArea").removeAttr("sel");
                $(".UrlArea").css({ "background-color": "#FFF", "background-color": "#FFFFFF" });

                $(".UrlArea[ind='" + p_next + "']").attr("sel", "1");
                $(".UrlArea[ind='" + p_next + "']").css("background-color", "#FFFF00");

                $("#fullimage").attr("src", GetFullImage($(".UrlArea[ind='" + p_next + "']").val()));

                $(".imgcount").html(p_next + " / " + $(".imgcount").html().split(" / ")[1]);
            }
        }, 500);
    });

    function bindInitEdit(data) {

        
        if ($("#fullimage").attr("src").indexOf("nophoto2.png") != -1 || $(".EditImageClass").css("display") != "none")
            $('<span class="findPhoto2">' + ($("#MBM1").attr("v16") == "1" ? 'Подивитись фото товару в Google' : 'Поcмотреть фото товара в Google') + '</span>').insertBefore($("#fullimage"));
       

        if (data.d.edit > 0) {
            $("#EditImage1").show();
            $("#EditImage2").show();

            if (data.d.edit == 2) {
                $("#DownPrice").html(selected.attr("stp"));
            }

            $("#StatusValue").html(selected.attr("status2"));

            $("#CategoriesSelect").children().remove();
            $("#CategoriesSelect").append("<option cat='0'>" + ($("#MBM1").attr("v16") == "1" ? "Усе" : "Все") + "</option>");
            var cur_drop = '';
            var drop = '';
            var cur_item_parts = null;

            if (data.d.cats != undefined) {
                for (var i = 0; i < data.d.cats.length; i++) {

                    var parts = data.d.cats[i].Name.split("/");

                    drop = '';

                    if (parts.length > 1) {
                        for (var j = 1; j < parts.length; j++) {
                            drop = drop + "\xA0\xA0\xA0\xA0\xA0";
                        }
                    }

                    if ((drop.length < cur_drop.length) && cur_drop != '') {
                        var another_path = '';

                        if (cur_item_parts != null) {
                            for (var j = 0; j < cur_item_parts.length - 1; j++) {
                                another_path += cur_item_parts[j] + "/";
                            }
                        }

                        $("#CategoriesSelect").append("<option cat='-1' full='" + another_path + "Прочее" + "'>" + cur_drop + ($("#MBM1").attr("v16") == "1" ? "Інше" : "Прочее") + "</option>");
                    }

                    cur_item_parts = parts;
                    cur_drop = drop;

                    $("#CategoriesSelect").append("<option cat='" + data.d.cats[i].ID + "' full='" + data.d.cats[i].Name + "'>" + drop + parts[parts.length - 1] + "</option>");
                }
            }

            drop = '';

            if ((drop.length < cur_drop.length) && cur_drop != '') {
                var another_path = '';

                for (var j = 0; j < cur_item_parts.length - 1; j++) {
                    another_path += cur_item_parts[j] + "/";
                }

                $("#CategoriesSelect").append("<option cat='-1' full='" + another_path + "Прочее" + "'>" + cur_drop + "Прочее" + "</option>");
            }

            $("#CategoriesSelect").append("<option cat='-1'>" + ($("#MBM1").attr("v16") == "1" ? "Інше" : "Прочее") + "</option>");

            $("#CategoriesSelect").val($("#CategoriesSelect").find('option[cat="' + selected.attr("catid") + '"]').val());
        }
        else {
            $("#EditImage1").hide();
            $("#EditImage2").hide();
        }
    };

    $("#ProductsListView").delegate('.img', 'click', function (evt) {
        $('html, body').css({
            overflow: 'hidden',
            height: '100%'
        });
        $("#vpo").attr("content", "width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=1");

        if (selected != undefined && selected.find("img").attr("index") != $(this).closest('.product').find("img").attr("index")) {
            selected.css({ "border": "2px solid #FFF", "background-color": "#FFFFFF" });
        }

        selected = $(this).closest('.product');
        selected.css({ "border": "2px solid #000" });

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/InitEdit",
            data: "{ \"uid_v\":" + uid_v + ", \"sid_v\":" + $(selected).attr("shopid") + ", \"key\":'" + ($.cookie("key") == undefined ? "" : $.cookie("key").replace(/ /g, '+')) + "'}",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindInitEdit
        });

        
            if (window.innerWidth > 416) {

                $(".leftscroll").show();
                $(".rightscroll").show();
            }
            else {
                $(".leftscroll").hide();
                $(".rightscroll").hide();
            }

            $("#fullimg").css("width", ($(window).innerWidth()) + "px");
            $("#fullimg").css("height", ($(window).innerHeight()) + "px");
            $("#viewer span.desc").css("width", ($(window).innerWidth()) + "px");
           

            $("#fullimage").attr("src", "https://xpool.pro/web/source/img/loading.gif");
            img_index = parseInt($(this).children('img').first().attr("index"));

            var urls;




            $(".leftscroll").show();
            $(".rightscroll").show();
            $("#fullimg").find("#AltImgDiv").remove();
            $("#fullimage").show();
            $("#fullimage").attr("src", GetFullImage($(this).children('img').first().attr("src")));
            urls = selected.find('img').first().attr("res").split("||");





            $(".UrlArea").removeAttr("sel");
            $(".UrlArea").css("background-color", "#FFF");

            $("#TargetURL1").val(GetFullImage(urls[0]).indexOf("nophoto2.png") == -1 ? GetFullImage(urls[0]) : "");
            $("#TargetURL1").css("background-color", "#FFFF00");
            $("#TargetURL1").attr("sel", "1");

            var imgcount = 1;

            if (urls.length > 1) {
                $("#TargetURL2").val(GetFullImage(urls[1]).indexOf("nophoto2.png") == -1 ? GetFullImage(urls[1]) : "");

                if ($("#TargetURL2").val().indexOf("nophoto") == -1 && $("#TargetURL2").val() != '') {
                    imgcount = 2;
                }
            }
            else
                $("#TargetURL2").val("");

            if (urls.length > 2) {
                $("#TargetURL3").val(GetFullImage(urls[2]).indexOf("nophoto2.png") == -1 ? GetFullImage(urls[2]) : "");

                if ($("#TargetURL3").val().indexOf("nophoto") == -1 && $("#TargetURL3").val() != '') {
                    imgcount = 3;
                }
            }
            else
                $("#TargetURL3").val("");

            if (urls.length > 3) {
                $("#TargetURL4").val(GetFullImage(urls[3]).indexOf("nophoto2.png") == -1 ? GetFullImage(urls[3]) : "");

                if ($("#TargetURL4").val().indexOf("nophoto") == -1 && $("#TargetURL4").val() != '') {
                    imgcount = 4;
                }
            }
            else
                $("#TargetURL4").val("");

            if (urls.length > 4) {
                $("#TargetURL5").val(GetFullImage(urls[4]).indexOf("nophoto2.png") == -1 ? GetFullImage(urls[4]) : "");

                if ($("#TargetURL5").val().indexOf("nophoto") == -1 && $("#TargetURL5").val() != '') {
                    imgcount = 5;
                }
            }
            else
                $("#TargetURL5").val("");

            $(".imgcount").html("1 / " + imgcount.toString());

            $("#DiscountValue").val(selected.attr("discount"));
            $("#RatingValue").html(selected.attr("rating"));
            $("#Price2Value").val(selected.attr("price2_inet"));

            $("#StatusValue").html(selected.attr("status2"));

            if (selected.attr("delivery") == 'null')
                $("#DeliverySelect").val($("#DeliverySelect option[ru='По умолчанию']").text());
            else if (selected.attr("delivery") == 'true')
                $("#DeliverySelect").val($("#DeliverySelect option[ru='Бесплатная']").text());
            else
                $("#DeliverySelect").val($("#DeliverySelect option[ru='Платная']").text());

            if (selected.attr("time") != undefined && selected.attr("time") != "null" && selected.attr("time") != "")
                $("#TimeSelect").val($("#TimeSelect option[v='" + selected.attr("time") + "']").text());
            else
                $("#TimeSelect").val($("#TimeSelect option[v='0']").text());


            $("#fullimg").css("width", ($(window).innerWidth()) + "px");
            $("#fullimg").css("height", ($(window).innerHeight()) + "px");
            $("#viewer span.desc").css("width", ($(window).innerWidth()) + "px");

            $("#viewer").show();
            $("#splash").show();

            evt.stopPropagation();
            evt.preventDefault();
        
    });

    $("#ProductsListView").delegate('a.name', 'click', function (evt) {
        //img_index = parseInt($(this).children('img').first().attr("index"));

        if (selected != undefined) {
            selected.css({ "border": "2px solid #FFF" });
        }

        selected = $(this).closest('.product');
        selected.css({ "border": "2px solid #000" });
    });

    function GetFullImage(img) {
        var res;

        if (img != null && img != undefined && img != '') {
            if (img.indexOf("nophoto") != -1) {
                res = "https://xpool.pro/web/source/" + $("#TargetStyleSheet").attr("st") + "/img/nophoto2.png";
            }
            else {

                if (img.indexOf("imagefeeder.ashx") != -1)
                    res = img.split("?s=")[1].replace("&c=1", "");
                else
                    res = img;
            }
        }
        else {
            res = 'https://xpool.pro/web/source/' + $("#TargetStyleSheet").attr("st") + '/img/nophoto2.png';
        }

        return res;
    }

    $("#OrderDec").click(function () {
        if (parseInt($("#OrderCount").html()) > 1)
            $("#OrderCount").html(function (i, oldval) {
                return --oldval;
            });

        pledge = (parseFloat(selected_ordered.attr("price")) * 0.1 * parseFloat($("#OrderCount").html()));
        var pledge_parts = pledge.toFixed(2).split('.');
        res = '<span class="mainbalance">' + pledge_parts[0] + '</span><span class="coins">' + pledge_parts[1] + '</span>';

        $("#PledgeAmount").html(res)

        if (pledge > parseFloat($("#MainBalance").attr("balance"))) {
            $("#SubmitOrder").attr("class", "nosubmit");
        }
        else {
            $("#SubmitOrder").attr("class", "submit");
        }
    });

    $("#OrderInc").click(function () {
        if (parseInt($("#OrderCount").html()) < 100)
            $("#OrderCount").html(function (i, oldval) {
                return ++oldval;
            });

        pledge = (parseFloat(selected_ordered.attr("price")) * 0.1 * parseFloat($("#OrderCount").html()));
        var pledge_parts = pledge.toFixed(2).split('.');
        res = '<span class="mainbalance">' + pledge_parts[0] + '</span><span class="coins">' + pledge_parts[1] + '</span>';

        $("#PledgeAmount").html(res)

        if (pledge > parseFloat($("#MainBalance").attr("balance"))) {
            $("#SubmitOrder").attr("class", "nosubmit");
        }
        else {
            $("#SubmitOrder").attr("class", "submit");
        }
    });

    $("#RejectSpan").click(function (evt) {
        //if ($.cookie("view") == "table") {
        //$("#fullimage").attr("src", "source/" + $("#TargetStyleSheet").attr("st") + "/img/nophoto2.png");
        //$("#TargetURL1").val("source/" + $("#TargetStyleSheet").attr("st") + "/img/nophoto2.png");
        //$("#TargetURL2").val("source/" + $("#TargetStyleSheet").attr("st") + "/img/nophoto2.png");
        //$("#TargetURL3").val("source/" + $("#TargetStyleSheet").attr("st") + "/img/nophoto2.png");
        //$("#TargetURL4").val("source/" + $("#TargetStyleSheet").attr("st") + "/img/nophoto2.png");
        //$("#TargetURL5").val("source/" + $("#TargetStyleSheet").attr("st") + "/img/nophoto2.png");


        $("#fullimage").attr("src", "https://xpool.pro/web/source/" + $("#TargetStyleSheet").attr("st") + "/img/nophoto2.png");
        $("#TargetURL1").val("");
        $("#TargetURL2").val("");
        $("#TargetURL3").val("");
        $("#TargetURL4").val("");
        $("#TargetURL5").val("");
        evt.stopPropagation();
        evt.preventDefault();
        // }
        // else
        //    alert($("#MBM1").attr("v16") == "1" ? "Ще не підтримується для виду типу список" : "Пока не поддерживается для вида типа список");
    })

    $("#SetSpan").click(function (evt) {
        //if ($.cookie("view") == "table") {

        if ($("#TargetURL1").val().startsWith("<") == false) {
            $(".leftscroll").show();
            $(".rightscroll").show();
            $("#fullimg").find("#AltImgDiv").remove();
            $("#fullimage").show();
            $("#fullimage").attr("src", $("#TargetURL1").val());
        }
        else {
            $(".leftscroll").hide();
            $(".rightscroll").hide();
            $("#fullimage").hide();
            $("#fullimg").find("#AltImgDiv").remove();
            $("#fullimg").append("<div id='AltImgDiv'>" + $("#TargetURL1").val().replace("<[", "").replace("]>", "") + "</div>");
        }

        evt.stopPropagation();
        evt.preventDefault();
        //}
        // else
        //    alert($("#MBM1").attr("v16") == "1" ? "Ще не підтримується для виду типу список" : "Пока не поддерживается для вида типа список");
    })

    $("#SaveSpan").click(function (evt) {
        if ($(this).attr("dis") == "1") {
            alert("Demo Version!")
        }
        else {
            $("#splash").show();
            loadingShow();

            

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/SaveImageURL",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(selected).attr("shopid") + ", \"id\":" + $(selected).attr("dataid") + ", \"url\":'" + $("#TargetURL1").val() + "||" + $("#TargetURL2").val() + "||" + $("#TargetURL3").val() + "||" + $("#TargetURL4").val() + "||" + $("#TargetURL5").val() + "', \"vfurl\":'', \"rating\":" + $("#RatingValue").html() + ", \"discount\":'" + $("#DiscountValue").val() + "', \"delivery\":'" + $("#DeliverySelect option:selected").attr("ru") + "', \"time\":" + $("#TimeSelect option:selected")[0].getAttribute("v") + ", \"catid\":" + $("#CategoriesSelect option:selected")[0].getAttribute("cat") + ", \"price2_inet\":'" + $("#Price2Value").val() + "', \"status\":'" + $("#StatusValue").html() + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindSaveImageURL
            });

            evt.stopPropagation();
            evt.preventDefault();
        }
        //else
        //    alert($("#MBM1").attr("v16") == "1" ? "Ще не підтримується для виду типу список" : "Пока не поддерживается для вида типа список");
    })

    $('#CategoriesSelect').change(function (evt) {
        if ($(this).attr("dis") == "1") {
            alert("Demo Version!")
        }
        else {
            $("#splash").show();
            loadingShow();

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/SaveImageURL",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(selected).attr("shopid") + ", \"id\":" + $(selected).attr("dataid") + ", \"url\":'" + $("#TargetURL1").val() + "||" + $("#TargetURL2").val() + "||" + $("#TargetURL3").val() + "||" + $("#TargetURL4").val() + "||" + $("#TargetURL5").val() + "', \"vfurl\":'', \"rating\":" + $("#RatingValue").html() + ", \"discount\":'" + $("#DiscountValue").val() + "', \"delivery\":'" + $("#DeliverySelect option:selected").attr("ru") + "', \"time\":" + $("#TimeSelect option:selected")[0].getAttribute("v") + ", \"catid\":" + $("#CategoriesSelect option:selected")[0].getAttribute("cat") + ", \"price2_inet\":'" + $("#Price2Value").val() + "', \"status\":'" + $("#StatusValue").html() + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindSaveCategory
            });

            evt.stopPropagation();
            evt.preventDefault();
        }
    });

    function bindSaveCategory(data) {

        //alert(data.d);

        $(selected).attr("catid", $("#CategoriesSelect option:selected")[0].getAttribute("cat"));
        loadingHide();
    }

    function bindSaveImageURL(data) {
        var cur_photo = ($("#TargetURL1").val().indexOf("nophoto2.png") != -1) ? "https://xpool.pro/web/source/" + $("#TargetStyleSheet").attr("st") + "/img/nophoto.png" : $("#TargetURL1").val();

        $(selected).find("img").first().attr("src", cur_photo);

        if (cur_photo.indexOf("nophoto") == -1) {
            $(selected).find(".findPhoto").remove();
        }

        if (cur_photo.startsWith("<") == false) {
            $(selected).find(".img").children("div.altimg").remove();
            $(selected).find("img").first().attr("res", cur_photo + "||" + $("#TargetURL2").val() + "||" + $("#TargetURL3").val() + "||" + $("#TargetURL4").val() + "||" + $("#TargetURL5").val());
        }
        else {
            $(selected).find(".img").children("div.altimg").remove();
            $(selected).find(".img").children("img").remove();
            $(selected).find(".img").append("<div class='altimg'>" + cur_photo.replace("<[", "").replace("]>", "") + "</div>");
        }


        if ($("#TargetURL1").val().startsWith("<") == false) {
            $(".leftscroll").show();
            $(".rightscroll").show();
            $("#fullimg").find("#AltImgDiv").remove();
            $("#fullimage").show();
            $("#fullimage").attr("src", $("#TargetURL1").val());
        }
        else {
            $(".leftscroll").hide();
            $(".rightscroll").hide();
            $("#fullimage").hide();
            $("#fullimg").find("#AltImgDiv").remove();
            $("#fullimg").append("<div id='AltImgDiv'>" + $("#TargetURL1").val().replace("<[", "").replace("]>", "") + "</div>");
        }



        $(selected).attr("rating", $("#RatingValue").html());
        $(selected).attr("discount", $("#DiscountValue").val());
        $(selected).attr("price2_inet", $("#Price2Value").val());
        $(selected).attr("price", $("#Price2Value").val());
        $(selected).attr("status2", $("#StatusValue").html());

        if ($("#StatusValue").html() == 1) {
            $(selected).find('.pickup').remove();
        }

        $(selected).attr("catid", $("#CategoriesSelect option:selected")[0].getAttribute("cat"));

        $(selected).attr("time", $("#TimeSelect option:selected")[0].getAttribute("v"))

        var delivery_status = null;

        if ($("#DeliverySelect option:selected").attr("ru") == "Бесплатная") {

            delivery_status = true;
        }
        else if ($("#DeliverySelect option:selected").attr("ru") == "Платная") {
            delivery_status = false;
        }

        $(selected).attr("delivery", delivery_status);
        $(selected).find(".pdelivery").first().remove();
        $(selected).find(".timeselect").first().remove();

        var free_delivery = 0;

        if ($("#MBM1").attr("v13") == "1") {
            free_delivery = 1;
        }

        $(selected).find(".img").append(FreeDelivery(free_delivery, delivery_status));

        //if (parseFloat($(selected).attr("discount")) > 0) {
        $(selected).find(".price").first().parent().remove();
        $(selected).find(".oldprice").first().parent().remove();
        $(selected).find(".pdiscount").first().remove();
        if ($.cookie("c_view") == "table")
            $(selected).find(".img").parent().prepend(GetDiscount(parseFloat(($(selected).attr("discount")) > 0 ? $(selected).attr("discount") : '0'), $(selected).attr("price")) + GetRate($(selected).attr("rating")));
        else
            $(selected).find(".img").prepend(GetDiscount(parseFloat(($(selected).attr("discount")) > 0 ? $(selected).attr("discount") : '0'), $(selected).attr("price")) + GetRate($(selected).attr("rating")));

        $(selected).find(".options").first().children().first().prepend(GetPriceView(($(selected).attr("discount") > 0 ? $(selected).attr("discount") : '0'), $(selected).attr("price"), $(selected).attr("ct")));
        //}

        if ($("#TimeSelect option:selected")[0].getAttribute("v").toString() != "0") {
            var timesel = TimeSelectView($("#TimeSelect option:selected")[0].getAttribute("v"), $(selected).attr("shopid"));

            if (timesel != '') {
                if ($(selected).find('.pcomparision').html() != undefined) {
                    $(selected).find('.pcomparision').before(timesel);
                }
                else {
                    if ($.cookie("c_view") == "table") {
                        $(selected).append(timesel);
                    }
                    else {
                        $(selected).find(".last_td").append(timesel);
                    }
                }

                SetTimeViewPrice($(timesel), $(selected).attr("dataid"), 1, $(selected).attr("ct"));
            }
        }

        $('html, body').css({
            overflow: 'auto',
            height: 'auto'
        });
        $("#vpo").attr("content", "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0");

        $("#viewer").hide();
        loadingHide();
        $("#splash").hide();

        var $target = $('html,body');
        $target.animate({ scrollTop: selected.offset().top + $("#ProductsListView").offset().top + selected.outerHeight() / 2 - 120 - $(window).height() / 2 }, 0);
        selected.css({ "border": "solid 2px #FF0000" }).animate({ borderColor: "#000000" }, 1000);
    }

    $("#UploadToGoogleFeedSpan").click(function () {
        if ($("#TargetURL1").val().startsWith("<") == false) {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetGoogleMainCats",
                data: "{ }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGoogleMainCats
            });
        }
       

        //alert($("#CategoriesSelect option:selected")[0].innerText);
        //alert($(selected).attr("dataid"));

    });

    $("#EditDescSpan").click(function () {
        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetDescInfo",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(selected).attr("shopid") + ", \"id\":" + $(selected).attr("dataid") + " }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetDescInfo
        });
    });

    function bindGetDescInfo(data) {
        $("#splash4").center();
        $("#splash4").show();
        $("#AddictedTable").css("width", (window.innerWidth - 80) + "px");
        $("#AddictedTable").css("height", (window.innerHeight - 40) + "px");
        $("#AddictedView").css("width", (window.innerWidth - 80) + "px");
        $("#AddictedTable").children().remove();  
        $("#AddictedTable").append('<tr><td class="Head1" width="100%" height="70px"><textarea id="EditPNameTextBox" maxlength="500" rows="3" cols="30" style="width: 100%; padding: 5px; font: normal 18px arial; display: block;"></textarea></td></tr>');
        $("#AddictedTable").append('<tr><td class="Head1" width="100%" height="100%"><textarea id="EditDescTextBox" maxlength="3000" rows="20" cols="30" style="width: 100%; height: 100%; padding: 5px; font: normal 18px arial; display: block;"></textarea></td></tr>');
        $("#AddictedTable").append('<tr><td id="SaveDescChanges" class="None" style="background-color: #FFFF00" width="100%" uk="Зберегти">Сохранить</td></tr>');
        $("#AddictedTable").append('<tr><td id="CloseDescChanges" class="None" width="100%" uk="Закрити">Закрыть</td></tr>');

        $("#EditPNameTextBox").val(data.d[0]);
        $("#EditDescTextBox").val(data.d[1]);

        $("#AddictedView").center();
        $("#AddictedView").show();
    }

    $("#AddictedTable").delegate('#SaveDescChanges', 'click', function () {

        $("#SaveDescChanges").html("...");

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/SaveDescChanges",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(selected).attr("shopid") + ", \"id\":" + $(selected).attr("dataid") + ", \"name\":'" + $("#EditPNameTextBox").val() + "', \"desc\":'" + $("#EditDescTextBox").val() + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindSaveDescChanges
        });
    });

    function bindSaveDescChanges(data) {
        $("#splash4").hide();
        $("#AddictedView").hide();
    }

    $("#AddictedTable").delegate('#CloseDescChanges', 'click', function () {
        $("#splash4").hide();
        $("#AddictedView").hide();
    });

    function bindGoogleMainCats(data) {

        
        $("#splash4").center();
        $("#splash4").show();
        $("#AddictedTable").css("width", "400px");
        $("#AddictedView").css("width", "400px");
        $("#AddictedTable").css("height", "auto");
        $("#AddictedTable").children().remove();
        $("#AddictedTable").append('<tr><td class="Head2" width="100%" uk="Категорія">Категория:</td></tr>');
        $("#AddictedTable").append('<tr><td class="Head1" width="100%" height="42px"><select style="width: 100%" id="MainCatSelect"></select></td></tr>');
        $("#AddictedTable").append('<tr><td class="Head2" uk="Підкатегорія 1">Подкатегория 1:</td></tr>');
        $("#AddictedTable").append('<tr><td class="Head1" width="100%" height="42px"><select style="width: 100%" id="Cat1Select"></select></td></tr>');
        $("#AddictedTable").append('<tr><td class="Head2" uk="Підкатегорія 2">Подкатегория 2:</td></tr>');
        $("#AddictedTable").append('<tr><td class="Head1" width="100%" height="42px"><select style="width: 100%" id="Cat2Select"></select></td></tr>');
        $("#AddictedTable").append('<tr><td class="Head2" uk="Підатегорія 3">Подкатегория 3:</td></tr>');
        $("#AddictedTable").append('<tr><td class="Head1" width="100%" height="42px"><select style="width: 100%" id="Cat3Select"></select></td></tr>');
        $("#AddictedTable").append('<tr><td class="Head2" uk="Бренд">Бренд:</td></tr>');
        $("#AddictedTable").append('<tr><td class="Head1" width="100%" height="42px"><input class="inputText" style="text-align: center; padding-left: 0px" id="BrandTextBox" type="text" value="" /></td></tr>');
        $("#AddictedTable").append('<tr><td id="SaveFeedChanges" class="None" style="background-color: #FFFF00" width="100%" uk="Зберегти">Сохранить</td></tr>');
        $("#AddictedTable").append('<tr><td id="CloseFeedChanges" class="None" width="100%" uk="Закрити">Закрыть</td></tr>');
        for (var i = 0; i < data.d.length; i++) {
            $('#MainCatSelect').append('<option>' + data.d[i] + '</option>');
        }

        $("#MainCatSelect").change();

        $("#AddictedView").center();
        $("#AddictedView").show();
    }

    $("#AddictedTable").delegate('#MainCatSelect', 'change', function () {
        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetGoogleSubCats1",
            data: "{ \"main_cat\":'" + $("#MainCatSelect option:selected")[0].innerText + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetGoogleSubCats1
        });
    });

    function bindGetGoogleSubCats1(data)
    {
        $('#Cat1Select').children().remove();

        for (var i = 0; i < data.d.length; i++) {
            $('#Cat1Select').append('<option>' + data.d[i] + '</option>');
        }
    }

    $("#AddictedTable").delegate('#Cat1Select', 'change', function () {
        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetGoogleSubCats2",
            data: "{ \"main_cat\":'" + $("#MainCatSelect option:selected")[0].innerText + "', \"sub1\":'" + $("#Cat1Select option:selected")[0].innerText + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetGoogleSubCats2
        });
    });

    $("#AddictedTable").delegate('#SaveFeedChanges', 'click', function () {

        loadingShow();

        var g_cat = $("#MainCatSelect").val() + (($("#Cat1Select").val() == null || $("#Cat1Select").val() == "") ? "" : " > " + $("#Cat1Select").val()) + (($("#Cat2Select").val() == "" || $("#Cat2Select").val() == null) ? "" : " > " + $("#Cat2Select").val()) + (($("#Cat3Select").val() == null || $("#Cat3Select").val() == "") ? "" : " > " + $("#Cat3Select").val());

       // alert(g_cat);

        var brand = ($("#BrandTextBox").val() == "" || $("#BrandTextBox").val() == undefined) ? "Інші бренди" : $("#BrandTextBox").val();

        var cat = $("#CategoriesSelect").val() == "" ? "Усі" : $("#CategoriesSelect").val();

        //alert($("#TargetURL1").val());

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/UploadToFeed",
            data: "{ \"uid\":" + getUrlParameter("uid") + ", \"sid\":" + $(selected).attr("shopid") + ", \"id\":" + $(selected).attr("dataid") + ", \"url\":'" + $("#TargetURL1").val() + "', \"brand\":'" + brand + "', \"google_product_category\":'" + g_cat + "', \"category\":'" + cat + "', \"price2\":'" + $("#Price2Value").val() + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindUploadToFeed
        });
    });

    $("#AddictedTable").delegate('#CloseFeedChanges', 'click', function () {
        $("#splash4").hide();
        $("#AddictedView").hide();
    });

    function bindGetGoogleSubCats2(data) {
        $('#Cat2Select').children().remove();

        for (var i = 0; i < data.d.length; i++) {
            $('#Cat2Select').append('<option>' + data.d[i] + '</option>');
        }
    }

    $("#AddictedTable").delegate('#Cat2Select', 'change', function () {
        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetGoogleSubCats3",
            data: "{ \"main_cat\":'" + $("#MainCatSelect option:selected")[0].innerText + "', \"sub1\":'" + $("#Cat1Select option:selected")[0].innerText + "', \"sub2\":'" + $("#Cat2Select option:selected")[0].innerText + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetGoogleSubCats3
        });
    });

    function bindGetGoogleSubCats3(data) {
        $('#Cat3Select').children().remove();

        for (var i = 0; i < data.d.length; i++) {
            $('#Cat3Select').append('<option>' + data.d[i] + '</option>');
        }
    }

     function bindUploadToFeed(data) {

        $("#splash4").hide();
        $("#AddictedView").hide();
        $("#TargetURL1").val(data.d);

        loadingHide();
    }

    $(".UrlArea").focus(function () {

        $(".UrlArea").removeAttr("sel");
        $(".UrlArea").css("background-color", "#FFF");

        $(this).attr("sel", "1");
        $(this).css("background-color", "#FFFF00");

        $("#fullimage").attr("src", GetFullImage($(this).val()));

        $(".imgcount").html($(this).attr("ind").toString() + " / " + $(".imgcount").html().split(" / ")[1]);
    });

    $("#DecRating").click(function () {
        var value = parseInt($("#RatingValue").html());

        if (value > 0)
            $("#RatingValue").html(value - 1);
    });

    $("#IncRating").click(function () {
        var value = parseInt($("#RatingValue").html());
        $("#RatingValue").html(value + 1);
    });

    $("#DecStatus").click(function () {
        var value = parseInt($("#StatusValue").html());

        if (value > 0)
            $("#StatusValue").html(value - 1);
    });

    $("#IncStatus").click(function () {
        var value = parseInt($("#StatusValue").html());
        $("#StatusValue").html(value + 1);
    });

    //var dropbox = document.getElementById('TargetURL');

    //dropbox.addEventListener('dragenter', noopHandler, false);
    //dropbox.addEventListener('dragexit', noopHandler, false);
    //dropbox.addEventListener('dragover', noopHandler, false);
    //dropbox.addEventListener('drop', drop, false);

    //function noopHandler(evt) {
    //    evt.stopPropagation();
    //    evt.preventDefault();
    //}
    //function drop(evt) {
    //    evt.stopPropagation();
    //    evt.preventDefault();
    //    var imageUrl = evt.dataTransfer.getData('Text');
    //    alert(imageUrl);
    //}

    var selected_ordered = null;

    var protection_type;

    //$("#PhoneNumberSubmit").click(function () {
    //    if ($("#PhoneNumberLogin").val().indexOf("_") === -1 && $("#PhoneNumberLogin").val() != '') {
    //        if ($("#ProtectorClose").attr("class") == "protectorclose") {
    //            $("#ProtectorClose").attr("class", "loadingprotect");
    //            $.ajax({
    //                async: true,
    //                type: "POST",
    //                url: "webform.aspx/GetProtectedClient",
    //                data: "{ \"uid\":" +uid_v + ", \"sid\":" + sid_v + ", \"client_id\":" + $("#MainBalance").attr("client_id") + ", \"phone\":'" + $("#PhoneNumberLogin").val() + "' }",
    //                contentType: "application/json; charset=utf-8",
    //                dataType: "json",
    //                success: bindGetProtectedClient
    //            });
    //        }
    //    }
    //});

    function bindGetProtectedClient(data) {
        window.setTimeout(function () {
            var clientData = data.d;

            if (clientData != null) {
                $("#ProtectorClose").attr("class", "protectorclose");

                $("#protector").hide();

                var date = new Date();
                var minutes = 60;
                var hours = 24;
                var days = 365;
                date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                if ($.cookie("c_client_phone") == undefined || $.cookie("c_client_phone") == null || $.cookie("c_client_phone") == '') {
                    $.cookie("c_client_phone", clientData.paramPhone, { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                }

                if (protection_type == 1) {
                    $("#CreateOrder").hide();
                    $("#PayOrder").hide();
                    loading2Show();
                    $("#EmptyDiv").hide();
                    $("#ProductsListView").hide();
                    $("#col1").children().remove();
                    $("#col2").children().remove();
                    $("#col3").children().remove();
                    $("#CabinetTable").children().remove();
                    $(".SortView").hide();

                    sort = 0;
                    startRecord = 0;

                    $.ajax({
                        async: true,
                        type: "POST",
                        url: "https://xpool.pro/web/webform.aspx/GetClientLog",
                        data: "{ \"uid\":" +uid_v + ", \"sid\":" + sid_v + ", \"client_id\":" + $("#MainBalance").attr("client_id") + ", \"startRecord\":0, \"type\":0 }",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: bindGetClientLog
                    });
                }
                else if (protection_type == 2) {
                    // window.location.replace("http://xn--80atad5a1f.in.ua/default.aspx?cat=5");
                    // return false;
                }
                else if (protection_type == 3) {
                    $("#rateform").center();
                    $("#rateform").show();
                }
                else {
                    $("#splash").hide();
                }
            }
            else {
                $("#ProtectorClose").attr("class", "protectorclose");
                $("#PhoneNumberLogin").css({
                    "border-color": "red"
                });
            }
        }, 1000);
    }


    $("#CreatePhoneNumberSubmit").click(function () {

        if ($("#CreatePhoneNumberLogin").val().indexOf("_") == -1 && $("#CreatePhoneNumberLogin").val() != '') {
            if ($("#CreateAccountClose").attr("class") == undefined) {
                $("#CreateAccountClose").attr("class", "loadingprotect");
                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/CreatePhoneClient",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"client_id\":" + $("#MainBalance").attr("client_id") + ", \"phone\":'" + ConvertPhone($("#CreatePhoneNumberLogin").val()) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindCreatePhoneClient
                });
            }
        }
    });

    function bindCreatePhoneClient(data) {
        window.setTimeout(function () {

            var date = new Date();
            var minutes = 60;
            var hours = 24;
            var days = 365;
            date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

            if ($.cookie("c_client_phone") == undefined || $.cookie("c_client_phone") == null || $.cookie("c_client_phone") == '') {
                $.cookie("c_client_phone", $("#CreatePhoneNumberLogin").val(), { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            }

            $("#createaccount").hide();
            $("#splash").hide();
            $("#splash2").hide();
        }, 1000);
    }

    var cur_log_id = 0;
    var cur_ip = 0;

    var cur_stats = null;

    $("#CabinetTable").delegate('span.stats', 'click', function () {

        $("#R1").show();
        $("#R2").show();
        $("#R3").show();

        cur_stats = $(this);
        cur_log_id = $(this).attr("logid");
        $("#R1Count").html(($(this).attr("r1") == -1) ? "0" : $(this).attr("r1"));
        $("#R2Count").html(($(this).attr("r2") == -1) ? "0" : $(this).attr("r2"));
        $("#R3Count").html(($(this).attr("r3") == -1) ? "0" : $(this).attr("r3"));

        cur_date = new Date();

        var month = cur_date.getMonth() + 1;
        var day = cur_date.getDate();

        var output = (day < 10 ? '0' : '') + day + ' / ' + (month < 10 ? '0' : '') + month + ' / ' + cur_date.getFullYear();

        $("#DateCount2").html(output);

        if ($.cookie("key") != undefined && $.cookie("key") != '' && $.cookie("key") != null) {
            $("#RateDate1").show();
            $("#rateform").css("height", "480px");
        }
        else {
            $("#rateform").css("height", "450px");
        }

        $("#rateform").center();
        $("#rateform").show();
        $("#splash").show();
    });

    $("#rateform span.rateformclose").click(function () {
        if ($("#RateFormClose").attr("class") == "rateformclose") {
            $("#rateform").hide();
            $("#splash").hide();
        }
    });

    $("#R1Dec").click(function () {
        if (parseInt($("#R1Count").html()) > 0)
            $("#R1Count").html(function (i, oldval) {
                return --oldval;
            });
    });

    $("#R1Inc").click(function () {
        if (parseInt($("#R1Count").html()) < 5)
            $("#R1Count").html(function (i, oldval) {
                return ++oldval;
            });
    });

    $("#R2Dec").click(function () {
        if (parseInt($("#R2Count").html()) > 0)
            $("#R2Count").html(function (i, oldval) {
                return --oldval;
            });
    });

    $("#R2Inc").click(function () {
        if (parseInt($("#R2Count").html()) < 5)
            $("#R2Count").html(function (i, oldval) {
                return ++oldval;
            });
    });

    $("#R3Dec").click(function () {
        if (parseInt($("#R3Count").html()) > 0)
            $("#R3Count").html(function (i, oldval) {
                return --oldval;
            });
    });

    $("#R3Inc").click(function () {
        if (parseInt($("#R3Count").html()) < 5)
            $("#R3Count").html(function (i, oldval) {
                return ++oldval;
            });
    });

    $("#SubmitRate").click(function () {
        if ($("#RateFormClose").attr("class") == "rateformclose") {
            $("#RateFormClose").attr("class", "loadingrate");

            var did = 0;

            if (cur_log_id == 0) {
                did = $(selected).attr("dataid");
            }

            var client_id = 0;

            if ($("#MainBalance").attr("client_id") == undefined) {
                client_id = 0
            }
            else {
                client_id = $("#MainBalance").attr("client_id")
            }

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/RateTrade",
                data: "{ \"uid\":" + uid_v + ", \"client_id\":" + client_id + ", \"log_id\":'" + cur_log_id + "', \"rate1\":" + $("#R1Count").html() + ", \"rate2\":" + $("#R2Count").html() + ", \"rate3\":" + $("#R3Count").html() + ", \"rname\":'" + $("#RName").val() + "', \"rcomment\":'" + $("#RCommentInfo").val() + "', \"date\":'" + $("#DateCount2").html() + "', \"did\":" + did + " }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindSubmitRate
            });
        }
    });

    function bindSubmitRate(data) {
        window.setTimeout(function () {
            $("#RateFormClose").attr("class", "rateformclose");
            $("#CreateOrder").hide();
            $("#PayOrder").hide();
            if (cur_log_id != 0) {
                cur_stats.attr("r1", $("#R1Count").html());
                cur_stats.attr("r2", $("#R2Count").html());
                cur_stats.attr("r3", $("#R3Count").html());
            }
            else {
                loadingShow();
                $("#splash").show();
                $("#EmptyDiv").hide();
                $("#CreateOrder").hide();


              

                //startRecord = 0;
                //sort = 0;
                //currentEvent = "clientlog";



                //data_status = 10;

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetRatesLog",
                    data: "{ \"did\":" + $(selected).attr("dataid") + ", \"startRecord\":0 }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetRatesLog
                });
            }

            cur_log_id = 0;
            $("#rateform").hide();
            $("#splash").hide();
        });
    }

    ////////////////////////////////////////////////////////

    $("#ProductsListView").delegate('.pdelivery', 'mouseenter', function () {

        var top = $(this).parent().offset().top + $(this).parent().innerHeight() - 140;
        var left = $(this).parent().offset().left + 150;

        $(".deliveryTip").css({ "top": top, "left": left });
        $(".deliveryTip").show();
    });

    $("#ProductsListView").delegate('.pdelivery', 'mouseout', function () {
        $(".deliveryTip").hide();
    });


    function removeParam(key, sourceURL) {
        var rtn = sourceURL.split("?")[0],
            param,
            params_arr = [],
            queryString = (sourceURL.indexOf("?") !== -1) ? sourceURL.split("?")[1] : "";
        if (queryString !== "") {
            params_arr = queryString.split("&");
            for (var i = params_arr.length - 1; i >= 0; i -= 1) {
                param = params_arr[i].split("=")[0];
                if (param === key) {
                    params_arr.splice(i, 1);
                }
            }
            rtn = rtn + "?" + params_arr.join("&");
        }
        return rtn;
    }


    var init = 1;
    var startRecord = 0;

    var menu_offset = null;

    var shop_addr;

    $("#redirect").click(function () {
        var minp = (getUrlParameter("minp") != undefined && getUrlParameter("minp") != '') ? ("&minp=" + getUrlParameter("minp")) : '';
        var maxp = (getUrlParameter("maxp") != undefined && getUrlParameter("maxp") != '') ? ("&maxp=" + getUrlParameter("maxp")) : '';
        var s = (getUrlParameter("s") != undefined && getUrlParameter("s") != '') ? ("&s=" + getUrlParameter("s")) : '';
        var id = (getUrlParameter("id") != undefined && getUrlParameter("id") != '') ? ("&id=" + getUrlParameter("id")) : '';
        var ids = (getUrlParameter("ids") != undefined && getUrlParameter("ids") != '') ? ("&ids=" + getUrlParameter("ids")) : '';
        var cat = (getUrlParameter("cat") != undefined && getUrlParameter("cat") != '') ? ("&cat=" + getUrlParameter("cat").replace(/_/g, " ")) : '';
        var ssid = (getUrlParameter("ssid") != undefined && getUrlParameter("ssid") != '') ? ("&ssid=" + getUrlParameter("ssid")) : '';
        var sv = (getUrlParameter("sv") != undefined && getUrlParameter("sv") != '') ? ("&sv=" + getUrlParameter("sv")) : '';

        window.location.replace(shop_addr + "?uid=" +uid_v + "&sid=" + sid_v + s + id + ids + cat + sv + ssid + minp + maxp + "&refer=" + getUrlParameter("refer"));
    })

    $(function () {

        jQuery.fn.center = function () {
            this.css("position", "absolute");
            this.css("top", Math.max(0, (($(window).height() - $(this).outerHeight()) / 2) +
                                                        $(window).scrollTop()) + "px");
            this.css("left", Math.max(0, (($(window).width() - $(this).outerWidth()) / 2) +
                                                        $(window).scrollLeft()) + "px");
            return this;
        }

        if (getUrlParameter("uid") != undefined && getUrlParameter("uid") != null && getUrlParameter("uid") != '' && extractHostname(window.location.origin).indexOf("monstro.com.ua") == -1) {
            uid_v = getUrlParameter("uid");
        }


        if (getUrlParameter("sid") != undefined && getUrlParameter("sid") != null && getUrlParameter("sid") != '' && extractHostname(window.location.origin).indexOf("monstro.com.ua") == -1) {
            sid_v = getUrlParameter("sid");
            alert("test");
        }

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/InitPage",
            data: "{ \"uid_v\":" + uid_v + ", \"sid_v\":" + sid_v + " }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindInit
        });
    });



    var uid_v = 48;//edit
    var sid_v = 638;//edit

    var init_status = 1;

    function bindInit(data) {
        $("#MBM1").attr("v1", data.d.mbm[0]), $("#MBM1").attr("v2", data.d.mbm[1]), $("#MBM1").attr("v3", data.d.mbm[2]), $("#MBM1").attr("v4", data.d.mbm[3]);
        $("#MBM1").attr("v5", data.d.mbm[4]), $("#MBM1").attr("v6", data.d.mbm[5]), $("#MBM1").attr("v7", data.d.mbm[6]), $("#MBM1").attr("v8", data.d.mbm[7]);
        $("#MBM1").attr("v9", data.d.mbm[8]), $("#MBM1").attr("v10", data.d.mbm[9]), $("#MBM1").attr("v11", data.d.mbm[10]), $("#MBM1").attr("v12", data.d.mbm[11]);
        $("#MBM1").attr("v13", data.d.mbm[12]), $("#MBM1").attr("v14", data.d.mbm[13]), $("#MBM1").attr("v15", data.d.mbm[14]), $("#MBM1").attr("v16", data.d.mbm[15]);
        $("#MBM1").attr("v17", data.d.mbm[16]), $("#MBM1").attr("v18", data.d.mbm[17]), $("#MBM1").attr("v19", "0"), $("#MBM1").attr("v20", data.d.mbm[19]);
        $("#MBM1").attr("v21", data.d.mbm[20]), $("#MBM1").attr("v22", data.d.mbm[21]);


        
        if (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") == -1) {
            $("#TargetStyleSheet").attr("href", data.d.target_style_sheet_href);
            $("#TargetStyleSheet").attr("st", data.d.target_style_sheet_st);
        }

        if (extractHostname(window.location.origin).indexOf("monstro.com.ua") != -1) {
            uid_v = 48;
            sid_v = 8071;
        }

        //$("#TargetStyleSheet").attr("href", "https://xpool.pro/web/source/style_blot/css/main.css");
        //$("#TargetStyleSheet").attr("st", "style_blot");

        $("#MBM1").attr("glue1", data.d.glue1);
        $("#MBM1").attr("glue2", data.d.glue2);

        $("#SaveSpan").attr("dis", data.d.dis);


        $("#TimeComponents").val(data.d.time_components);

        shop_addr = (getUrlParameter("shop") != undefined && getUrlParameter("shop") != '') ? getUrlParameter("shop") : ("https://" + extractHostname($(location).attr("href")));

        //if ($(".previmg").attr("redir") == "1") {
        //    $("#redirect").show();
        //    var minp = (getUrlParameter("minp") != undefined && getUrlParameter("minp") != '') ? ("&minp=" + getUrlParameter("minp")) : '';
        //    var maxp = (getUrlParameter("maxp") != undefined && getUrlParameter("maxp") != '') ? ("&maxp=" + getUrlParameter("maxp")) : '';
        //    var s = (getUrlParameter("s") != undefined && getUrlParameter("s") != '') ? ("&s=" + getUrlParameter("s")) : '';
        //    var id = (getUrlParameter("id") != undefined && getUrlParameter("id") != '') ? ("&id=" + getUrlParameter("id")) : '';
        //    var ids = (getUrlParameter("ids") != undefined && getUrlParameter("ids") != '') ? ("&ids=" + getUrlParameter("ids")) : '';
        //    var cat = (getUrlParameter("cat") != undefined && getUrlParameter("cat") != '') ? ("&cat=" + getUrlParameter("cat").replace(/_/g, " ")) : '';
        //    var ssid = (getUrlParameter("ssid") != undefined && getUrlParameter("ssid") != '') ? ("&ssid=" + getUrlParameter("ssid")) : '';
        //    var sv = (getUrlParameter("sv") != undefined && getUrlParameter("sv") != '') ? ("&sv=" + getUrlParameter("sv")) : '';

        $(".mainheader").show();
        $(".menu").show();

       
            $("#datepicker1,#datepicker2").datepicker({
                showAnim: '',
                beforeShow: function () {
                    setTimeout(function () {
                        $('.ui-datepicker').css('z-index', 99999999999999);
                    }, 0);
                }
            });

            //$.cookie("c_client");

            var dateToday = new Date();

            var dates = $("#datepicker").datepicker({
                showAnim: '',
                minDate: dateToday,
                beforeShow: function () {
                    setTimeout(function () {
                        $('.ui-datepicker').css('z-index', 99999999999999);
                    }, 0);
                },
                onSelect: function (selectedDate) {
                    if (currentEvent != "cart" && currentEvent != "favs") {
                        var option = "minDate",
                            instance = $(this).data("datepicker"),
                            date = $.datepicker.parseDate(instance.settings.dateFormat || $.datepicker._defaults.dateFormat, selectedDate, instance.settings);
                        dates.not(this).datepicker("option", option, date);

                        loading2Show();
                        $("#EmptyDiv").hide();
                        $("#CreateOrder").hide();
                        $("#PayOrder").hide();
                        $("#col1").children().remove();
                        $("#col2").children().remove();
                        $("#col3").children().remove();
                        $("#CabinetTable").children().remove();

                        sort = 0;
                        startRecord = 0;

                        DataSLoad();
                    }
                }
            });

            SetView();

            var d = new Date();

            var day = d.getDate();

            if (day < 10) {
                day = "0" + day;
            }

            var month = (d.getMonth() + 1);

            if (month < 10) {
                if (month == 0)
                    month = "01";
                else
                    month = "0" + month;
            }

            var curDate = day + "." + month + "." + d.getFullYear();

            $("#datepicker").val(curDate);

            $("#splash").show();
            loading2Show();
            $("#EmptyDiv").hide();

            if ($("#MBM1").attr("v7") == "On") {
                if ($("#MBM1").attr("v9") != "") {

                    //title
                    //$(".head2").html($("#MBM1").attr("v9"));
                    document.title = $("#MBM1").attr("v9");

                   
                    //$(".head2").show();
                }
            }

            

            if ($("#MBM1").attr("v22") == "1") {
                $("#DateTimeInfo").show();
            }

           

            if ($("#MBM1").attr("v15") == "0" || ($("#MoneyBoxLi").css("display") != "none" && $("#MBM1").attr("v15") == "1")) {
                $(".Alert").show();
            }
            else {
                $(".Alert").hide();
            }

           
            if ($("#MBM1").attr("v16") == "1") {
                var items = $("body").find("[uk]");

                for (var i = 0; i < items.length; i++) {
                    $(items[i]).html($(items[i]).attr("uk"));
                }
            }

            if ($("#MBM1").attr("v3") == "1") {
                $("#KeyLi").hide();
            }

            if ($("#MBM1").attr("v5") == "1") {
                $("#CartLi").hide();
            }

            if ($("#MBM1").attr("v8") == "On") {
                if ($("#MBM1").attr("v10") != "") {
                    $(".phone").html(($("#MBM1").attr("v16") == "1" ? "<div class='phone2'><span class='viber2'></span>" : "<div class='phone2'><span class='viber2'></span>") + " <a style='color: #fff; text-decoration: none' href='viber://chat/?number=%2B" + $("#MBM1").attr("v10").replace("+", "").replace("(", "").replace(")", "").replace(" ", "").replace("-", "") + "'>" + $("#MBM1").attr("v10") + "</a> | <a style='color: #ffff00; text-decoration: none;' href='viber://chat/?number=%2B" + $("#MBM1").attr("v10").replace("+", "").replace("(", "").replace(")", "").replace(" ", "").replace("-", "") + "'>перейти</a></div>");
                    $(".phoneinfo").show();
                    $(".phonedesc").html($("#MBM1").attr("v10"));
                }
            }

            $("#content_div").show();

            if ($.cookie("c_favors") != undefined && $.cookie("c_favors") != null && $.cookie("c_favors") != '' && (($.cookie("c_favors").indexOf(":") != -1 || $.cookie("c_favors").indexOf("%3A") != -1))) {
                var count = ($.cookie("c_favors").split(":").length - 1) / 2;
                if (count == 0) {
                    count = ($.cookie("c_favors").split("%3A").length - 1) / 2;
                }

                $(".heartcount").html(count);
            }

            if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '' && (($.cookie("c_cart").indexOf(":") != -1 || $.cookie("c_cart").indexOf("%3A") != -1))) {
                var count = ($.cookie("c_cart").split(":").length - 1) / 2;
                if (count == 0) {
                    count = ($.cookie("c_cart").split("%3A").length - 1) / 2;
                }

                $(".mcartcount").html(count);
            }

        if ($.cookie("c_client") != undefined && $.cookie("c_client") != null && $.cookie("c_client") != '') {

            currentEvent = "login";

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetClient",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"phone\":'', \"key\":'" + $.cookie("c_client") + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetClient
            });
        }
        else if (getUrlParameter("catalog") != '' && getUrlParameter("catalog") != undefined) {
            $("div.menu span.catalog").click();
        }
        else if (getUrlParameter("catsid") != '' && getUrlParameter("catsid") != undefined) {
            $("#splash2").show();
            loadingShow();

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetMainCats",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + getUrlParameter("catsid") + " }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetMainCats
            });
        }
        else {
            var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

            if (getUrlParameter("s") != '' && getUrlParameter("s") != undefined) {

                data_status = 0;
                currentEvent = "search";

                var ssid = sid_v;

                //if (getUrlParameter("ssid") != '' && getUrlParameter("ssid") != undefined) {
                //    ssid = getUrlParameter("ssid");
                //}

                var minp = $("#minp").val();

                if (getUrlParameter("minp") != undefined && getUrlParameter("minp") != '') {
                    minp = getUrlParameter("minp");
                }


                var maxp = $("#maxp").val();

                if (getUrlParameter("maxp") != undefined && getUrlParameter("maxp") != '') {
                    maxp = getUrlParameter("maxp");
                }

                var href1 = removeParam("minp", window.location.href);
                href1 = removeParam("maxp", href1);
                href1 = href1.replace("https://www.xpool.pro", '');

                window.history.pushState({}, "https://www.xpool.pro", href1);

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetData",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + ssid + ", \"desc\":'" + getUrlParameter("s") + "', \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "',  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"minp\":" + minp + ", \"maxp\":" + maxp + ", \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetData
                });
            }
            else if (getUrlParameter("id") != '' && getUrlParameter("id") != undefined) {
                if (extractHostname(window.location.origin).indexOf("monstro.com.ua") != -1 && getUrlParameter("sid") != '' && getUrlParameter("sid") != undefined) {
                    uid_v = 48;
                    sid_v = getUrlParameter("sid");
                }

                data_status = 0;
                currentEvent = "search";

                var ssid = sid_v;

                var minp = $("#minp").val();

                if (getUrlParameter("minp") != undefined && getUrlParameter("minp") != '') {
                    minp = getUrlParameter("minp");
                }


                var maxp = $("#maxp").val();

                if (getUrlParameter("maxp") != undefined && getUrlParameter("maxp") != '') {
                    maxp = getUrlParameter("maxp");
                }

                var id = getUrlParameter("id");

                var href1 = removeParam("minp", window.location.href);
                href1 = removeParam("maxp", href1);
                href1 = removeParam("id", href1);
                //href1 = href1.replace("https://www.xpool.pro", '');

                //window.history.pushState({}, "https://www.xpool.pro", href1);

                //if (getUrlParameter("cart") == "1") {
                var date = new Date();
                var minutes = 60;
                var hours = 24;
                var days = 365;
                date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                $.cookie("c_cart", ":" + id + "#1#" + sid_v + ":", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });

                if (window.innerWidth > 416) {
                    date = new Date();
                    var minutes = 60;
                    var hours = 24;
                    var days = 365;
                    date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                    $.cookie("c_view", "list", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                }

                $(".cartsum").html("1");

                $("#CartCount").click();
                //}
                //else {
                //    $.ajax({
                //        async: true,
                //        type: "POST",
                //        url: "https://xpool.pro/web/webform.aspx/GetData",
                //        data: "{ \"uid\":" + uid_v + ", \"sid\":" + ssid + ", \"desc\":'$" + id + "', \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "',  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"minp\":" + minp + ", \"maxp\":" + maxp + " }",
                //        contentType: "application/json; charset=utf-8",
                //        dataType: "json",
                //        success: bindGetData
                //    });
                //}
            }
            else if (getUrlParameter("ids") != '' && getUrlParameter("ids") != undefined) {

                data_status = 0;
                currentEvent = "search";

                var ssid = sid_v;

                //if (getUrlParameter("ssid") != '' && getUrlParameter("ssid") != undefined) {
                //    ssid = getUrlParameter("ssid");
                //}

                var minp = $("#minp").val();

                if (getUrlParameter("minp") != undefined && getUrlParameter("minp") != '') {
                    minp = getUrlParameter("minp");
                }


                var maxp = $("#maxp").val();

                if (getUrlParameter("maxp") != undefined && getUrlParameter("maxp") != '') {
                    maxp = getUrlParameter("maxp");
                }

                var ids = getUrlParameter("ids");


                var href1 = removeParam("minp", window.location.href);
                href1 = removeParam("maxp", href1);
                href1 = removeParam("ids", href1);
                href1 = href1.replace("https://www.xpool.pro", '');

                window.history.pushState({}, "https://www.xpool.pro", href1);

                if (getUrlParameter("cart") == "1") {
                    var date = new Date();
                    var minutes = 60;
                    var hours = 24;
                    var days = 365;
                    date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

                    $.cookie("c_cart", ids.replace(/\+/g, "#"), { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });

                    $(".mcartcount").html(getUrlParameter("ccount") != undefined ? getUrlParameter("ccount") : "0");

                    $("#CartCount").click();
                }
                else {
                    $.ajax({
                        async: true,
                        type: "POST",
                        url: "https://xpool.pro/web/webform.aspx/GetData",
                        data: "{ \"uid\":" + uid_v + ", \"sid\":" + ssid + ", \"desc\":'" + ids + "', \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "',  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"minp\":" + minp + ", \"maxp\":" + maxp + ", \"host\":'" + extractHostname(window.location.origin) + "' }",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: bindGetData
                    });
                }
            }
            else if (getUrlParameter("cat") != '' && getUrlParameter("cat") != undefined) {

                data_status = 2;
                currentEvent = "subcats";

                var ssid = sid_v;

                if (getUrlParameter("ssid") != '' && getUrlParameter("ssid") != undefined) {
                    ssid = getUrlParameter("ssid");
                }

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetSubCats",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + ssid + ", \"path\":'" + getUrlParameter("cat").replace(/_/g, " ") + "', \"status\":1, \"startRecord\":" + startRecord + ",  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetSubCats
                });
            }
            else if (getUrlParameter("feed") == "google") {
                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetGoogleFeedData",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetGoogleFeedData
                });
            }
            else if (getUrlParameter("sv") == "0") {
                data_status = 1;
                currentEvent = "new";

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetNewData",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetNewData
                });
            }
            else if (getUrlParameter("sv") == "1") {
                data_status = 4;
                currentEvent = "best";

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetTopRatedData",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetTopRatedData
                });
            }
            else if (getUrlParameter("sv") == "2") {
                data_status = 5;
                currentEvent = "discount";

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetTopDiscount",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetTopDiscount
                });
            }
            //else if (getUrlParameter("sv") == "3") 
            //{
            //    $(".moneyboxm").click();
            //}
            else if (getUrlParameter("sv") == "4") {
                $("#CartCount").click();
            }
            else if (getUrlParameter("sv") == "5") {
                $("#FavCount").click();
            }
            else if ($("#MBM1").attr("v6") == "0") {

                data_status = 1;
                currentEvent = "new";

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetNewData",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetNewData
                });
            }
            else if ($("#MBM1").attr("v6") == "1") {

                data_status = 4;
                currentEvent = "best";

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetTopRatedData",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetTopRatedData
                });
            }
            else if ($("#MBM1").attr("v6") == "2") {

                data_status = 5;
                currentEvent = "discount";

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetTopDiscount",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetTopDiscount
                });
            }
        }
    };

    var data_status = 1;

    var lastScrollTop = 0;

    $(window).scroll(function () {

        var $cache = $('#MenuDIV');
        if (($(window).scrollTop() > menu_offset && menu_offset != null)) {
            $cache.css({
                'position': 'fixed',
                'top': '29px'
            });
        }
        //else
        //    $cache.css({
        //        'position': 'absolute',
        //        'top': 'auto'
        //    });


        var st = $(this).scrollTop();
        if (st > lastScrollTop && $(window).scrollTop() + window.innerHeight > document.body.clientHeight - 150) {
            if (((startRecord % 15) == 0) && (($("#loading2").css('display') == "none" && $("#splash").css('display') == "none" && $("#RatesDiv").css('display') == "none" && $("#splash2").css('display') == "none") || $("#viewer").css('display') != "none")) {
                DataSLoad();
            }
        }

        lastScrollTop = st;
    });


    function DataSLoad() {
        var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();

        if (getUrlParameter("feed") == "google") {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetGoogleFeedData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetGoogleFeedData
            });
        }
        else if (data_status == 0) {
            loading2Show();
            var ss = $("#search input.searchtext").val();

            if ((ss == undefined || ss == '') && getUrlParameter("s") != '' && getUrlParameter("s") != undefined) {
                ss = getUrlParameter("s");
            }

            var minp = $("#minp").val();

            if (getUrlParameter("minp") != undefined && getUrlParameter("minp") != '') {
                minp = getUrlParameter("minp");
            }


            var maxp = $("#maxp").val();

            if (getUrlParameter("maxp") != undefined && getUrlParameter("maxp") != '') {
                maxp = getUrlParameter("maxp");
            }

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"desc\":'" + ss + "', \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "',  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"minp\":" + minp + ", \"maxp\":" + maxp + ", \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetData
            });
        }
        else if (data_status == 1) {
            loading2Show();
            currentEvent = "new";
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetNewData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "',  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetNewData
            });
        }
        else if (data_status == 2) {
            loading2Show();
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetSubCats",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(".TitleSpan").attr("sid") + ", \"path\":'" + $('.TitleSpan').attr("path") + "', \"status\":1, \"startRecord\":" + startRecord + ",  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetSubCats
            });
        }
        else if (data_status == 3) {
            loading2Show();
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetSubCats",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(".TitleSpan").attr("sid") + ", \"path\":'" + $('.TitleSpan').attr("path") + "', \"status\":1, \"startRecord\":" + startRecord + ",  \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetSubCats2
            });
        }
        else if (data_status == 4) {
            loading2Show();
            currentEvent = "best";

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetTopRatedData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetTopRatedData
            });
        }
        else if (data_status == 5) {
            loading2Show();
            currentEvent = "discount";

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetTopDiscount",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetTopDiscount
            });
        }
        else if (data_status == 10) {
            loading2Show();
            currentEvent = "clientlog";

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetClientLog",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"client_id\":" + $("#MainBalance").attr("client_id") + ", \"startRecord\":" + startRecord + ", \"type\":0 }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetClientLog
            });
        }
    }


    function GetNormalImage(img, source) {
        var res;

        if (img != null && img != undefined && img != '' && img.split("||")[0].indexOf('/img/nophoto2.png') == -1) {
            res = "https://xpool.pro/imagefeeder.ashx?s=" + source.split("||")[0] + "&c=1";
        }
        else {
            res = 'https://xpool.pro/web/source/' + $("#TargetStyleSheet").attr("st") + '/img/nophoto.png';
        }

        return res;
    }

    function GetDiscount(oldprice, price) {
        var res = '';

        var v_oldprice = parseFloat(oldprice);
        var v_price = parseFloat(price);

        if (v_oldprice > 0 && v_price > 0) {
            var perc = ((v_oldprice / v_price) * 100);

            res = '<span class="pdiscount">' + perc.toFixed(0) + '<span class=\"disper\">%</span></span>';
        }

        return res;
    }

    function TimeSelectView(status, sid) {
        var time_select = '';

        if (status != null && status != '' && $("#TimeComponents").val() != "") {
            var t_comp = $("#TimeComponents").val().split('#');

            if ($.cookie("c_view") == "list")
                time_select = '<select class="timeselect" style="width: 186px; margin-left: 0px">';
            else
                time_select = '<select class="timeselect">';

            var arr = [];

            for (var i = 0; i < t_comp.length; i++) {
                if (t_comp[i] != '') {
                    var t_comp_parts = t_comp[i].split("$");

                    if (parseInt(t_comp_parts[0]) == sid) {
                        var t_comp_parts_cond = t_comp_parts[3].split("|");

                        if (t_comp_parts_cond[3] != "2") {
                            arr.push({ text: t_comp_parts[2], v: t_comp_parts[1], t: t_comp_parts_cond[0], p: t_comp_parts_cond[1], f: t_comp_parts_cond[2], s: t_comp_parts_cond[3] })
                        }
                    }
                }
            }

            if (status == "3" || status == "4")
                arr.sort(function (o1, o2) { return o1.v < o2.v ? -1 : o1.v > o2.v ? 1 : 0; });
            else
                arr.sort(function (o1, o2) { return o1.v > o2.v ? -1 : o1.v < o2.v ? 1 : 0; });

            for (var i = 0; i < arr.length; i++) {

                time_select += "<option v='" + arr[i].v + "' t='" + arr[i].t + "' p='" + arr[i].p + "' f='" + arr[i].f + "' s='" + arr[i].s + "'>" + arr[i].text + "</option>";
            }

            time_select += "</select>";
        }

        return time_select;
    }

    function SetTimeViewPrice(timeview, dataid, status, count) {
        var product = $("#ProductsListView").find('[dataid="' + dataid + '"]');

        var sel_option = undefined;

        if (status == 0) {
            if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '') {
                $(timeview).children().each(function () {
                    if ($.cookie("c_cart").indexOf(dataid + "+" + $(this).attr("v") + "#") != -1) {
                        sel_option = $(this);
                        $(timeview).val(sel_option.text());
                    }
                });
            }
        }
        else {
            sel_option = $(timeview).find("option:selected");
        }

        if (sel_option == undefined)
            sel_option = $(timeview).find("option:selected");


        $(product).find(".price").first().attr("lp", product.find(".price").first().text());

        if (sel_option.attr("f") == "грн") {
            if (product.find(".price").first().html() != undefined)
                product.find(".price").first().html(sel_option.attr("p") + '<span class=\"uah\">грн</span>');
            else
                product.find(".oldprice").first().html(sel_option.attr("p") + '<span class=\"uah\">грн</span>');

            var perc = 0.02;

            if (custom_perc == false) {
                if (parseFloat(sel_option.attr("p")) > 500) {
                    perc = 0.015;
                }
                else
                    perc = 0.02;
            }

            if ($("#MBM1").attr("v4") == "0" || ($("#MoneyBoxLi").css("display") != "none" && $("#MBM1").attr("v4") == "1")) {
                if ($("div.menu span.moneyboxm").val() != undefined && perc > 0) {

                    var bonus = 0;

                    bonus = price * perc;

                    var b = bonus.toFixed(2).split('.');

                    if (bonus > 100)
                        $(product).find(".moneybox").first().html(b[0]);
                    else
                        $(product).find(".moneybox").first().html(b[0] + '<span class=\"coins\">' + b[1] + '</span>');
                }
            }
        }
        else {

            var price = (parseFloat(sel_option.attr("p")) * parseFloat(product.attr("price")) / 100);

            if (product.find(".price").first().html() != undefined)
                product.find(".price").first().html(price.toFixed(0) + '<span class=\"uah\">грн</span>');
            else
                product.find(".oldprice").first().html(price.toFixed(0) + '<span class=\"uah\">грн</span>');

            var perc = 0.02;

            if (custom_perc == false) {
                if (price > 500) {
                    perc = 0.015;
                }
                else
                    perc = 0.02;
            }

            if ($("#MBM1").attr("v4") == "0" || ($("#MoneyBoxLi").css("display") != "none" && $("#MBM1").attr("v4") == "1")) {
                if ($("div.menu span.moneyboxm").val() != undefined && perc > 0) {

                    var bonus = 0;

                    bonus = price * perc;

                    var b = bonus.toFixed(2).split('.');

                    if (bonus > 100)
                        $(product).find(".moneybox").first().html(b[0]);
                    else
                        $(product).find(".moneybox").first().html(b[0] + '<span class=\"coins\">' + b[1] + '</span>');
                }
            }
        }

        if (sel_option.attr("s") == "1") {
            product.find(".cart").first().hide();
            product.find(".cart").first().hide();
        }
        else {
            if (parseFloat(count) > 0) {
                product.find(".cart").first().show();
                product.find(".cart").first().show();
            }
        }

        if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '' && (($.cookie("c_cart").indexOf(":" + $(product).attr("dataid") + "+" + sel_option.attr("v")) != -1 || $.cookie("c_cart").indexOf("%3A" + $(product).attr("dataid") + "+" + sel_option.attr("v") + "#") != -1))) {

            $(product).find(".cart1").attr("class", "cart2");

            $(product).find(".cart2").attr("code", $(product).attr("dataid"));
            $(product).find(".cart2").attr("sid", $(product).attr("shopid"));
        }
        else {

            $(product).find(".cart2").attr("class", "cart1");

            $(product).find(".cart1").attr("code", $(product).attr("dataid"));
            $(product).find(".cart1").attr("sid", $(product).attr("shopid"));
        }
    }

    $("#ProductsListView").delegate(".timeselect", "change", function () {
        SetTimeViewPrice($(this), $(this).closest('.product').attr("dataid"), 1, $(selected).attr("ct"));
    });

    function EnableSetCount(set_count, code) {

        res = '';

        var count = -1;

        if (set_count == 1) {



            if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '') {

                var parts = $.cookie("c_cart").split(":");

                for (var i = 0; i < parts.length; i++) {
                    if (parts[i].indexOf(code + "#") != -1 || parts[i].indexOf(code + "+") != -1) {
                        var parts2 = parts[i].split("#");
                        if (parts2.indexOf("+") != -1) {
                            count = parseInt(parts2.split("+")[1]);
                        }
                        else
                            count = parseInt(parts2[1]);
                    }
                }
            }

            if ($.cookie("c_view") == "list")
                res = '<div class="setcount" style="margin-left: 0px;"><ul><li><span class="dec"><</span></li><li><span class="val">' + count.toString() + '</span></li><li><span class="inc">></span></li></ul></div>';
            else
                res = '<div class="setcount"><ul><li><span class="dec"><</span></li><li><span class="val">' + count.toString() + '</span></li><li><span class="inc">></span></li></ul></div>';
        }

        return [res, count];
    }

    function EnableSetComment(set_count, code, cur_sid) {
        res = '';
        var comment = $("#MBM1").attr("v16") == "1" ? "коментар" : "комментарий";

        if (set_count == 1) {
            if ($.cookie("c_comments") != undefined && $.cookie("c_comments") != null && $.cookie("c_comments") != '') {

                var parts = $.cookie("c_comments").split(":");

                for (var i = 0; i < parts.length; i++) {
                    if (parts[i].indexOf(code + "#") != -1) {
                        var parts2 = parts[i].split("#");
                        comment = parts2[1];
                    }
                }
            }

            if ($.cookie("c_view") == "list")
                res = '<div class="' + ((comment == "комментарий" || comment == "коментар") ? "addcomment" : "addcomment2") + '" style="margin-left: 0px;" code="' + code + '" sid="' + cur_sid + '">' + comment + '</div>';
            else
                res = '<div class="' + ((comment == "комментарий" || comment == "коментар") ? "addcomment" : "addcomment2") + '" code="' + code + '" sid="' + cur_sid + '">' + comment + '</div>';
        }

        return res;
    }

    $("#ProductsListView").delegate("span.dec", "click", function () {
        if (parseInt($(this).parent().next().children().first().html()) > 0) {
            $(this).parent().next().children().first().html(function (i, oldval) {
                return --oldval;
            });

            var date = new Date();
            var minutes = 60;
            var hours = 24;
            var days = 365;
            date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

            var code = $(this).closest('.product').attr("dataid");

            if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '') {

                var parts = $.cookie("c_cart").split(":");

                for (var i = 0; i < parts.length; i++) {
                    if (parts[i].indexOf(code + "#") != -1 || parts[i].indexOf(code + "+") != -1) {

                        var parts2 = parts[i].split("#");

                        if (parseInt(parts2[1]) > 0) {
                            var val_new = parts2[0] + "#" + (parseInt(parts2[1]) - 1).toString() + "#" + parts2[2];

                            var p_price;

                            if ($(this).closest('.product').find(".price").html() == undefined) {
                                p_price = parseFloat($(this).closest('.product').find(".oldprice").text());
                            }
                            else {
                                p_price = parseFloat($(this).closest('.product').find(".price").text());
                            }

                            $(".cartsum").html((parseFloat($(".cartsum").html()) - p_price).toString() + "<span>грн</span>");

                            $.cookie("c_cart", $.cookie("c_cart").replace(":" + parts[i] + ":", ":" + val_new + ":"), { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                        }
                    }
                }
            }
        }
    });

    $("#ProductsListView").delegate("span.inc", "click", function () {
        if (parseInt($(this).parent().prev().children().first().html()) < parseFloat($(this).closest('.product').attr("maxcount"))) {
            $(this).parent().prev().children().first().html(function (i, oldval) {
                return ++oldval;
            });

            var date = new Date();
            var minutes = 60;
            var hours = 24;
            var days = 365;
            date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

            var code = $(this).closest('.product').attr("dataid");

            if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '') {

                var parts = $.cookie("c_cart").split(":");

                for (var i = 0; i < parts.length; i++) {
                    if (parts[i].indexOf(code + "#") != -1 || parts[i].indexOf(code + "+") != -1) {


                        var parts2 = parts[i].split("#");


                        var val_new = parts2[0] + "#" + (parseInt(parts2[1]) + 1).toString() + "#" + parts2[2];

                        var p_price;

                        if ($(this).closest('.product').find(".price").html() == undefined) {
                            p_price = parseFloat($(this).closest('.product').find(".oldprice").text());
                        }
                        else {
                            p_price = parseFloat($(this).closest('.product').find(".price").text());
                        }

                        $(".cartsum").html((parseFloat($(".cartsum").html()) + p_price).toString() + "<span>грн</span>");

                        $.cookie("c_cart", $.cookie("c_cart").replace(":" + parts[i] + ":", ":" + val_new + ":"), { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                    }
                }
            }
        }
    });

    function FreeDelivery(free_delivery, custom_value) {

        var res = '';

        if (custom_value == null) {
            if (free_delivery == 1) {
                res = '<span class="pdelivery"></span>';
            }
        }
        else if (custom_value == true) {
            res = '<span class="pdelivery"></span>';
        }

        return res;
    }

    function GetRate(rating) {
        var res = '';

       

        return res;
    }

    function GetDiscount2(oldprice, price) {
        var res = '';

        return res;
    }

    function GetMoneybox(perc, price) {
        var res = '';

        if ($("#MBM1").attr("v4") == "0" || ($("#MoneyBoxLi").css("display") != "none" && $("#MBM1").attr("v4") == "1")) {
            if ($("div.menu span.moneyboxm").val() != undefined && perc > 0) {

                var bonus = 0;

                bonus = price * perc;

                var b = bonus.toFixed(2).split('.');

                if (bonus > 100)
                    res = '<li><span class="moneybox">' + b[0] + '</span></li>';
                else
                    res = '<li><span class="moneybox">' + b[0] + '<span class=\"coins\">' + b[1] + '</span></span></li>';
            }
        }

        return res;
    }

    function GetPriceView(oldprice, price, count) {
        var res = '';

        var price = parseFloat(price);
        var oldprice = parseFloat(oldprice);
        var count = parseFloat(count);

        if (count > 0) {
            if (oldprice > 0) {
                if ($("#MBM1").attr("v2") == "0" || $("#MBM1").attr("v2") == "2" || ($("#MoneyBoxLi").css("display") != "none" && $("#MBM1").attr("v2") == "1")) {
                    res = '<li style="position: relative; width: 102px;"><span class="oldprice">' + parseFloat(price) + '<span class=\"uah\">грн</span></span></li>';
                }
            }
            else {
                if ($("#MBM1").attr("v2") == "0" || ($("#MoneyBoxLi").css("display") != "none" && $("#MBM1").attr("v2") == "1")) {
                    res = '<li style="position: relative; width: 102px;"><span class="price">' + price.toFixed(2) + '<span class=\"uah\">грн</span></span></li>';
                }
            }
        }
        else {
            res = '<li style="position: relative; width: 102px;"><span class="oldprice" style="background-color: #666666">Продано</span></li>';
        }

        return res;
    }

    function GetRateView(id, status, price) {
        var res = '';

        if ($.cookie("c_favors") != undefined && $.cookie("c_favors") != null && $.cookie("c_favors") != '' && (($.cookie("c_favors").indexOf(":" + id + ":") != -1 || $.cookie("c_favors").indexOf("%3A" + id + "%3A") != -1)))
            res = '<li><span class="rate2" code="' + id + '"></span></li>';
        else
            res = '<li><span class="rate1" code="' + id + '"></span></li>';

        return res;
    }

    function GetCartView(disable_trade, id, status, price, sid, count, trade_info, _status) {
        var res = '';

        if (disable_trade == 0 && count > 0) {
            if ($.cookie("c_view") == "list") {
                if ((trade_info == "1" || (sid == 3692 && price > 1200)) && count == 1 && _status == 0) {
                    res = '<div class="pickup" style="width: 190px; margin-left: 0px">' + ($("#MBM1").attr("v16") == "1" ? "Самовивіз" : "Самовывоз") + '</div>';
                }
                else {
                    if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '' && (($.cookie("c_cart").indexOf(":" + id + "#") != -1 || $.cookie("c_cart").indexOf("%3A" + id + "#") != -1)))
                        res = '<div class="cart" style="width: 190px; margin-left: 0px"><span class="cart2" code="' + id + '" sid="' + sid + '"></span><span class="tocart" style="left:36px; -webkit-transform: translateX(0%);">' + ($("#MBM1").attr("v16") == "1" ? "Видалити" : "Убрать") + '</span></div>';
                    else
                        res = '<div class="cart" style="width: 190px; margin-left: 0px"><span class="cart1" code="' + id + '" sid="' + sid + '"></span><span class="tocart" style="left:36px; -webkit-transform: translateX(0%);">' + ($("#MBM1").attr("v16") == "1" ? "Купити" : "Купить") + '</span></div>';
                }
            }
            else {
                if ((trade_info == "1" || (sid == 3692 && price > 1200)) && count == 1 && _status == 0) {
                    res = '<div class="pickup">' + ($("#MBM1").attr("v16") == "1" ? "Самовивіз" : "Самовывоз") + '</div>';
                }
                else {
                    if ($.cookie("c_cart") != undefined && $.cookie("c_cart") != null && $.cookie("c_cart") != '' && (($.cookie("c_cart").indexOf(":" + id + "#") != -1 || $.cookie("c_cart").indexOf("%3A" + id + "#") != -1)))
                        res = '<div class="cart"><span class="cart2" code="' + id + '" sid="' + sid + '"></span><span class="tocart">' + ($("#MBM1").attr("v16") == "1" ? "Видалити" : "Убрать") + '</span></div>';
                    else
                        res = '<div class="cart"><span class="cart1" code="' + id + '" sid="' + sid + '"></span><span class="tocart">' + ($("#MBM1").attr("v16") == "1" ? "Купити" : "Купить") + '</span></div>';
                }
            }
        }

        return res;
    }

    function GetAdmin(id, status) {
        var res = '';
        if ($("#c_admin").val() != '')
            if (status != null && status == 110) {
                res = "target=\"_blank\" href=\"editview.aspx?ID2=" + id + "\"";
            }
            else {
                res = "target=\"_blank\" href=\"editview.aspx?ID=" + id + "\"";
            }

        return res;
    }

    $("#CreateOrder").click(function () {
        
        if ($(".cartsum").text() != "0грн") {

            if ($("#col1").children().length == 0) {

                $("#splash").show();
                loadingShow();

                var city, warehouse;

                city = $("#CurrentCityTextBox").val();
                warehouse = $("#CurrentWarehouseTextBox").val();

                var addr = "";

                if (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") != -1) {
                    city = "Тернівка (місцевий)";
                    addr = "Клякса Маяк";
                }


                if ($("#DeliveryTypeSelect").val() == 2) {
                    addr = $("#AddressTextBox").val();
                    if ($("#HouseTextBox").val() == '' || $("#FlatTextBox").val() == '')
                        addr = '';
                }
                else
                    addr = warehouse;

                if (city == '' || addr == '' || $("#PhoneTextBox").val() == '' || $("#PhoneTextBox").val().indexOf("_") > 0 || $("#NameTextBox").val() == '' || ($("#SecondNameTextBox") != undefined && $("#SecondNameTextBox").val() == '') || ($("#PatronymicTextBox") != undefined && $("#PatronymicTextBox").val() == '')) {
                    alert("Перед відправкою необхідно заповнити всі поля");
                    if ($("#PhoneTextBox").val().indexOf("_") != -1 || $("#PhoneTextBox").val() == '') {
                        $("#PhoneTextBox").css("background-color", "#FF8888");
                    }
                    if (city == '') {
                        $("#CurrentCityTextBox").css("background-color", "#FF8888");
                    }
                    if (addr == '') {
                        if ($("#DeliveryTypeSelect").val() == 2) {

                            if ($("#AddressTextBox").val() == '') {
                                $("#AddressTextBox").css("background-color", "#FF8888");
                            }

                            if ($("#HouseTextBox").val() == '') {
                                $("#HouseTextBox").css("background-color", "#FF8888");
                            }

                            if ($("#FlatTextBox").val() == '') {
                                $("#FlatTextBox").css("background-color", "#FF8888");
                            }
                        }
                        else
                            $("#CurrentWarehouseTextBox").css("background-color", "#FF8888");
                    }
                    if ($("#NameTextBox").val() == '') {
                        $("#NameTextBox").css("background-color", "#FF8888");
                    }
                    if ($("#SecondNameTextBox").val() == '') {
                        $("#SecondNameTextBox").css("background-color", "#FF8888");
                    }
                    if ($("#PatronymicTextBox").val() == '') {
                        $("#PatronymicTextBox").css("background-color", "#FF8888");
                    }

                    $("#splash").hide();
                    loadingHide();
                    var n = $(document).height();
                    $('html, body').animate({ scrollTop: n }, 500);

                }
                else {
                    $("#splash").hide();
                    loadingHide();

                    $("#CabinetTable").hide();

                    $("#PayOrder").children().remove();


                    //if (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") != -1) {
                    $("#PayOrder").append('<tr><td id="GoToCabinet2" class="GoCabinet" width="100%;">' + ($("#MBM1").attr("v16") == "1" ? "Сплатити при отриманні" : "Оплатить при получении") + '</td></tr>');
                    //}
                    //else {

                    //    var _sum = parseFloat($(".cartsum").html());
                    //    var prepay_sum = 100;

                    //    if (_sum > 10000) {
                    //        prepay_sum = 500;
                    //    }
                    //    else if (_sum > 5000)
                    //        prepay_sum == 250;
                    //    else if (_sum > 2000)
                    //        prepay_sum == 200;

                    //    if (_sum > 100)
                    //        $("#PayOrder").append('<tr><td id="PayOnline2" class="GoPrepay" width="100%" style="width: ' + $("#CreateNewOrder").innerWidth() + 'px"">' + ($("#MBM1").attr("v16") == "1" ? "Сплатити передплату" : "Оплатить предоплату") + ' <img src="https://static.liqpay.ua/buttons/logo-small.png" name="btn_text" style="margin-right: 7px !important; vertical-align: middle !important;"/><br/><span id="PrepaySum" style="font: normal 18px arial;">' + prepay_sum + ' грн</span></td></tr>');

                    //    $("#PayOrder").append('<tr><td id="PayOnline" class="GoPay" width="100%" style="margin-top: 2px; width: ' + $("#CreateNewOrder").innerWidth() + 'px">' + ($("#MBM1").attr("v16") == "1" ? "Сплатити онлайн" : "Оплатить онлайн") + ' <img src="https://static.liqpay.ua/buttons/logo-small.png" name="btn_text" style="margin-right: 7px !important; vertical-align: middle !important;"/></td></tr>');

                    //    $("#PayOrder").append('<tr><td class="PayInfo" width="100%"><div style="text-align: center; padding: 10px; margin-top: 2px; width: ' + $("#CreateNewOrder").innerWidth() + 'px""><span class= "Visa"></span><span class="MasterCard"></span><br/>ФОП Краснікова О.С. РНОКПП: 2374202227</div></td></tr>');

                    //}

                    $("#PayOrder").show();
                    $("#CreateOrder").hide();
                }

                //var client_id = $("#MainBalance").attr("client_id");

                //if (client_id == undefined || client_id == '')
                //    client_id = 0;
            }
            else {
                $("#col1").children().remove();
                $("#col2").children().remove();
                $("#col3").children().remove();
                $("#CabinetTable").children().remove();

                if (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") != -1) {
                    $("#CabinetTable").append('<tr id="d_tr9" class="ItemContainer"><td class="cheque" id="PhoneTD">Телефон:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr10" class="ItemContainer"><td class="cheque"><input id="PhoneTextBox" type="tel" style="font: 20px/20px Arial; text-align: center;" /></td></tr>');

                    $("#CabinetTable").append('<tr id="d_tr13" class="ItemContainer"><td class="cheque" id="NameTD" uk="Ім\'я:">Имя:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr14" class="ItemContainer"><td class="cheque"><input id="NameTextBox" type="text" style="font: 20px/20px Arial; text-align: center;" /></td></tr>');
                }
                else {
                    $("#CabinetTable").append('<tr id="d_tr9" class="ItemContainer"><td class="cheque" id="PhoneTD">Телефон:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr10" class="ItemContainer"><td class="cheque"><input id="PhoneTextBox" type="tel" style="font: 20px/20px Arial; text-align: center;" /></td></tr>');

                    $("#CabinetTable").append('<tr id="d_tr1" class="ItemContainer"><td class="cheque" uk="Місто:">Город:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr2" class="ItemContainer"><td class="cheque"><textarea id="CurrentCityTextBox" maxlength="500" rows="2" cols="30" style="width: 284px; padding: 5px; font: normal 18px arial; display: block;"></textarea></td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr3" class="ItemContainer"><td class="cheque" uk="Доставка:">Доставка:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr4" class="ItemContainer"><td class="cheque"><select id="DeliveryTypeSelect" style="font: 20px/20px Arial; text-align: center; width: 284px"><option value="1" uk="До відділення">До отделения</option><option value="2" uk="Адресна">Адресная</option></select></td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr5" class="ItemContainer" v="1"><td class="cheque" uk="Відділення:">Отделение:</td></tr>');

                    $("#CabinetTable").append('<tr id="d_tr6" class="ItemContainer" v="1"><td class="cheque"><textarea id="CurrentWarehouseTextBox" readonly maxlength="500" rows="2" cols="30" style="width: 284px; padding: 5px; font: normal 18px arial; display: block;"></textarea></td></tr>');

                    $("#CabinetTable").append('<tr id="d_tr7" class="ItemContainer" v="2" style="display: none"><td class="cheque" id="AddressTD" uk="Вулиця:">Улица:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr8" class="ItemContainer" v="2" style="display: none"><td class="cheque"><textarea id="AddressTextBox" maxlength="500" rows="3" cols="30" style="width: 294px; padding: 5px; font: normal 18px arial; display: block;"></textarea></td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr22" class="ItemContainer" v="2" style="display: none"><td class="cheque" id="HouseTD" uk="Номер будинку:">Номер дома:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr20" class="ItemContainer" v="2" style="display: none"><td class="cheque"><input id="HouseTextBox" type="text" style="font: 20px/20px Arial; text-align: center; width: 50px;" /></td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr23" class="ItemContainer" v="2" style="display: none"><td class="cheque" id="FlatTD" uk="Номер поверху:">Номер этажа:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr21" class="ItemContainer" v="2" style="display: none"><td class="cheque"><input id="FlatTextBox" type="text" style="font: 20px/20px Arial; text-align: center; width: 50px;" /></td></tr>');

                    $("#CabinetTable").append('<tr id="d_tr11" class="ItemContainer"><td class="cheque" id="SecondNameTD" uk="Прізвище:">Фамилия:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr12" class="ItemContainer"><td class="cheque"><input id="SecondNameTextBox" type="text" style="font: 20px/20px Arial; text-align: center;" /></td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr13" class="ItemContainer"><td class="cheque" id="NameTD" uk="Ім\'я:">Имя:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr14" class="ItemContainer"><td class="cheque"><input id="NameTextBox" type="text" style="font: 20px/20px Arial; text-align: center;" /></td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr24" class="ItemContainer"><td class="cheque" id="PatronymicTD" uk="По-батькові:">Отчество:</td></tr>');
                    $("#CabinetTable").append('<tr id="d_tr25" class="ItemContainer"><td class="cheque"><input id="PatronymicTextBox" type="text" style="font: 20px/20px Arial; text-align: center;" /></td></tr>');

                    $("#CabinetTable").append('<tr class="ItemContainer"><td class="cheque" style="font-size: small;"><a target="_blank" href="" style="color: #fff; text-decoration: none">Гарантія</a> і <a target="_blank" href="https://xpool.pro/source/bgy6q-1g33z.html" style="color: #fff; text-decoration: none">Публічна оферта</a></td></tr>');

                    $("#CabinetTable").append('<tr class="ItemContainer"><td class="cheque" style="font-size: small">Вартість доставки: за тарифам Нової Пошти</td><tr>');

                    $("#DeliveryTypeSelect").val("1");
                }

                fillLangContent();

                $("#PhoneTextBox").inputmask("+38 999 999 9999");


                if ($("#MBM1").attr("v19") == "0") {
                    if ($.cookie("c_client_phone") != undefined && $.cookie("c_client_phone") != null && $.cookie("c_client_phone") != '') {
                        $("#PhoneTextBox").val($.cookie("c_client_phone"));
                    }
                }
                else if ($("#MBM1").attr("v19") == "1") {
                    $("#d_tr1").hide(); $("#d_tr2").hide(); $("#d_tr3").hide(); $("#d_tr4").hide(); $("#d_tr5").hide(); $("#d_tr6").hide(); $("#d_tr7").show(); $("#d_tr8").show();

                    if ($.cookie("c_client_phone") != undefined && $.cookie("c_client_phone") != null && $.cookie("c_client_phone") != '') {
                        $("#PhoneTextBox").val($.cookie("c_client_phone"));
                    }
                }
                else if ($("#MBM1").attr("v19") == "2") {
                    $("#d_tr1").hide(); $("#d_tr2").hide(); $("#d_tr3").hide(); $("#d_tr4").hide(); $("#d_tr5").hide(); $("#d_tr6").hide();

                    if ($.cookie("c_client_phone") != undefined && $.cookie("c_client_phone") != null && $.cookie("c_client_phone") != '') {
                        $("#PhoneTextBox").val($.cookie("c_client_phone"));
                    }
                }
                else {
                    $("#d_tr1").hide(); $("#d_tr2").hide(); $("#d_tr3").hide(); $("#d_tr4").hide(); $("#d_tr5").hide(); $("#d_tr6").hide(); $("#d_tr11").hide(); $("#d_tr12").hide(); $("#d_tr13").hide(); $("#d_tr14").hide();

                    if ($.cookie("c_client_phone") != undefined && $.cookie("c_client_phone") != null && $.cookie("c_client_phone") != '') {
                        $("#PhoneTextBox").val($.cookie("c_client_phone"));
                    }
                }

                $("#CabinetTable").show();

                $("#ContentDIV").animate({ scrollLeft: 1000 }, 0);
                $("#ContentDIV").animate({ scrollLeft: 0 }, 500);

                $.ajax({
                    async: true,
                    type: "POST",
                    url: "https://xpool.pro/web/webform.aspx/GetLastOrderInfo",
                    data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"phone\":'" + ConvertPhone($("#PhoneTextBox").val()) + "' }",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: bindGetLastOrderInfo
                });

                $("#splash").hide();
                $("#splash2").hide();
            }
        }
        else {
            alert($("#MBM1").attr("v16") == "1" ? "кошик порожній" : "корзина пустая");

            $("#splash").hide();
            $("#splash2").hide();
        }
    });

    $("#CabinetTable").delegate('#PhoneTextBox', 'keyup input', function () {
        if ($('#PhoneTextBox').val().indexOf("_") == -1) {
       
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetLastOrderInfo",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"phone\":'" + ConvertPhone($("#PhoneTextBox").val()) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetLastOrderInfo
            });
        }
    });

    $("#PayOrder").delegate("#PayOnline", "click", function () {

        loadingShow();
        $("#splash").show();

        var client_id = $("#MainBalance").attr("client_id");

        if (client_id == undefined || client_id == '')
            client_id = 0;

        if (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") != -1) {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/CreateNewOrder",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"client_id\":" + client_id + ", \"phone\":'" + ConvertPhone($("#PhoneTextBox").val()) + "', \"cartdata\":'" + $.cookie("c_cart") + "', \"delivery_type\":'" + $("#DeliveryTypeSelect").val() + "', \"warehouse\":'', \"area\":'', \"city\":'', \"address\":'" + $("#AddressTextBox").val() + "', \"house\":'', \"flat\":'', \"name\":'" + $("#NameTextBox").val() + "', \"secondname\":'', \"patronymic\":'', \"city_ref\":'', \"warehouse_ref\":'', \"address_ref\":'', \"comments\":'" + $.cookie("c_comments") + "', \"ctime\":'" + (getUrlParameter("c_time") != undefined ? getUrlParameter("c_time") : '') + "', \"refer\":'" + (getUrlParameter("refer") != undefined ? getUrlParameter("refer") : '') + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindCreateNewOrder2
            });
        }
        else {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/CreateNewOrder",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"client_id\":" + client_id + ", \"phone\":'" + ConvertPhone($("#PhoneTextBox").val()) + "', \"cartdata\":'" + $.cookie("c_cart") + "', \"delivery_type\":'" + $("#DeliveryTypeSelect").val() + "', \"warehouse\":'" + $("#CurrentWarehouseTextBox").val() + "', \"area\":'', \"city\":'" + $("#CurrentCityTextBox").val() + "', \"address\":'" + $("#AddressTextBox").val() + "', \"house\":'" + $("#HouseTextBox").val() + "', \"flat\":'" + $("#FlatTextBox").val() + "', \"name\":'" + $("#NameTextBox").val() + "', \"secondname\":'" + $("#SecondNameTextBox").val() + "', \"patronymic\":'" + $("#PatronymicTextBox").val() + "', \"city_ref\":'" + $("#CurrentCityTextBox").attr("city_id") + "', \"warehouse_ref\":'" + $("#CurrentWarehouseTextBox").attr("warehouse_id") + "', \"address_ref\":'" + $("#AddressTextBox").attr("address_id") + "', \"comments\":'" + $.cookie("c_comments") + "', \"ctime\":'" + (getUrlParameter("c_time") != undefined ? getUrlParameter("c_time") : '') + "', \"refer\":'" + (getUrlParameter("refer") != undefined ? getUrlParameter("refer") : '') + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindCreateNewOrder2
            });
        }
    });

    $("#PayOrder").delegate("#PayOnline2", "click", function () {

        loadingShow();
        $("#splash").show();

        var client_id = $("#MainBalance").attr("client_id");

        if (client_id == undefined || client_id == '')
            client_id = 0;

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/CreateNewOrder",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"client_id\":" + client_id + ", \"phone\":'" + ConvertPhone($("#PhoneTextBox").val()) + "', \"cartdata\":'" + $.cookie("c_cart") + "', \"delivery_type\":'" + $("#DeliveryTypeSelect").val() + "', \"warehouse\":'" + $("#CurrentWarehouseTextBox").val() + "', \"area\":'', \"city\":'" + $("#CurrentCityTextBox").val() + "', \"address\":'" + $("#AddressTextBox").val() + "', \"house\":'" + $("#HouseTextBox").val() + "', \"flat\":'" + $("#FlatTextBox").val() + "', \"name\":'" + $("#NameTextBox").val() + "', \"secondname\":'" + $("#SecondNameTextBox").val() + "', \"patronymic\":'" + $("#PatronymicTextBox").val() + "', \"city_ref\":'" + $("#CurrentCityTextBox").attr("city_id") + "', \"warehouse_ref\":'" + $("#CurrentWarehouseTextBox").attr("warehouse_id") + "', \"address_ref\":'" + $("#AddressTextBox").attr("address_id") + "', \"comments\":'" + $.cookie("c_comments") + "', \"ctime\":'" + (getUrlParameter("c_time") != undefined ? getUrlParameter("c_time") : '') + "', \"refer\":'" + (getUrlParameter("refer") != undefined ? getUrlParameter("refer") : '') + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindCreateNewOrder3
        });

    });

    function bindCreateNewOrder2(data) {

        if (data.d[2] != "") {

            var date = new Date();
            var minutes = 60;
            var hours = 24;
            var days = 365;
            date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

            $.cookie("c_cart", "", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            $.cookie("c_comments", "", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            $.cookie("c_time", "", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });

            $("div.menu span.mcartcount").html("0");

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/PayCard",
                data: "{ \"uid\":" + uid_v + ", \"cheque\":" + data.d[2] + " }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindPayCard
            });
        }
        else {
            $("#splash").hide();
            loadingHide();

            alert("Помилка");
        }
    }

    function bindCreateNewOrder3(data) {

        if (data.d[2] != "") {

            var date = new Date();
            var minutes = 60;
            var hours = 24;
            var days = 365;
            date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

            $.cookie("c_cart", "", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            $.cookie("c_comments", "", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            $.cookie("c_time", "", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });

            $("div.menu span.mcartcount").html("0");

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/PayCard",
                data: "{ \"uid\":" + uid_v + ", \"cheque\":" + data.d[2] + " }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindPayCard2
            });
        }
        else {
            $("#splash").hide();
            loadingHide();

            alert("Замовлення втратило актуальність");
        }
    }

    $("#PayOrder").delegate("#GoToCabinet2", "click", function () {

        loadingShow();

        $("#splash").show();
        $(window).scrollTop(0);

        var client_id = $("#MainBalance").attr("client_id");

        if (client_id == undefined || client_id == '')
            client_id = 0;

        if (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") != -1) {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/CreateNewOrder",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"client_id\":" + client_id + ", \"phone\":'" + ConvertPhone($("#PhoneTextBox").val()) + "', \"cartdata\":'" + $.cookie("c_cart") + "', \"delivery_type\":'" + $("#DeliveryTypeSelect").val() + "', \"warehouse\":'', \"area\":'', \"city\":'Тернівка', \"address\":'Клякса', \"house\":'', \"flat\":'', \"name\":'" + $("#NameTextBox").val() + "', \"secondname\":'', \"patronymic\":'', \"city_ref\":'', \"warehouse_ref\":'', \"address_ref\":'', \"comments\":'" + $.cookie("c_comments") + "', \"ctime\":'" + (getUrlParameter("c_time") != undefined ? getUrlParameter("c_time") : '') + "', \"refer\":'" + (getUrlParameter("refer") != undefined ? getUrlParameter("refer") : '') + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindCreateNewOrder
            });
        }
        else {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/CreateNewOrder",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"client_id\":" + client_id + ", \"phone\":'" + ConvertPhone($("#PhoneTextBox").val()) + "', \"cartdata\":'" + $.cookie("c_cart") + "', \"delivery_type\":'" + $("#DeliveryTypeSelect").val() + "', \"warehouse\":'" + $("#CurrentWarehouseTextBox").val() + "', \"area\":'', \"city\":'" + $("#CurrentCityTextBox").val() + "', \"address\":'" + $("#AddressTextBox").val() + "', \"house\":'" + $("#HouseTextBox").val() + "', \"flat\":'" + $("#FlatTextBox").val() + "', \"name\":'" + $("#NameTextBox").val() + "', \"secondname\":'" + $("#SecondNameTextBox").val() + "', \"patronymic\":'" + $("#PatronymicTextBox").val() + "', \"city_ref\":'" + $("#CurrentCityTextBox").attr("city_id") + "', \"warehouse_ref\":'" + $("#CurrentWarehouseTextBox").attr("warehouse_id") + "', \"address_ref\":'" + $("#AddressTextBox").attr("address_id") + "', \"comments\":'" + $.cookie("c_comments") + "', \"ctime\":'" + (getUrlParameter("c_time") != undefined ? getUrlParameter("c_time") : '') + "', \"refer\":'" + (getUrlParameter("refer") != undefined ? getUrlParameter("refer") : '') + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindCreateNewOrder
            });
        }
    });

    function bindGetLastOrderInfo(data) {
       
        if (data.d.City != null) {
            $('#CurrentCityTextBox').val(data.d.City);
            $('#CurrentCityTextBox').attr(data.d.CityRef);
        }

        if (data.d.Address != null && data.d.Address != '') {
            $("#DeliveryTypeSelect").val("2");
            $("#CabinetTable").find('[v="1"]').hide();
            $("#CabinetTable").find('[v="2"]').show();
            
            $('#AddressTextBox').val(data.d.Address);
            $('#AddressTextBox').attr(data.d.AddressRef);
        }
        else
        {
            $('#CurrentWarehouseTextBox').val(data.d.Warehouse);
            $('#CurrentWarehouseTextBox').attr(data.d.WarehouseRef);
        }

        $('#SecondNameTextBox').val(data.d.SecondName);
        $('#PatronymicTextBox').val(data.d.Patronymic);
        $('#NameTextBox').val(data.d.Name);
    }

    function FindSettlements(request)
    {
        $.ajax({
            async: true,
            type: "POST",
            crossDomain: true,
            url: "https://api.novaposhta.ua/v2.0/json/Address/searchSettlements/",
            data: '{\r\n\"apiKey": "046c315053c52ce46f14cd32d7be106e",\r\n\ "modelName": "Address",\r\n\ "calledMethod": "searchSettlements",\r\n\ "methodProperties": {\r\n\ "CityName":"' + request + '",\r\n\ "Limit":5\r\n\}\r\n}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetFindSettlements
        });
    };

    function bindGetFindSettlements(data) {
        //alert(data.data[0].Addresses[0].Present);

        if (data.data[0].Addresses.length > 0) {
            $("#DetailsTable").children().remove();

            for (var i = 0; i < data.data[0].Addresses.length; i++) {
                $("#DetailsTable").append('<tr><td class="order" width="100%" colspan="2" city_id="' + data.data[0].Addresses[i].Ref + '">' + data.data[0].Addresses[i].MainDescription + '</td></tr>');
            }

            var left_drop = 0;
            var top_drop = 0;

            if (typeof InstallTrigger !== 'undefined') {
                top_drop = 0;
            }
            else {
                left_drop = 0;
            }

            $("#DetailsDIV").css({ top: $("#CurrentCityTextBox").offset().top + top_drop + $("#CurrentCityTextBox").outerHeight() + 'px' });

            $("#DetailsDIV").css({ left: $("#CurrentCityTextBox").offset().left + $("#CurrentCityTextBox").outerWidth() - $("#DetailsDIV").outerWidth() + left_drop + 'px' });

            $("#CurrentWarehouseTextBox").val('');

            if (data.data.length < 4) {
                $("#DetailsDIV").css("height", $("#DetailsTable").innerHeight() + "px");
            }
            else
                $("#DetailsDIV").css("height", "200px");

            $("#DetailsDIV").show();
            $("#splash").hide();
            $("#splash2").hide();
        }
    }

    $("#CabinetTable").delegate('#CurrentCityTextBox', 'keyup input', function () {
        if ($(this).val().length > 1) {
            FindSettlements($(this).val());
        }
    });

    $("#CabinetTable").delegate('#AddressTextBox', 'keyup input', function () {
        if ($(this).val().length > 1) {
            FindAddress();
        }
    });

    function FindAddress() {
        $.ajax({
            async: true,
            type: "POST",
            crossDomain: true,
            url: "https://api.novaposhta.ua/v2.0/json/",
            data: '{\r\n\"apiKey": "046c315053c52ce46f14cd32d7be106e",\r\n\ "modelName": "Address",\r\n\ "calledMethod": "searchSettlementStreets",\r\n\ "methodProperties": {\r\n\"StreetName": "' + $("#AddressTextBox").val() + '",\r\n\ "SettlementRef": "' + $("#CurrentCityTextBox").attr("city_id") + '",\r\n\ "Limit": 5\r\n\}\r\n\}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetAddress
        });
    };

    JSON.stringify = JSON.stringify || function (obj) {
        var t = typeof (obj);
        if (t != "object" || obj === null) {
            // simple data type
            if (t == "string") obj = '"' + obj + '"';
            return String(obj);
        }
        else {
            // recurse array or object
            var n, v, json = [], arr = (obj && obj.constructor == Array);
            for (n in obj) {
                v = obj[n]; t = typeof (v);
                if (t == "string") v = '"' + v + '"';
                else if (t == "object" && v !== null) v = JSON.stringify(v);
                json.push((arr ? "" : '"' + n + '":') + String(v));
            }
            return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
        }
    };

    function bindGetAddress(data) {
        if (data.data[0].Addresses.length > 0) {
            $("#DetailsTable").children().remove();

            for (var i = 0; i < data.data[0].Addresses.length; i++) {
                $("#DetailsTable").append('<tr><td class="order3" width="100%" colspan="2" address_id="' + data.data[0].Addresses[i].SettlementStreetRef + '">' + data.data[0].Addresses[i].Present + '</td></tr>');
            }

            var left_drop = 0;
            var top_drop = 0;

            if (typeof InstallTrigger !== 'undefined') {
                top_drop = 0;
            }
            else {
                left_drop = 0;
            }

            $("#DetailsDIV").css({ top: $("#AddressTextBox").offset().top + top_drop + $("#AddressTextBox").outerHeight() + 'px' });

            $("#DetailsDIV").css({ left: $("#AddressTextBox").offset().left + $("#AddressTextBox").outerWidth() - $("#DetailsDIV").outerWidth() + left_drop + 'px' });

            $("#CurrentWarehouseTextBox").val('');

            if (data.data.length < 4) {
                $("#DetailsDIV").css("height", $("#DetailsTable").innerHeight() + "px");
            }
            else
                $("#DetailsDIV").css("height", "200px");

            $("#DetailsDIV").show();
            $("#splash").hide();
            $("#splash2").hide();
        }
    }

    $("#DetailsTable").delegate('td.order3', 'click', function () {
        $("#AddressTextBox").val($(this).html());
        $("#AddressTextBox").attr("address_id", $(this).attr("address_id"));
        $("#CurrentWarehouseTextBox").val("");
        $("#CurrentWarehouseTextBox").removeAttr("warehouse_id");
        $("#DetailsDIV").hide();
        $("#DetailsTable").children().remove();
    });

    $("#CabinetTable").delegate('#DeliveryTypeSelect', 'change', function () {
        if ($(this).val() == "1") {
            $("#CurrentCityTextBox").val('');
            $("#CurrentCityTextBox").removeAttr("city_id");
            $("#CabinetTable").find('[v="2"]').hide();
            $("#CabinetTable").find('[v="1"]').show();
            
        }
        else if ($(this).val() == "2") {
            $("#CurrentCityTextBox").val('');
            $("#CurrentCityTextBox").removeAttr("city_id");
            $("#CabinetTable").find('[v="1"]').hide();
            $("#CabinetTable").find('[v="2"]').show();
        }
    });

    var city_id;

    $("#DetailsTable").delegate('td.order', 'click', function () {
        $("#CurrentCityTextBox").val($(this).html());
        $("#CurrentCityTextBox").attr("city_id", $(this).attr("city_id"));
        $("#CurrentWarehouseTextBox").val("");
        $("#CurrentWarehouseTextBox").removeAttr("warehouse_id");
        $("#AddressTextBox").val("");
        $("#AddressTextBox").removeAttr("address_id");
        $("#FlatTextBox").val("");
        $("#HouseTextBox").val("");
        $("#DetailsDIV").hide();
        $("#DetailsTable").children().remove();

        city_id = $(this).attr("city_id");

        if ($("DeliveryTypeSelect").val() == "1")
            GetWarehouses(city_id);
    });

    $("#DetailsTable").delegate('td.order2', 'click', function () {
        $("#CurrentWarehouseTextBox").val($(this).html());
        $("#CurrentWarehouseTextBox").attr("warehouse_id", $(this).attr("warehouse_id"));
        $("#AddressTextBox").val("");
        $("#AddressTextBox").removeAttr("address_id");
        $("#FlatTextBox").val("");
        $("#HouseTextBox").val("");
        $("#DetailsDIV").hide();
        $("#DetailsTable").children().remove();
    });

    $("#CabinetTable").delegate('#CurrentWarehouseTextBox', 'click', function () {

        if (city_id != undefined) {
            $("#DetailsDIV").hide();
            $("#DetailsTable").children().remove();

            GetWarehouses(city_id);
        }
    });

    function GetWarehouses(request) {
        $.ajax({
            async: true,
            type: "POST",
            crossDomain: true,
            url: "https://api.novaposhta.ua/v2.0/json/AddressGeneral/getWarehouses",
            data: '{\r\n\"apiKey": "046c315053c52ce46f14cd32d7be106e",\r\n\ "modelName": "AddressGeneral",\r\n\ "calledMethod": "getWarehouses",\r\n\ "methodProperties": {\r\n\ "SettlementRef": "' + city_id + '"\r\n\}\r\n\}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetWarehouses
        });
    }

    function bindGetWarehouses(data) {
        //alert(data.data[0].Addresses[0].Present);
        if (data.data.length > 0) {
            $("#DetailsTable").children().remove();


            for (var i = 0; i < data.data.length; i++) {
                $("#DetailsTable").append('<tr><td class="order2" width="100%" colspan="2" warehouse_id="' + data.data[i].Number + '">' + data.data[i].Description + '</td></tr>');
            }

            var left_drop = 0;
            var top_drop = 0;

            if (typeof InstallTrigger !== 'undefined') {
                top_drop = 0;
            }
            else {
                left_drop = 0;
            }

            $("#DetailsDIV").css({ top: $("#CurrentWarehouseTextBox").offset().top + top_drop + $("#CurrentWarehouseTextBox").outerHeight() + 'px' });

            $("#DetailsDIV").css({ left: $("#CurrentWarehouseTextBox").offset().left + $("#CurrentWarehouseTextBox").outerWidth() - $("#DetailsDIV").outerWidth() + left_drop + 'px' });
            if (data.data.length < 4) {
                $("#DetailsDIV").css("height", $("#DetailsTable").innerHeight() + "px");
            }
            else
                $("#DetailsDIV").css("height", "200px");

            $("#DetailsDIV").show();
            $("#splash").hide();
            $("#splash2").hide();
        }
    }


    //$("#OrderClose").click(function () {
    //    $("#neworder").hide();
    //    $("#splash").hide();
    //});

    //$("#orderaccepted span.close").click(function () {
    //    $("#orderaccepted").hide();
    //    $("#splash").hide();
    //});

    

    $("#PhoneTextBox").inputmask("+38 999 999 9999");

    var custom_perc = false;

    function bindGrid(data) {

        $('#CabinetTable').children().remove();

        var dataRows = data.d[2];
        var addicted_dataRows = data.d[3];

        if (dataRows.length == 0) {
            loading2Hide();
            $("#ProductsListView").show();
            loadingHide();

            $("#ProductsListView").find('[status="new"]').each(function () {
                $(this).removeAttr("status");
                $(this).show();
            });

            if ($("#createaccount").css("display") == "none")
                $("#splash").hide();

            if (startRecord == 0) {

                $('#col2').hide();
                $('#col3').hide();

                $('#col1').hide();
                $("#EmptyDiv").show();

                loading2Hide();
                $("#ProductsListView").show();
                loadingHide();
            }
        }

        if (startRecord == 0) {
            $("#CreateOrder").hide();
            $("#PayOrder").hide();
            $("#col1").children().remove();
            $("#col2").children().remove();
            $("#col3").children().remove();
            $("#CabinetTable").children().remove();
        }

        if (startRecord == 0 && dataRows.length == 0) {

            $('#col2').hide();
            $('#col3').hide();
            $('#col1').hide();
            $("#EmptyDiv").show();
            loading2Hide();
            $("#ProductsListView").show();
            loadingHide();
        }
        else {
            $('#col1').show();
            $('#col2').show();
            $('#col3').show();
            $("#EmptyDiv").hide();
        }

        var index2 = startRecord;

        startRecord = startRecord + dataRows.length;

        var perc = 0;

        custom_perc = false;

        if ($("#MBM1").attr("paramConditions") != undefined && $("#MBM1").attr("paramConditions") != null && $("#MBM1").attr("paramConditions") != '') {

            if ($("#MBM1").attr("paramConditions") == null || $("#MBM1").attr("paramConditions") == '') {
                custom_perc = false;
            }
            else {
                custom_perc = true;
            }
        }

        var free_delivery = 0;

        if ($("#MBM1").attr("v13") == "1") {
            free_delivery = 1;
        }

        var disable_trade = 0;

        if ($("#MBM1").attr("v5") == "1")
            disable_trade = 1;

        var set_count = 0;

        if (data_status == 7) {
            set_count = 1;
        }

        var col = 0;

        var index = 1;

        var loadCounter = 0;

        var psum = 0;

  
        var senders = [];
       

        for (var i = 0; i < dataRows.length; i++) {
            var col;

            if (addicted_dataRows[i][7] != undefined && addicted_dataRows[i][7] != "") {
                dataRows[i].Count = parseFloat(addicted_dataRows[i][7]);
            }

            var max_count = (data_status == 7) ? "maxcount='" + dataRows[i].Count + "'" : '';

            if (custom_perc) {

                var conditions = $("#MBM1").attr("paramConditions").split("+");

                for (var k = 0; k < conditions.length; k++) {
                    var c_components = conditions[k].split(":");

                    var shop_id = parseInt(c_components[0]);
                    if (shop_id == dataRows[i].ShopID || shop_id == 0) {
                        var category_id = parseInt(c_components[1]);

                        if (category_id == dataRows[i].CategoryID || category_id == 0) {
                            var value = parseFloat(c_components[2]);
                            var term = c_components[3];
                            var tvalue = parseFloat(c_components[4]);

                            if (term == "<" && dataRows[i].Price < value) {
                                perc = tvalue / 100;
                            }
                            else if (term == ">" && dataRows[i].Price > value) {
                                perc = tvalue / 100;
                            }
                        }
                    }
                }
            }

            var escount = EnableSetCount(set_count, dataRows[i].ID);
            var comment = EnableSetComment(set_count, dataRows[i].ID, dataRows[i].ShopID);

            if (jQuery.inArray(dataRows[i].ShopID, senders) == -1) {
                senders.push(dataRows[i].ShopID);
            }

            if ($.cookie("c_view") == "list" || $("#c_view").val() == "list") {
                col = $('#col1');
                $('#col2').hide();
                $('#col3').hide();

                var timesel = TimeSelectView(addicted_dataRows[i][6], dataRows[i].ShopID);

                var no_photo_url;

                if (addicted_dataRows[i][3] != null && addicted_dataRows[i][3] != undefined && addicted_dataRows[i][3] != '' && addicted_dataRows[i][3].split("||")[0].indexOf('/img/nophoto2.png') == -1)
                    no_photo_url = '';
                else
                    no_photo_url = '<span class="findPhoto">' + ($("#MBM1").attr("v16") == "1" ? 'Подивитись фото товару в Google' : 'Поcмотреть фото товара в Google') + '</span>';

                var img_val = '<img index="' + index2.toString() + '" res="' + addicted_dataRows[i][3] + '" src="' + GetNormalImage(addicted_dataRows[i][3], addicted_dataRows[i][3]) + '" onerror="onErrorPhotoLoad(this)"></img>';
                

                var rate_info = '<span class="AddRateSpan2">' + ($("#MBM1").attr("v16") == "1" ? "Залишити відгук" : "Оставить отзыв") + '</span>';

                if (addicted_dataRows[i][10] > 0) {

                    if (addicted_dataRows[i][10] == 1)
                        rate_info = "<span class='AddRateSpan'>" + addicted_dataRows[i][10] + ($("#MBM1").attr("v16") == "1" ? " відгук" : " отзыв") + "</span>";
                    else if (addicted_dataRows[i][10] % 2 == 0 || addicted_dataRows[i][10] % 3 == 0 || addicted_dataRows[i][10] % 4 == 0) {
                        rate_info = "<span class='AddRateSpan'>" + addicted_dataRows[i][10] + ($("#MBM1").attr("v16") == "1" ? " відгуки" : " отзыва") + "</span>";
                    }
                    else
                        rate_info = "<span class='AddRateSpan'>" + addicted_dataRows[i][10] + ($("#MBM1").attr("v16") == "1" ? " відгуків" : "отзывов") + "</span>";

                    if (addicted_dataRows[i][9] > 0)
                        rate_info = "<span class='" + dataRows[i].ID + "' v='" + addicted_dataRows[i][9] / 3 + "'></span> " + rate_info;
                }


                rate_info = "<div class='RateDiv' style='padding: 5px; text-align: left' v='" + dataRows[i].ID + "'>" + rate_info + "</div>";

                var sklep_info = "<div class='sklep'>" + sklep[dataRows[i].ShopID] + "</div>";
                var deliver_ru = "отправка: ";
                var deliver_uk = "відправка: ";

                var delivery_status = "<div class='dready'>" + ($("#MBM1").attr("v16") == "1" ? "готовий до відправки" : "готов к отправке") + "</div>";

                if (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") != -1) {
                    deliver_ru = "доставка: ";
                    deliver_uk = "доставка: ";

                    delivery_status = "<div class='dready'>" + ($("#MBM1").attr("v16") == "1" ? "товар у магазині" : "товар в магазине") + "</div>";
                    sklep_info = "";
                }

                var day_w = new Date().getDay();

                var cur_time = (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") != -1) ? delivery_time2[dataRows[i].ShopID][day_w] : delivery_time[dataRows[i].ShopID][day_w];

                if ((disable_trade == "1" || (dataRows[i].ShopID == 3692 && dataRows[i].Price > 1200)) && dataRows[i].Count == 1 && dataRows[i].Status == 0) {

                }
                else if (cur_time.indexOf("-") != -1) {
                    var day_hour = new Date().getHours();

                    var time_def = cur_time.split("-");

                    if (parseInt(time_def[1]) < day_hour) {
                        var delivery_status = "<div class='dready'>" + ($("#MBM1").attr("v16") == "1" ? "відправка завтра" : "отправка завтра") + "</div>";
                    }
                }
                else {
                    if (cur_time.indexOf("<") != -1) {
                        var d = new Date();

                        d.setDate(d.getDate() + parseInt(cur_time.replace("<", "")));

                        day = d.getDate();

                        if (day < 10) {
                            day = "0" + day;
                        }

                        month = (d.getMonth() + 1);

                        if (month < 10) {
                            if (month == 0)
                                month = "01";
                            else
                                month = "0" + month;
                        }

                        var curDate = " до " + day + "." + month;
                        delivery_status = "<div class='dready'>" + ($("#MBM1").attr("v16") == "1" ? deliver_uk : deliver_ru) + curDate + "</div>";
                    }
                    else if (cur_time != "") {
                        var d = new Date();

                        d.setDate(d.getDate() + parseInt(cur_time));

                        day = d.getDate();

                        if (day < 10) {
                            day = "0" + day;
                        }

                        month = (d.getMonth() + 1);

                        if (month < 10) {
                            if (month == 0)
                                month = "01";
                            else
                                month = "0" + month;
                        }

                        var curDate = day + "." + month;
                        delivery_status = "<div class='dready'>" + ($("#MBM1").attr("v16") == "1" ? deliver_uk : deliver_ru) + curDate + "</div>";
                    }
                }

                col.append('<div class="product" ' + max_count + ' style="display: none; width: 100%; border: 2px solid #FFF;" status="new" shopid="' + dataRows[i].ShopID + '" dataid="' + dataRows[i].ID + '" price="' + dataRows[i].Price + '" stp="' + dataRows[i].StartPrice + '" status2="' + dataRows[i].Status + '"  price2_inet="' + dataRows[i].Price2 + '" ct="' + dataRows[i].Count + '" rating="' + addicted_dataRows[i][0] + '" discount="' + addicted_dataRows[i][1] + '" delivery="' + addicted_dataRows[i][4] + '" time="' + addicted_dataRows[i][6] + '" catid="' + dataRows[i].CategoryID + '"><table class="pt" style="background-color: white; width: 100%"><tr><td class="pt_img" style="width: 309px; vertical-align:top">' + GetDiscount(addicted_dataRows[i][1], dataRows[i].Price) + '<div class="img" style="padding-top: 3px;">' + FreeDelivery(free_delivery, addicted_dataRows[i][4]) + GetRate(addicted_dataRows[i][0]) + no_photo_url + img_val + delivery_status + sklep_info + '</div>' + rate_info + '</td><td class="last_td" style="width: 100%; position: relative;"><a class="name" style="font: 16px/20px arial; text-align: left; display: inline-block; top: 2px; position: absolute; height: 100px;">' + dataRows[i].Name + '<br/><span idv="' + dataRows[i].ID + '" class="ReadAll">Читати повністю</span></a><div class="options" style="height: 40px; margin-top: 65px;"><ul>' + GetPriceView(addicted_dataRows[i][1], dataRows[i].Price, dataRows[i].Count) + GetMoneybox(perc, dataRows[i].Price) + '</ul></div><div class="options"><ul>' + GetRateView(dataRows[i].ID, addicted_dataRows[i][0], dataRows[i].Price) + '</ul></div>' + timesel + escount[0] + comment + GetCartView(disable_trade, dataRows[i].ID, addicted_dataRows[i][0], dataRows[i].Price, dataRows[i].ShopID, dataRows[i].Count, addicted_dataRows[i][9], dataRows[i].Status) + '</td></tr>');

                if (timesel != '') {
                    SetTimeViewPrice($("#ProductsListView").find('[dataid="' + dataRows[i].ID + '"]').find(".timeselect"), dataRows[i].ID, 0, dataRows[i].Count);
                }

                $('.' + dataRows[i].ID).starRating({

                    initialRating: $('.' + dataRows[i].ID).attr("v"),
                    strokeColor: '#894A00',
                    strokeWidth: 10,
                    starSize: 15,
                    readOnly: true,
                });
            }
            else {
                if (window.innerWidth <= 416) {
                    col = $('#col1');
                    $('#col2').hide();
                    $('#col3').hide();
                }
                else {

                    //if (i == dataRows.length - 1) {
                    //    var min_h = $('#col1').innerHeight();

                    //    if (min_h > $('#col2').innerHeight()) {
                    //        min_h = $('#col2').innerHeight();
                    //        col = $('#col2');
                    //    }

                    //    if (min_h > $('#col3').innerHeight()) {
                    //        col = $('#col3');
                    //    }

                    //    if ($('#col3').innerHeight() == $('#col2').innerHeight() && $('#col1').innerHeight() == $('#col3').innerHeight()) {
                    //        if (index == 1)
                    //            col = $('#col1');
                    //        else if (index == 2)
                    //            col = $('#col2');
                    //        else if (index == 3)
                    //            col = $('#col3');
                    //    }
                    //}
                    //else {
                        if (index == 1)
                            col = $('#col1');
                        else if (index == 2)
                            col = $('#col2');
                        else if (index == 3)
                            col = $('#col3');
                    //}
                }

                var timesel = TimeSelectView(addicted_dataRows[i][6], dataRows[i].ShopID);

                var no_photo_url;

                if (addicted_dataRows[i][3] != null && addicted_dataRows[i][3] != undefined && addicted_dataRows[i][3] != '' && addicted_dataRows[i][3].split("||")[0].indexOf('/img/nophoto2.png') == -1)
                    no_photo_url = '';
                else
                    no_photo_url = '<span class="findPhoto">' + ($("#MBM1").attr("v16") == "1" ? 'Подивитись фото товару в Google' : 'Поcмотреть фото товара в Google') + '</span>';


                var img_val = '<img index="' + index2.toString() + '" res="' + addicted_dataRows[i][3] + '" src="' + GetNormalImage(addicted_dataRows[i][3], addicted_dataRows[i][3]) + '" onerror="onErrorPhotoLoad(this)"></img>';
                

                var rate_info = '<span class="AddRateSpan2">' + ($("#MBM1").attr("v16") == "1" ? "Залишити відгук" : "Оставить отзыв") + '</span>';

                if (addicted_dataRows[i][10] > 0) {

                    if (addicted_dataRows[i][10] == 1)
                        rate_info = "<span class='AddRateSpan'>" + addicted_dataRows[i][10] + ($("#MBM1").attr("v16") == "1" ? " відгук" : " отзыв") + "</span>";
                    else if (addicted_dataRows[i][10] % 2 == 0 || addicted_dataRows[i][10] % 3 == 0 || addicted_dataRows[i][10] % 4 == 0) {
                        rate_info = "<span class='AddRateSpan'>" + addicted_dataRows[i][10] + ($("#MBM1").attr("v16") == "1" ? " відгуки" : " отзыва") + "</span>";
                    }
                    else
                        rate_info = "<span class='AddRateSpan'>" + addicted_dataRows[i][10] + ($("#MBM1").attr("v16") == "1" ? " відгуків" : "отзывов") + "</span>";

                    if (addicted_dataRows[i][9] > 0)
                        rate_info = "<span class='" + dataRows[i].ID + "' v='" + addicted_dataRows[i][9] / 3 + "'></span> " + rate_info;
                }


                rate_info = "<div class='RateDiv' style='padding: 5px; text-align: left' v='" + dataRows[i].ID + "'>" + rate_info + "</div>";
           
                var sklep_info = "<div class='sklep'>" + sklep[dataRows[i].ShopID] + "</div>";
                var deliver_ru = "отправка: ";
                var deliver_uk = "відправка: ";

                var delivery_status = "<div class='dready'>" + ($("#MBM1").attr("v16") == "1" ? "готовий до відправки" : "готов к отправке") + "</div>";

                if (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") != -1) {
                    deliver_ru = "доставка: ";
                    deliver_uk = "доставка: ";

                    delivery_status = "<div class='dready'>" + ($("#MBM1").attr("v16") == "1" ? "товар у магазині" : "товар в магазине") + "</div>";
                    sklep_info = "";
                }

                var day_w = new Date().getDay();

                var cur_time = (extractHostname(window.location.origin).indexOf("xn--80atad5a1f.in.ua") != -1) ? delivery_time2[dataRows[i].ShopID][day_w] : delivery_time[dataRows[i].ShopID][day_w];

                if ((disable_trade == "1" || (dataRows[i].ShopID == 3692 && dataRows[i].Price > 1200)) && dataRows[i].Count == 1 && dataRows[i].Status == 0) {

                }
                else if (cur_time.indexOf("-") != -1) {
                    var day_hour = new Date().getHours();

                    var time_def = cur_time.split("-");

                    if (parseInt(time_def[1]) < day_hour) {
                        var delivery_status = "<div class='dready'>" + ($("#MBM1").attr("v16") == "1" ? "відправка завтра" : "отправка завтра") + "</div>";
                    }
                }
                else {
                    if (cur_time.indexOf("<") != -1) {
                        var d = new Date();
                        d.setDate(d.getDate() + parseInt(cur_time.replace("<", "")));

                        day = d.getDate();

                        if (day < 10) {
                            day = "0" + day;
                        }

                        month = (d.getMonth() + 1);

                        if (month < 10) {
                            if (month == 0)
                                month = "01";
                            else
                                month = "0" + month;
                        }

                        var curDate = " до " + day + "." + month;
                        delivery_status = "<div class='dready'>" + ($("#MBM1").attr("v16") == "1" ? deliver_uk : deliver_ru) + curDate + "</div>";
                    }
                    else if (cur_time != "") {
                        var d = new Date();

                        d.setDate(d.getDate() + parseInt(cur_time));

                        day = d.getDate();

                        if (day < 10) {
                            day = "0" + day;
                        }

                        month = (d.getMonth() + 1);

                        if (month < 10) {
                            if (month == 0)
                                month = "01";
                            else
                                month = "0" + month;
                        }

                        var curDate = day + "." + month;
                        delivery_status = "<div class='dready'>" + ($("#MBM1").attr("v16") == "1" ? deliver_uk : deliver_ru) + curDate + "</div>";
                    }
                }

                col.append('<div class="product" ' + max_count + ' style="display: none; border: 2px solid #FFF" status="new" shopid="' + dataRows[i].ShopID + '" dataid="' + dataRows[i].ID + '" price="' + dataRows[i].Price + '" stp="' + dataRows[i].StartPrice + '" status2="' + dataRows[i].Status + '" price2_inet="' + dataRows[i].Price2 + '" ct="' + dataRows[i].Count + '" rating="' + addicted_dataRows[i][0] + '" discount="' + addicted_dataRows[i][1] + '" delivery="' + addicted_dataRows[i][4] + '" time="' + addicted_dataRows[i][6] + '" catid="' + dataRows[i].CategoryID + '">' + GetDiscount(addicted_dataRows[i][1], dataRows[i].Price) + GetRate(addicted_dataRows[i][0]) + '<div class="img">' + FreeDelivery(free_delivery, addicted_dataRows[i][4]) + no_photo_url + img_val + delivery_status + sklep_info + '</div>' + rate_info + '<a class="name">' + dataRows[i].Name + '</a><div idv="' + dataRows[i].ID + '" class="ReadAll" style="text-align: center">Читати повністю</div><div class="options"><ul>' + GetPriceView(addicted_dataRows[i][1], dataRows[i].Price, dataRows[i].Count) + GetMoneybox(perc, dataRows[i].Price) + GetRateView(dataRows[i].ID, addicted_dataRows[i][0], dataRows[i].Price) + '</ul></div>' + timesel + escount[0] + comment + GetCartView(disable_trade, dataRows[i].ID, addicted_dataRows[i][0], dataRows[i].Price, dataRows[i].ShopID, dataRows[i].Count, addicted_dataRows[i][9], dataRows[i].Status) + '</div > ');

                if (timesel != '') {
                    SetTimeViewPrice($("#ProductsListView").find('[dataid="' + dataRows[i].ID + '"]').find(".timeselect"), dataRows[i].ID, 0, dataRows[i].Count);
                }

                $('.' + dataRows[i].ID).starRating({
                    initialRating: $('.' + dataRows[i].ID).attr("v"),
                    strokeColor: '#894A00',
                    strokeWidth: 10,
                    starSize: 15,
                    readOnly: true,
                });
            }

            var p_price;

            if ($("#ProductsListView").find('[dataid="' + dataRows[i].ID + '"]').find(".price").html() == undefined) {
                p_price = parseFloat($("#ProductsListView").find('[dataid="' + dataRows[i].ID + '"]').find(".oldprice").html());
            }
            else
                p_price = parseFloat($("#ProductsListView").find('[dataid="' + dataRows[i].ID + '"]').find(".price").html());

            psum = psum + escount[1] * p_price;

            if ($.cookie("c_view") == "table" || $("#c_view").val() == "table") {
                $(".TableView").attr("class", "TableView2");
            }
            else {
                $(".ListView").attr("class", "ListView2");
            }

            index++;
            index2++;

            if (index == 4)
                index = 1;
        }

        if (data_status == 7) {

            $("#TitleInfo").append('<span class="cartsum">' + psum.toString() + '<span>грн</span></span>');
            $("#CabinetInfo").hide();
            $("#TitleInfo").show();
        }

        SetView();

        menu_offset = $("#MenuDIV").offset().top - $(".xpool").innerHeight();

        loading2Hide();
        $("#ProductsListView").show();
        loadingHide();

        $("#ProductsListView").find('[status="new"]').each(function () {
            $(this).removeAttr("status");
            $(this).show();
        });

        if ($("#createaccount").css("display") == "none" && $('#about').css('display') == 'none')
            $("#splash").hide();

        if (data_status == 7) {
            $("#CreateOrder").show();
            $("#PayOrder").hide();
        }
        else {
            $("#CreateOrder").hide();
            $("#PayOrder").hide();
        }

        if (currentEvent == "best") {
            $("#MenuDIV").animate({ scrollLeft: $('.best').position().left - window.innerWidth / 2 + 25 }, 500);
        }
        else if (currentEvent == "discount") {     
            $("#MenuDIV").animate({ scrollLeft: $('.discount').position().left - window.innerWidth / 2 + 25 }, 500);
        }
        else if (currentEvent == "search") {      
            $("#MenuDIV").animate({ scrollLeft: $('.search').position().left - window.innerWidth / 2 + 25 }, 500);
        }
        else if (currentEvent == "new") {      
            $("#MenuDIV").animate({ scrollLeft: $('li span.new').position().left - window.innerWidth / 2 + 25 }, 500);
        }
        else if (currentEvent == "cart") {
            if (senders.length > 1) {
                $("#PayOrder").children().remove();
                var drop = "відправлення";

                if (senders.length > 4)
                    drop = "відправлень";
             
                $("#PayOrder").append("<tr><td style='background-color: #FFF; text-align: center; font: 12px/30px Arial;'>За вашим замовленням буде створено " + senders.length + " " + drop + "</td></tr>");
                $("#PayOrder").show();
            }
            $("#MenuDIV").animate({ scrollLeft: $('.mcart').position().left - window.innerWidth / 2 + 25 }, 500);
            var n = $(document).height();
            $('html, body').animate({ scrollTop: n }, 0);
            $('html, body').animate({ scrollTop: 0 }, 300);
        }
        else if (currentEvent == "favs") {
            $("#MenuDIV").animate({ scrollLeft: $('.favorites').position().left - window.innerWidth / 2 + 25 }, 500);
            var n = $(document).height();
            $('html, body').animate({ scrollTop: n }, 0);
            $('html, body').animate({ scrollTop: 0 }, 300);
        }
    }

    function onErrorPhotoLoad(source) {
        $(source).attr('src', 'https://xpool.pro/web/source/' + $('#TargetStyleSheet').attr('st') + '/img/nophoto.png');
        $('<span class="findPhoto">' + ($("#MBM1").attr("v16") == "1" ? 'Подивитись фото товару в Google' : 'Поcмотреть фото товара в Google') + '</span>').insertBefore($(source));
    }

    function bindCreateNewOrder(data) {
        $("#PayOrder").children().remove();
        $("#PayOrder").hide();

        var client_id = $("#MainBalance").attr("client_id");

        var date = new Date();
        var minutes = 60;
        var hours = 24;
        var days = 365;
        date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

        if (client_id == undefined || client_id == '') {
            if (data.d[1] != null) {

                if (data.d[1].paramPhone == null) {
                    $("#splash").show();
                    $("#createaccount").center();
                    $("#createaccount").show();
                    $("#CreatePhoneNumberLogin").inputmask("+38 999 999 9999");
                }

                if ($("#UserKey").attr("class") == "keyerror")
                    $("#UserKey").attr("class", "key");

                var balance = data.d[1].Credit - data.d[1].Debit;

                var main_balance = balance - (balance % 1);
                var coins = Math.round((balance % 1) * 100);

                $("#MBM1").html("<span id=\"MainBalance\" client_id=\"" + data.d[1].ID + "\" class=\"mainbalance\" balance=\"" + balance.toFixed(2) + "\">" + main_balance + "</span><span class=\"coins\">" + coins + "</span></span>");
                $("#MBM1").attr("paramConditions", data.d[1].paramConditions);
                $("#MValue1").html(main_balance);
                $("#MValue12").html(coins);
                $("#MValue2").html(balance.toFixed(2));


                $("#KeyLi").hide();
                $("#KeyLi").children().first().val("");
                $("#ExitLi").show();
                $("#MoneyBoxLi").show();

                if ($.cookie("c_client") == undefined || $.cookie("c_client") == null || $.cookie("c_client") == '') {
                    $.cookie("c_client", data.d[1].Name, { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                }

                if ($.cookie("c_client_phone") == undefined || $.cookie("c_client_phone") == null || $.cookie("c_client_phone") == '') {
                    $.cookie("c_client_phone", $("#PhoneTextBox").val(), { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                }
            }
        }

        $.cookie("c_cart", "", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
        $.cookie("c_comments", "", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
        $.cookie("c_time", "", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });

        $("div.menu span.mcartcount").html("0");

        //$("#col1").children().remove();
        //$("#col2").children().remove();
        //$("#col3").children().remove();
        //$("#CabinetTable").children().remove();

        //$(".mcartcount").html("0");
        //$(".cartsum").remove();
        //$("#CreateOrder").hide();

        //$("#splash2").hide();
        //$("#splash").show()
        //$("#orderaccepted").center();
        //$("#orderaccepted").show();


        //$("#loading").hide();

        //$("#neworder").hide();
        $("#splash4").hide();

        $(".moneyboxm").click();
    }

    $("#TitleInfo").delegate(".ListView,.ListView2", "click", function () {
        if (window.innerWidth > 416) {
            $("#c_view").val("list");
            $(this).attr("class", "ListView2");

            $("#col1").children().remove();
            $("#col2").children().remove();
            $("#col3").children().remove();
            $("#CabinetTable").children().remove();

            $("#col2").hide();
            $("#col3").hide();

            var date = new Date();
            var minutes = 60;
            var hours = 24;
            var days = 365;
            date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

            $.cookie("c_view", "list", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });

            startRecord = 0;
            GetCurData();
        }
    })

    $("#TitleInfo").delegate(".TableView,.TableView2", "click", function () {

        if (window.innerWidth <= 416 || window.innerWidth >= 700) {
            $("#c_view").val("table");
            $(this).attr("class", "TableView2");

            $("#col1").children().remove();
            $("#col2").children().remove();
            $("#col3").children().remove();
            $("#CabinetTable").children().remove();

            $("#col2").show();
            $("#col3").show();

            var date = new Date();
            var minutes = 60;
            var hours = 24;
            var days = 365;
            date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

            $.cookie("c_view", "table", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });

            startRecord = 0;
            GetCurData();
        }
    })

    function GetCurData(path) {
        $("#splash").show();
        loading2Show();
        $("#EmptyDiv").hide();

        var datetime = $("#DateTimeInfo").css('display') == 'none' ? "" : $("#datepicker").val();


        if (getUrlParameter("feed") == "google") {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetGoogleFeedData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetGoogleFeedData
            });
        }
        else if (data_status == 0) {

            var ssid = sid_v;

            //if (getUrlParameter("ssid") != '' && getUrlParameter("ssid") != undefined) {
            //    ssid = getUrlParameter("ssid");
            //}

            var ss = $("#search input.searchtext").val();

            if ((ss == undefined || ss == '') && getUrlParameter("s") != '' && getUrlParameter("s") != undefined) {
                ss = getUrlParameter("s");
            }

            var minp = $("#minp").val();

            if (getUrlParameter("minp") != undefined && getUrlParameter("minp") != '') {
                minp = getUrlParameter("minp");
            }


            var maxp = $("#maxp").val();

            if (getUrlParameter("maxp") != undefined && getUrlParameter("maxp") != '') {
                maxp = getUrlParameter("maxp");
            }

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + ssid + ", \"desc\":'" + ss + "', \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"minp\":" + minp + ", \"maxp\":" + maxp + ", \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetData
            });
        }
        else if (data_status == 1) {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetNewData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetNewData
            });
        }
        else if (data_status == 2) {
        
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetSubCats",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(".TitleSpan").attr("sid") + ", \"path\":'" + $(".TitleSpan").attr("path") + "', \"status\":0, \"startRecord\":" + startRecord + ", \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetSubCats
            });
        }
        else if (data_status == 3) {

            //alert("test2");
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetSubCats",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(".TitleSpan").attr("sid") + ", \"path\":'" + $(".TitleSpan").attr("path") + "', \"status\":1, \"startRecord\":" + startRecord + ", \"sort\":" + sort + ", \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetSubCats2
            });
        }
        else if (data_status == 4) {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetTopRatedData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetTopRatedData
            });
        }
        else if (data_status == 5) {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetTopDiscount",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"startRecord\":" + startRecord + ", \"glue\":'" + $("#MBM1").attr("glue1") + "', \"product_view\":" + $("#MBM1").attr("v20") + ", \"view_type\":" + $("#MBM1").attr("v21") + ", \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetTopDiscount
            });
        }
        else if (data_status == 6) {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetFavData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"favdata\":'" + $.cookie("c_favors") + "', \"datetime\":'" + datetime + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetFavCount
            });
        }
        else if (data_status == 7) {
            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/GetCartData",
                data: "{ \"uid\":" + uid_v + ", \"sid\":" + sid_v + ", \"cartdata\":'" + $.cookie("c_cart") + "', \"host\":'" + extractHostname(window.location.origin) + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetCartCount
            });
        }
    }

    $("#MainCatMenu").delegate(".ListView", "click", function () {

        $("#col1").children().remove();
        $("#col2").children().remove();
        $("#col3").children().remove();
        $("#CabinetTable").children().remove();

        $("#col2").hide();
        $("#col3").hide();

        var date = new Date();
        var minutes = 60;
        var hours = 24;
        var days = 365;
        date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

        $.cookie("c_view", "list", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });

        startRecord = 0;
        GetCurData();
    })

    var cur_date;

    $(".AlertSpan").click(function () {
        cur_date = new Date();

        var month = cur_date.getMonth() + 1;
        var day = cur_date.getDate();

        var output = (day < 10 ? '0' : '') + day + ' / ' + (month < 10 ? '0' : '') + month + ' / ' + cur_date.getFullYear();

        if ($.cookie("c_client") != undefined && $.cookie("c_client") != null && $.cookie("c_client") != '') {
       
            $("#KeyCode").val($.cookie("c_client"));
        }

        $("#DateCount").html(output);
        $("#alertform").center();
        $("#alertform").show();
        $("#splash").show();
    });

    $("#SubmitAlert").click(function () {
        if ($("#AlertFormClose").attr("class") == "alertformclose") {
            $("#AlertFormClose").attr("class", "loadingalert");

            $.ajax({
                async: true,
                type: "POST",
                url: "https://xpool.pro/web/webform.aspx/SaveAlert",
                data: "{ \"uid\":" +uid_v + ", \"sid\":" + sid_v + ", \"status\":'" + $("#AlertSelect option:selected").attr("ru") + "', \"comment\":'" + $("#AlertInfo").val() + "', \"alert_date\":'" + $("#DateCount").html() + "', \"client_key\":'" + $("#KeyCode").val() + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: bindGetSubmitAlert
            });
        }
    });

    function bindGetSubmitAlert(data) {
        window.setTimeout(function () {
            $("#AlertFormClose").attr("class", "alertformclose");
            $("#alertform").hide();
            $("#alertaccepted").center();
            $("#alertaccepted").show();
        }, 1000);
    }

    $("#DateDec2").click(function () {
        $("#DateCount2").html(function () {
            cur_date.setDate(cur_date.getDate() - 1);

            var month = cur_date.getMonth() + 1;
            var day = cur_date.getDate();

            var output = (day < 10 ? '0' : '') + day + ' / ' + (month < 10 ? '0' : '') + month + ' / ' + cur_date.getFullYear();



            return output;
        });
    });

    $("#DateInc2").click(function () {
        $("#DateCount2").html(function () {
            cur_date.setDate(cur_date.getDate() + 1);

            var month = cur_date.getMonth() + 1;
            var day = cur_date.getDate();

            var output = (day < 10 ? '0' : '') + day + ' / ' + (month < 10 ? '0' : '') + month + ' / ' + cur_date.getFullYear();

            return output;
        });
    });

    $("#DateDec").click(function () {
        $("#DateCount").html(function () {
            cur_date.setDate(cur_date.getDate() - 1);

            var month = cur_date.getMonth() + 1;
            var day = cur_date.getDate();

            var output = (day < 10 ? '0' : '') + day + ' / ' + (month < 10 ? '0' : '') + month + ' / ' + cur_date.getFullYear();



            return output;
        });
    });

    $("#DateInc").click(function () {
        $("#DateCount").html(function () {
            cur_date.setDate(cur_date.getDate() + 1);

            var month = cur_date.getMonth() + 1;
            var day = cur_date.getDate();

            var output = (day < 10 ? '0' : '') + day + ' / ' + (month < 10 ? '0' : '') + month + ' / ' + cur_date.getFullYear();

            return output;
        });
    });

    $("#alertform span.alertformclose").click(function () {
        if ($("#AlertFormClose").attr("class") == "alertformclose") {
            $("#alertform").hide();
            $("#splash").hide();
        }
    });

    $("#alertaccepted span.close").click(function () {
        $("#alertaccepted").hide();
        $("#splash").hide();
    });

    $("#CabinetInfo").delegate('span.ToExcel', 'click', function () {

        var d = new Date();

        var day = d.getDate();

        if (day < 10) {
            day = "0" + day;
        }

        var month = d.getMonth() + 1

        if (month < 10) {
            if (month == 0)
                month = "01";
            else
                month = "0" + month;
        }

        $("#datepicker1").val(day + "." + month + "." + (d.getFullYear()));
        $("#datepicker2").val(day + "." + month + "." + (d.getFullYear()));

        $("#excelgenerate").center();
        $("#excelgenerate").show();
        $("#splash").show();
    });


    $("#CabinetInfo").delegate('span.Refresh', 'click', function () {
        $(".moneyboxm").click();
    });

    $("#excelgenerate span.excelgenerateclose").click(function () {
        $("#excelgenerate").hide();
        $("#splash").hide();
    });

    $("#ExcelGenerateSubmit").click(function () {

        var ex_type = 0;

        if ($("#salestab").attr("class") == "logselect")
            ex_type = 1;

        window.open("https://www.xpool.pro/web/cdownload.ashx?uid=" +uid_v + "&sid=" + sid_v + "&client=" + $.cookie("c_client") + "&lang=uk&date=" + $("#datepicker1").val() + "-" + $("#datepicker2").val() + "&type=" + ex_type, "_blank");
        $("#excelgenerate").hide();
        $("#splash").hide();
    });

    $("#TitleInfo").delegate(".SortView", "click", function () {

        $("#sortview").find('[v]').attr("class", "SortItem");
        $("#sortview").find('[v="' + sort + '"]').attr("class", "SortItem2");
        $("#sortview").center();
        $("#sortview").show();

        $("#splash").show();

        $(this).attr("class", "SortView2");
    });

    $("#sortview span.close").click(function () {
        $("#sortview").hide();
        $("#splash").hide();

        $(".SortView2").attr("class", "SortView");
    });

    $(".SortItem").click(function () {
        startRecord = 0;
        $("#col1").children().remove();
        $("#col2").children().remove();
        $("#col3").children().remove();

        sort = parseInt($(this).attr("v"));

        DataSLoad();

        $("#sortview").hide();
        $("#splash").hide();

        $(".SortView2").attr("class", "SortView");
    });

    var cur_comment = null;

    $("#ProductsListView").delegate("div.addcomment,div.addcomment2", "click", function () {
        cur_comment = $(this);

        if (cur_comment.html() != "комментарий" && cur_comment.html() != "коментар")
            $("#CommentTextBox").val(cur_comment.html());
        else {
            $("#CommentTextBox").val('');
        }

        $("#addcomment").center();
        $("#addcomment").show();
        $("#splash").show();
    });

    $("#addcomment span.close").click(function () {
        cur_comment = null;
        $("#addcomment").hide();
        $("#splash").hide();
    });

    $("#AddCommentSubmit").click(function () {
        if ($("#CommentTextBox").val() != '') {
            cur_comment.html($("#CommentTextBox").val());
            cur_comment.attr("class", "addcomment2");

            var date = new Date();
            var minutes = 60;
            var hours = 24;
            var days = 365;
            date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

            var code = cur_comment.attr("code");
            var cur_sid = cur_comment.attr("sid");
            if ($.cookie("c_comments") != undefined && $.cookie("c_comments") != null && $.cookie("c_comments") != '' && $.cookie("c_comments").indexOf(":" + code + "#") == -1) {
                $.cookie("c_comments", $.cookie("c_comments") + ":" + code + "#" + $("#CommentTextBox").val() + "#" + cur_sid + ":", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            }
            else if ($.cookie("c_comments") != '' && $.cookie("c_comments").indexOf(":" + code + "#") != -1) {
                var parts = $.cookie("c_comments").split(":");

                for (var i = 0; i < parts.length; i++) {
                    if (parts[i].indexOf(code + "#") != -1) {
                        $.cookie("c_comments", $.cookie("c_comments").replace(":" + parts[i] + ":", ":" + code + "#" + $("#CommentTextBox").val() + "#" + cur_sid + ":"), { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                    }
                }
            }
            else {
                $.cookie("c_comments", ":" + code + "#" + $("#CommentTextBox").val() + "#" + cur_sid + ":", { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
            }
        }
        else {
            cur_comment.html($("#MBM1").attr("v16") == "1" ? "коментар" : "комментарий");
            cur_comment.attr("class", "addcomment");

            var date = new Date();
            var minutes = 60;
            var hours = 24;
            var days = 365;
            date.setTime(date.getTime() + (days * hours * minutes * 60 * 1000));

            var code = cur_comment.attr("code");
            if ($.cookie("c_comments") != undefined && $.cookie("c_comments") != null && $.cookie("c_comments") != '') {

                var parts = $.cookie("c_comments").split(":");

                for (var i = 0; i < parts.length; i++) {
                    if (parts[i].indexOf(code + "#") != -1) {
                        $.cookie("c_comments", $.cookie("c_comments").replace(":" + parts[i] + ":", ""), { expires: date, path: '/', domain: '.' + extractHostname(window.location.origin) });
                    }
                }
            }
        }

        $("#CommentTextBox").val('');

        cur_comment = null;
        $("#addcomment").hide();
        $("#splash").hide();
    });

    $("#ProductsListView").delegate("span.findPhoto", "click", function (e) {

        if ($.cookie("c_view") == "table" || $.cookie("c_view") == undefined || $.cookie("c_view") == null || $.cookie("c_view") == '') {

            var res = $(this).parent().parent().find(".name").text();

            //res = jQuery.grep(res, function (n, i) {
            //    return (i < 6);
            //}).join(" ");

            window.open('https://www.google.com.ua/search?q=' + res + '&sxsrf=ALeKk01DO43JLK2Yo6vRz9hiOpSpsaraCg:1584701911902&source=lnms&tbm=isch&sa=X&ved=2ahUKEwjDmKLU8qjoAhXKlosKHZ6mAdAQ_AUoAXoECAwQAw&biw=1366&bih=657', '_blank');
        }
        else {
            var res = $(this).parent().parent().parent().find(".name").text();

            //res = jQuery.grep(res, function (n, i) {
            //    return (i < 6);
            //}).join(" ");

            window.open('https://www.google.com.ua/search?q=' + res + '&sxsrf=ALeKk01DO43JLK2Yo6vRz9hiOpSpsaraCg:1584701911902&source=lnms&tbm=isch&sa=X&ved=2ahUKEwjDmKLU8qjoAhXKlosKHZ6mAdAQ_AUoAXoECAwQAw&biw=1366&bih=657', '_blank');
        }

        if (win) {
            win.focus();
        }
        e.stopPropagation();
        e.preventDefault();
    });


    $("#viewer").delegate("span.findPhoto2", "click", function (e) {

        var res = selected.find(".name").first().html();

        //res = jQuery.grep(res, function (n, i) {
        //    return (i < 6);
        //}).join(" ");

        window.open('https://www.google.com.ua/search?q=' + res + '&sxsrf=ALeKk01DO43JLK2Yo6vRz9hiOpSpsaraCg:1584701911902&source=lnms&tbm=isch&sa=X&ved=2ahUKEwjDmKLU8qjoAhXKlosKHZ6mAdAQ_AUoAXoECAwQAw&biw=1366&bih=657', '_blank');

        if (win) {
            win.focus();
        }
        e.stopPropagation();
        e.preventDefault();
    });

    function extractHostname(url) {
        var hostname;

        if (url.indexOf("//") > -1) {
            hostname = url.split('/')[2];
        }
        else {
            hostname = url.split('/')[0];
        }
        hostname = hostname.split(':')[0];
        hostname = hostname.split('?')[0];

        return hostname;
    }

    $("#CabinetTable").delegate(".QR", "click", function () {
        var options = {
            // render method: 'canvas', 'image' or 'div'
            render: 'image',

            // version range somewhere in 1 .. 40
            minVersion: 1,
            maxVersion: 40,

            // error correction level: 'L', 'M', 'Q' or 'H'
            ecLevel: 'L',

            // offset in pixel if drawn onto existing canvas
            left: 0,
            top: 0,

            // size in pixel
            size: 200,

            // code color or image element
            fill: '#000',

            // background color or image element, null for transparent background
            background: null,

            // content
            text: "https://cabinet.tax.gov.ua/cashregs/check?id=" + $(this).attr("taxid") + "&date=" + $(this).attr("curd"),

            // corner radius relative to module width: 0.0 .. 0.5
            radius: 0,

            // quiet zone in modules
            quiet: 0,

            // modes
            // 0: normal
            // 1: label strip
            // 2: label box
            // 3: image strip
            // 4: image box
            mode: 0,

            mSize: 0.1,
            mPosX: 0.5,
            mPosY: 0.5,

            label: 'no label',
            fontname: 'sans',
            fontcolor: '#000',

            image: null
        }

        $('#QRCodeView').qrcode(options);
        $("#VerifyQR").attr("taxid", $(this).attr("taxid"));
        $("#VerifyQR").attr("curd", $(this).attr("curd"));
        $("#QRCode").show();
        $("#splash").show();
    })

    $("#CloseQR").click(function () {
        $("#QRCode").hide();
        $("#splash").hide();
        $('#QRCodeView').children().remove();
    })

    $("#VerifyQR").click(function () {
        window.open("https://cabinet.tax.gov.ua/cashregs/check?id=" + $(this).attr("taxid") + "&date=" + $(this).attr("curd"), "_blank");
    });

    var cur_remove_item = null;

    $("#CabinetTable").delegate(".RejectSpan2", "click", function () {

        $("#splash").show();
        loadingShow();

        cur_remove_item = $(this).closest("tr");

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/RemoveOrder",
            data: "{ \"uid\":" + uid_v + ", \"sid\":" + $(this).attr("sid") + ", \"id\":" + $(this).attr("logid") + " }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindRemoveOrder
        });
    });

    function bindRemoveOrder(data) {
        $(".moneyboxm").click();

        //$("#splash").hide();
        //loadingHide();
    }

    $("#ProductsListView").delegate(".ReadAll", "click", function () {
        loadingShow();
        $("#splash").show();
        $("#EmptyDiv").hide();
        $("#CreateOrder").hide();
        $("#PayOrder").hide();

        if (selected != undefined) {
            selected.css({ "border-color": "#FFFFFF" });
        }

        selected = $(this).closest('.product');
        selected.css({ "border-color": "green" });

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetProductInfo",
            data: "{ \"did\":" + $(this).attr("idv") + " }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetProductInfo
        });
    })

    function bindGetProductInfo(data) {
        $(".mainheader").hide();
        $("#ProductsListView").hide();

        $("#TitleInfo").hide();

        $("#RatesDiv").children().remove();

        $("#RatesDiv").append("<div id='HideRate' style='margin-top: 40px;'>" + ($("#MBM1").attr("v16") == "1" ? "Повернутися назад" : "Вернуться назад") + "</div>")

        $("#RatesDiv").append("<div class='DescContent'>" + data.d[1] + "</br/><br/>" + data.d[0] + "</div>");

        fillLangContent();

        $("#RatesDiv").show();
        loadingHide();

        $("#splash").hide();

        loading2Hide();

        var $target = $('html,body');
        $target.animate({ scrollTop: 0 }, 500);
    }

    $("#ProductsListView").delegate(".RateDiv", "click", function () {
        loadingShow();
        $("#splash").show();
        $("#EmptyDiv").hide();
        $("#CreateOrder").hide();

        if (selected != undefined) {
            selected.css({ "border-color": "#FFFFFF" });
        }

        selected = $(this).closest('.product');
        selected.css({ "border-color": "green" });

        //startRecord = 0;
        //sort = 0;
        //currentEvent = "clientlog";

       

        //data_status = 10;

        $.ajax({
            async: true,
            type: "POST",
            url: "https://xpool.pro/web/webform.aspx/GetRatesLog",
            data: "{ \"did\":" + $(this).attr("v") + ", \"startRecord\":0 }",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: bindGetRatesLog
        });
    })



    function bindGetRatesLog(data) {
        $(".mainheader").hide();
        $("#ProductsListView").hide();

        $("#TitleInfo").hide();

        $("#RatesDiv").children().remove();

        $("#RatesDiv").append("<div id='HideRate' style='margin-top: 40px;'>" + ($("#MBM1").attr("v16") == "1" ? "Повернутися назад" : "Вернуться назад") + "</div>")
        $("#RatesDiv").append("<div id='AddRate'>" + ($("#MBM1").attr("v16") == "1" ? "Додати відгук" : "Добавить отзыв") + "</div>")

        for (var i = 0; i < data.d.length; i++) {

            var milli = data.d[i].Date.replace(/\/Date\((-?\d+)\)\//, '$1');
            var d = new Date(parseInt(milli));

            var rate = "";

            if ((data.d[i].Rate1 + data.d[i].Rate2 + data.d[i].Rate3) / 3 >= 1)
                rate = "<div id='rate" + data.d[i].ID + "' v='" + ((data.d[i].Rate1 + data.d[i].Rate2 + data.d[i].Rate3) / 3) + "'></div>";

            $("#RatesDiv").append("<div><div class='RateTitle'>" + (data.d[i].Name == null ? "" : data.d[i].Name) + " " + formatDate(d) + " </div><div class='RateContent'>" + rate + (data.d[i].Comment == null ? "" : data.d[i].Comment) + "</div></div>");

            if ((data.d[i].Rate1 + data.d[i].Rate2 + data.d[i].Rate3) / 3 >= 1) {
                $('#rate' + data.d[i].ID).starRating({

                    initialRating: $('#rate' + data.d[i].ID).attr("v"),
                    strokeColor: '#894A00',
                    strokeWidth: 10,
                    starSize: 15,
                    readOnly: true,
                });
            }
            var $target = $('html,body');
            $target.animate({ scrollTop: 0 }, 500);
        }

        //startRecord = startRecord + data.d.length;

        fillLangContent();

        $("#RatesDiv").show();
        loadingHide();

        $("#splash").hide();

        loading2Hide();
    }

    $("#RatesDiv").delegate("#HideRate", "click", function () {
        $(".mainheader").show();
        $("#ProductsListView").show();
        $("#TitleInfo").show();
        $("#RatesDiv").hide();
        if (currentEvent == "cart")
            $("#CreateOrder").show();

        var $target = $('html,body');
        $target.animate({ scrollTop: selected.offset().top + $("#ProductsListView").offset().top + selected.outerHeight() / 2 - 120 - $(window).height() / 2 }, 0);
        selected.css({ "border": "solid 2px #FF0000" }).animate({ borderColor: "#000000" }, 1000);
    });

    $("#RatesDiv").delegate("#AddRate", "click", function () {
        if ($.cookie("key") != undefined && $.cookie("key") != '' && $.cookie("key") != null) {
            $("#R1").show();
            $("#R2").show();
            $("#R3").show();
            $("#RateDate1").show();
            $("#rateform").css("height", "480px");
        }
        else {
            $("#R1").hide();
            $("#R2").hide();
            $("#R3").hide();
            $("#rateform").css("height", "310px");
        }

        cur_date = new Date();

        var month = cur_date.getMonth() + 1;
        var day = cur_date.getDate();

        var output = (day < 10 ? '0' : '') + day + ' / ' + (month < 10 ? '0' : '') + month + ' / ' + cur_date.getFullYear();

        $("#DateCount2").html(output);

        $("#rateform").center();
        $("#rateform").show();
        $("#splash").show();
    });

    function formatDate(d) {
            month = '' + (d.getMonth() + 1),
            day = '' + d.getDate(),
            year = d.getFullYear();

        if (month.length < 2)
            month = '0' + month;
        if (day.length < 2)
            day = '0' + day;

        return [day, month, year].join('.');
    }
</script>

